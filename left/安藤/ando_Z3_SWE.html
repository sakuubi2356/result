<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Ando_Z3_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.3711567, -0.3711567, -0.3711567, -0.3711567, -0.3711567, -0.3711567], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.1427085, 0.1427085, 0.1427085, 0.1427085, 0.1427085, 0.1427085], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.3711567, 0.1427085], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.3711567, 0.1427085], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.3711567, 0.1427085], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.3711567, 0.1427085], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.3711567, 0.1427085], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [0.05706424, 0.05706424, 0.05706424, -0.1142241, -0.1142241, -0.1142241, -0.2855125, -0.2855125, -0.2855125], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [0.109458096325397, 0.322738438844681], "y": [0.0293522235006094, -0.582099199295044], "z": [-0.241746336221695, 0.227975845336914], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [0.322738438844681], "y": [-0.582099199295044], "z": [0.227975845336914], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.13611813341689488], "y": [-0.047079187940449074], "z": [-0.18303107613193986], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [-0.100275993347168], "z": [0.0570642352104187], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.13611813341689488, 0.154346406459808], "y": [-0.047079187940449074, -0.100275993347168], "z": [-0.18303107613193986, 0.0570642352104187], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z3 (Z3)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -2, "is_min": false, "A": [-0.749101042747498, -0.303145945072174, 0.132629185914993], "B": [0.0351627208292484, -0.145742505788803, 0.120184160768986], "S": [-0.6510681008072068, -0.2834705208831297, 0.1310735582241], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": -1, "is_min": false, "A": [-0.659810304641724, -0.168506041169167, 0.0187572278082371], "B": [0.135494440793991, -0.160061523318291, 0.104893773794174], "S": [-0.5603972466101041, -0.16745047681100608, 0.029524292249744812], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 0, "is_min": false, "A": [-0.659810304641724, -0.168506041169167, 0.0187572278082371], "B": [0.135494440793991, -0.160061523318291, 0.104893773794174], "S": [-0.5603972466101041, -0.16745047681100608, 0.029524292249744812], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 1, "is_min": false, "A": [-0.528799414634705, -0.0373821221292019, -0.0974131673574448], "B": [0.23659847676754, -0.175330683588982, 0.0900334417819977], "S": [-0.4331246758960167, -0.054625692728622596, -0.07398234064845893], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 2, "is_min": false, "A": [-0.190178394317627, 0.0528583005070686, -0.178045451641083], "B": [0.306989222764969, -0.451083034276962, 0.194603592157364], "S": [-0.12803243335676917, -0.01013437528671305, -0.13146431455115087], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 3, "is_min": true, "A": [0.109458096325397, 0.0293522235006094, -0.241746336221695], "B": [0.322738438844681, -0.582099199295044, 0.227975845336914], "S": [0.13611813341689488, -0.047079187940449074, -0.18303107613193986], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 4, "is_min": false, "A": [0.405629843473434, -0.120750561356544, -0.289805710315704], "B": [0.300707966089249, -0.700472831726074, 0.251409113407135], "S": [0.39251460876489286, -0.1932158453489821, -0.22215385716713776], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 5, "is_min": false, "A": [0.603830754756927, -0.302239030599594, -0.235261812806129], "B": [0.155910640954971, -0.758948683738708, 0.245137915015221], "S": [0.5478407420237129, -0.3593277357206748, -0.17521184842868082], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 6, "is_min": false, "A": [0.725477874279022, -0.585963606834412, -0.201051488518715], "B": [0.0846889168024063, -0.779541373252869, 0.237032130360603], "S": [0.6453792606522732, -0.6101608258066924, -0.1462910403003125], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 7, "is_min": false, "A": [0.777469098567963, -0.743911027908325, -0.075864166021347], "B": [0.0305047854781151, -0.689846754074097, 0.205420583486557], "S": [0.6840985405417527, -0.7371529923118152, -0.04070356521944942], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 8, "is_min": false, "A": [0.678239524364471, -0.975283861160278, -0.133835956454277], "B": [0.0292266644537449, -0.638579845428467, 0.190837994217873], "S": [0.59711294608021, -0.9331958743449641, -0.09325172723008636], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}], "2": [{"index": -3, "is_min": false, "A": [-0.789563298225403, -0.365194350481033, 0.214186146855354], "B": [-0.0504091382026672, -0.0698871687054634, 0.133906230330467], "S": [-0.6971690331948441, -0.3282809547456154, 0.20415115782978538], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": -2, "is_min": false, "A": [-0.713214337825775, -0.210650488734245, 0.101851142942905], "B": [0.0799323692917824, -0.113717742264271, 0.140873000025749], "S": [-0.6140710274502449, -0.1985338988491901, 0.10672887369999753], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": -1, "is_min": false, "A": [-0.548959791660309, -0.0568678602576256, -0.00569298025220633], "B": [0.207125574350357, -0.234793439507484, 0.185820907354355], "S": [-0.45444913284043315, -0.07910855485609099, 0.01824625267641569], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 0, "is_min": false, "A": [-0.548959791660309, -0.0568678602576256, -0.00569298025220633], "B": [0.207125574350357, -0.234793439507484, 0.185820907354355], "S": [-0.45444913284043315, -0.07910855485609099, 0.01824625267641569], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 1, "is_min": false, "A": [-0.314161211252213, 0.0422122739255428, -0.119625255465508], "B": [0.301262527704239, -0.344618827104568, 0.214464068412781], "S": [-0.23723326524967658, -0.006141600272754566, -0.07786410158003604], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 2, "is_min": true, "A": [-0.0135623421519995, 0.060331404209137, -0.209695070981979], "B": [0.362116903066635, -0.474876284599304, 0.251192986965179], "S": [0.033397564696119146, -0.006569558595487461, -0.15208406227157475], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 3, "is_min": false, "A": [0.313672631978989, 0.0144406296312809, -0.281168162822723], "B": [0.45455726981163, -0.549739480018616, 0.268242865800858], "S": [0.3312832095662512, -0.05608187549793113, -0.2124917925972715], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 4, "is_min": false, "A": [0.537458837032318, -0.281056493520737, -0.24506539106369], "B": [0.233992978930473, -0.770720481872559, 0.310036182403564], "S": [0.4995256078927937, -0.34226448702519674, -0.17567770009327105], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 5, "is_min": false, "A": [0.66111147403717, -0.480283379554749, -0.161028578877449], "B": [0.064793199300766, -0.786301136016846, 0.275729596614838], "S": [0.5865716929512295, -0.5185355974415452, -0.10643380932576821], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 6, "is_min": false, "A": [0.707480490207672, -0.784221053123474, -0.116922438144684], "B": [-0.00122692063450813, -0.782447338104248, 0.25419893860817], "S": [0.6188920926803418, -0.7839993388182198, -0.07053228114660345], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 7, "is_min": false, "A": [0.637535989284515, -1.02500057220459, -0.0979654267430305], "B": [-0.0361358784139156, -0.745763778686523, 0.230961740016937], "S": [0.5533270093231523, -0.9900959744659708, -0.056849532607404794], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}], "3": [{"index": -3, "is_min": false, "A": [-0.782731413841248, -0.273802995681763, 0.114770375192165], "B": [-0.000799190253019333, -0.104741781949997, 0.114385284483433], "S": [-0.6849898740239133, -0.252670341399143, 0.11472223884772828], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": -2, "is_min": false, "A": [-0.661878526210785, -0.103781342506409, -0.00040954677388072], "B": [0.125670611858368, -0.159777253866196, 0.12855052947998], "S": [-0.563434875356001, -0.11078083203758067, 0.01571046416545783], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": -1, "is_min": false, "A": [-0.436208724975586, 0.0211054254323244, -0.118579253554344], "B": [0.221056118607521, -0.321106314659119, 0.182907328009605], "S": [-0.35405062649379615, -0.021671038452134746, -0.08089343405419128], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 0, "is_min": false, "A": [-0.436208724975586, 0.0211054254323244, -0.118579253554344], "B": [0.221056118607521, -0.321106314659119, 0.182907328009605], "S": [-0.35405062649379615, -0.021671038452134746, -0.08089343405419128], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 1, "is_min": false, "A": [-0.15043506026268, 0.0734180063009262, -0.219611018896103], "B": [0.286234438419342, -0.437405347824097, 0.214415729045868], "S": [-0.09585137156828616, 0.00956508544535209, -0.16535767405244112], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 2, "is_min": true, "A": [0.172244533896446, 0.0076349712908268, -0.281421780586243], "B": [0.288841068744659, -0.578835427761078, 0.250045627355576], "S": [0.1868191020436074, -0.06567383508495664, -0.21498834870829736], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 3, "is_min": false, "A": [0.412203580141068, -0.167526945471764, -0.269810497760773], "B": [0.14176370203495, -0.696947574615479, 0.265517443418503], "S": [0.37839859365692396, -0.23370452748356957, -0.20289450170693252], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 4, "is_min": false, "A": [0.581899404525757, -0.406266182661057, -0.243846341967583], "B": [0.0587038695812225, -0.740574836730957, 0.260637998580933], "S": [0.516499977670464, -0.4480547548270135, -0.18078581387488607], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 5, "is_min": false, "A": [0.642616987228394, -0.683812618255615, -0.200542151927948], "B": [-0.0211235247552395, -0.737951278686523, 0.242760926485062], "S": [0.5596494284892866, -0.6905799503805354, -0.1451292706386325], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 6, "is_min": false, "A": [0.671550691127777, -0.801091492176056, -0.0773677751421928], "B": [-0.0567093342542648, -0.616612017154694, 0.197595700621605], "S": [0.5805182060390298, -0.7780315623793433, -0.04299734749955639], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 7, "is_min": false, "A": [0.507826268672943, -0.949192225933075, -0.228370696306229], "B": [-0.0424354039132595, -0.540399253368378, 0.184061586856842], "S": [0.43904355911231796, -0.8980931040004325, -0.17681666054556663], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}], "4": [{"index": -2, "is_min": false, "A": [-0.811815857887268, -0.205264955759048, 0.18253692984581], "B": [-0.0433070138096809, -0.0162257179617882, 0.0656671226024628], "S": [-0.7157522695412445, -0.18163505525634327, 0.1679282065505312], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": -1, "is_min": false, "A": [-0.690457880496979, -0.0343577228486538, 0.0528698563575745], "B": [0.105796709656715, -0.104805581271648, 0.0847472846508026], "S": [-0.590926091216444, -0.04316370210017559, 0.05685453351350087], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 0, "is_min": false, "A": [-0.690457880496979, -0.0343577228486538, 0.0528698563575745], "B": [0.105796709656715, -0.104805581271648, 0.0847472846508026], "S": [-0.590926091216444, -0.04316370210017559, 0.05685453351350087], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 1, "is_min": false, "A": [-0.504281401634216, 0.11286474019289, -0.111802130937576], "B": [0.234436988830566, -0.139262795448303, 0.0634890645742416], "S": [-0.4119416142144514, 0.08134880212462445, -0.08989073420094731], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 2, "is_min": false, "A": [-0.154057919979095, 0.141105338931084, -0.239313185214996], "B": [0.303984820842743, -0.382045239210129, 0.156300574541092], "S": [-0.09680257409927556, 0.07571151292052543, -0.1898614624150466], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 3, "is_min": true, "A": [0.176758497953415, 0.0678738281130791, -0.322057992219925], "B": [0.325726121664047, -0.523762345314026, 0.195412039756775], "S": [0.19537945166476728, -0.006080696534154162, -0.2573742356261599], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 4, "is_min": false, "A": [0.457715928554535, -0.135783091187477, -0.31364232301712], "B": [0.210994079709053, -0.662971079349518, 0.235175639390945], "S": [0.42687569748310683, -0.20168158963453264, -0.24504007779231465], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 5, "is_min": false, "A": [0.643948316574097, -0.439346998929977, -0.302546411752701], "B": [0.140870720148087, -0.73479700088501, 0.244831278920174], "S": [0.5810636223231734, -0.47627824606037783, -0.23412420618783258], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 6, "is_min": false, "A": [0.696473479270935, -0.770041882991791, -0.248224854469299], "B": [0.0601362697780132, -0.766114413738251, 0.23660472035408], "S": [0.6169313396318113, -0.7695509494063696, -0.18762116641448773], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 7, "is_min": false, "A": [0.647538900375366, -0.935517072677612, -0.158880785107613], "B": [-0.0196146294474602, -0.674445271492004, 0.197136297821999], "S": [0.5641447404898379, -0.9028831097943498, -0.11437866646680178], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}, {"index": 8, "is_min": false, "A": [0.497845381498337, -1.13397645950317, -0.160330012440681], "B": [-0.0310496408492327, -0.632218420505524, 0.169077649712563], "S": [0.43173352861294323, -1.0712567282585137, -0.11915407018481827], "P": [0.154346406459808, -0.100275993347168, 0.0570642352104187]}]};

    const STATIC_COUNT  = 8;
    const DYNAMIC_COUNT = 5;

    let currentTrial = "1";
    let currentCamera = null;

    // restyle対象トレース（動的5本）
    function dynamicTraceIndices() {
      const arr = [];
      for (let i = 0; i < DYNAMIC_COUNT; i++) arr.push(STATIC_COUNT + i);
      return arr;
    }
    const DYN_IDX = dynamicTraceIndices();

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        // 初期 camera 保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ユーザー操作で camera 変化を保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey && gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
          }
        });

        // 端末回転/リサイズ：Plotlyが勝手に変えることがあるので再適用
        let resizeTimer = null;
        function handleResize() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function() {
            Plotly.Plots.resize(gd).then(function() {
              if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
            });
          }, 150);
        }
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, currentTrial);
          });
        });

        // Slider
        slider.addEventListener("input", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init
        updateSliderForTrial(gd, currentTrial);

        function updateSliderForTrial(gd, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, trialKey, initPos);
        }

        // ★ここが本丸：restyle で x/y/z だけ更新（レイアウト触らない→カメラ戻らない）
        function updateFrame(gd, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          // Bat line (trace 0)
          const x0 = [f.A[0], f.B[0]];
          const y0 = [f.A[1], f.B[1]];
          const z0 = [f.A[2], f.B[2]];

          // Bottom marker (trace 1)
          const x1 = [f.B[0]];
          const y1 = [f.B[1]];
          const z1 = [f.B[2]];

          // Sweet (trace 2)
          const x2 = [f.S[0]];
          const y2 = [f.S[1]];
          const z2 = [f.S[2]];

          // Ball (trace 3)
          const x3 = [f.P[0]];
          const y3 = [f.P[1]];
          const z3 = [f.P[2]];

          // S->P (trace 4)
          const x4 = [f.S[0], f.P[0]];
          const y4 = [f.S[1], f.P[1]];
          const z4 = [f.S[2], f.P[2]];

          // restyle は「配列の配列」にするのがコツ
          Plotly.restyle(gd, {
            x: [x0, x1, x2, x3, x4],
            y: [y0, y1, y2, y3, y4],
            z: [z0, z1, z2, z3, z4],
          }, DYN_IDX).then(function() {
            // 念押し：カメラ保持（restyleだけなら基本不要だが、iOS保険）
            if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Ando_Z5_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
          <button class="trial-btn" id="trialBtn_5" data-trial="5">5球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.3711567, -0.3711567, -0.3711567, -0.3711567, -0.3711567, -0.3711567], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.1427085, 0.1427085, 0.1427085, 0.1427085, 0.1427085, 0.1427085], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.3711567, 0.1427085], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.3711567, 0.1427085], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.3711567, 0.1427085], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.3711567, 0.1427085], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.3711567, 0.1427085], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [0.05706424, 0.05706424, 0.05706424, -0.1142241, -0.1142241, -0.1142241, -0.2855125, -0.2855125, -0.2855125], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [0.0590032190084457, 0.422634810209274], "y": [0.0976574420928955, -0.422807335853577], "z": [-0.332422107458115, 0.154289767146111], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [0.422634810209274], "y": [-0.422807335853577], "z": [0.154289767146111], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.10445716904195497], "y": [0.03259934322734631], "z": [-0.27158312161555126], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [-0.0], "z": [-0.114224135875702], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.10445716904195497, 0.154346406459808], "y": [0.03259934322734631, -0.0], "z": [-0.27158312161555126, -0.114224135875702], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z5 (Z5)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -3, "is_min": false, "A": [-0.756833255290985, -0.345527499914169, 0.167936012148857], "B": [-0.0247329920530319, -0.0451562441885471, 0.0504350438714027], "S": [-0.665320734128827, -0.30798109776629723, 0.15324839299884227], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": -2, "is_min": false, "A": [-0.683244585990906, -0.187246531248093, 0.0381387695670128], "B": [0.109257638454437, -0.0784052684903145, 0.047843761742115], "S": [-0.5841818375846093, -0.1736413774753782, 0.039351893225814005], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": -1, "is_min": false, "A": [-0.533891618251801, -0.0327893495559692, -0.103695087134838], "B": [0.2425876557827, -0.135983258485794, 0.0588812865316868], "S": [-0.436831718333431, -0.045688586931452765, -0.08337304238124771], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 0, "is_min": false, "A": [-0.533891618251801, -0.0327893495559692, -0.103695087134838], "B": [0.2425876557827, -0.135983258485794, 0.0588812865316868], "S": [-0.436831718333431, -0.045688586931452765, -0.08337304238124771], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 1, "is_min": false, "A": [-0.262777149677277, 0.0793009549379349, -0.227906823158264], "B": [0.352483451366425, -0.296964108943939, 0.118328638374805], "S": [-0.18586957456590325, 0.03226782196437464, -0.18462739047737264], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 2, "is_min": true, "A": [0.0590032190084457, 0.0976574420928955, -0.332422107458115], "B": [0.422634810209274, -0.422807335853577, 0.154289767146111], "S": [0.10445716904195497, 0.03259934322734631, -0.27158312161555126], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 3, "is_min": false, "A": [0.404013872146606, -0.0124720521271229, -0.387051373720169], "B": [0.447641491889954, -0.561451256275177, 0.193223029375076], "S": [0.40946732496099325, -0.08109445700534823, -0.314517068725014], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 4, "is_min": false, "A": [0.619728446006775, -0.280130982398987, -0.35689702630043], "B": [0.280771940946579, -0.712535321712494, 0.224596813321114], "S": [0.5773588865318549, -0.3341815201471962, -0.28421030262250785], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 5, "is_min": false, "A": [0.735602617263794, -0.59723562002182, -0.330099612474442], "B": [0.186648145318031, -0.775088846683502, 0.223991945385933], "S": [0.6669833209756153, -0.6194672692382823, -0.26083818056582986], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 6, "is_min": false, "A": [0.715277194976807, -0.774224042892456, -0.227544829249382], "B": [0.037920881062746, -0.686763644218445, 0.189035847783089], "S": [0.6306076794061347, -0.7632914961142977, -0.17547225917673176], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 7, "is_min": false, "A": [0.640311539173126, -0.979045391082764, -0.162261575460434], "B": [-0.000410221517086029, -0.627324461936951, 0.162958145141602], "S": [0.5602213099071087, -0.9350802699003657, -0.12160910572569558], "P": [0.154346406459808, -0.0, -0.114224135875702]}], "2": [{"index": -3, "is_min": false, "A": [-0.762154698371887, -0.395442605018616, 0.199138611555099], "B": [-0.0926156342029572, -0.00113160721957684, 0.00877973530441523], "S": [-0.6784623299446852, -0.3461537388885162, 0.17534375617300785], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": -2, "is_min": false, "A": [-0.705078363418579, -0.218115240335464, 0.0501463674008846], "B": [0.0764767825603485, -0.0490695498883724, 0.0257525630295277], "S": [-0.6073839663059177, -0.19698452819353734, 0.04709714173382186], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": -1, "is_min": false, "A": [-0.578452110290527, -0.0550998486578465, -0.109540693461895], "B": [0.207378312945366, -0.0977200865745544, 0.0341758094727993], "S": [-0.48022333593215893, -0.060427376849209916, -0.0915761358157117], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 0, "is_min": false, "A": [-0.578452110290527, -0.0550998486578465, -0.109540693461895], "B": [0.207378312945366, -0.0977200865745544, 0.0341758094727993], "S": [-0.48022333593215893, -0.060427376849209916, -0.0915761358157117], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 1, "is_min": false, "A": [-0.400933086872101, 0.0822556987404823, -0.268584042787552], "B": [0.320478856563568, -0.108903206884861, 0.0195530913770199], "S": [-0.31075658882907686, 0.05836083418232768, -0.23256689897458555], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 2, "is_min": true, "A": [-0.0585601553320885, 0.133061543107033, -0.362003684043884], "B": [0.377898901700974, -0.336440473794937, 0.116610281169415], "S": [-0.004002772352133491, 0.07437379007905146, -0.3021769374592237], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 3, "is_min": false, "A": [0.282035440206528, 0.0754611790180206, -0.440035849809647], "B": [0.409611195325851, -0.452663332223892, 0.147168502211571], "S": [0.29798240930115744, 0.009445616335174822, -0.3666353071661338], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 4, "is_min": false, "A": [0.566082119941711, -0.0626620650291443, -0.393145978450775], "B": [0.305461704730988, -0.571430325508118, 0.166525214910507], "S": [0.5335045677444711, -0.12625809816665423, -0.32318707864518303], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 5, "is_min": false, "A": [0.784916758537292, -0.330948680639267, -0.335535109043121], "B": [0.240274548530579, -0.631039500236511, 0.167764350771904], "S": [0.7168364813917099, -0.36846003358191437, -0.27262267573941806], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 6, "is_min": false, "A": [0.842222213745117, -0.64787495136261, -0.298167288303375], "B": [0.183995380997658, -0.645807981491089, 0.156511783599854], "S": [0.7599438528470056, -0.6476165801073017, -0.24133239961504754], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 7, "is_min": false, "A": [0.797043323516846, -0.785298407077789, -0.234758347272873], "B": [0.12075512111187, -0.532717287540436, 0.109969288110733], "S": [0.7125073046393807, -0.75372576953455, -0.19166739612402878], "P": [0.154346406459808, -0.0, -0.114224135875702]}], "3": [{"index": -3, "is_min": false, "A": [-0.833665430545807, -0.397309988737106, 0.172079086303711], "B": [-0.142269551753998, -0.0250118337571621, 0.019220033660531], "S": [-0.7472409502467244, -0.3507727218146087, 0.15297170572923852], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": -2, "is_min": false, "A": [-0.783011555671692, -0.237878724932671, 0.0370982214808464], "B": [-0.00569793954491615, -0.0497942231595516, 0.0169009044766426], "S": [-0.6858473665025817, -0.2143681653195217, 0.034573557189123916], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": -1, "is_min": false, "A": [-0.651527762413025, -0.0809599161148071, -0.116280511021614], "B": [0.135653406381607, -0.0986194610595703, 0.0252614933997393], "S": [-0.5531301310001682, -0.08316735890342764, -0.09858776310969997], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 0, "is_min": false, "A": [-0.651527762413025, -0.0809599161148071, -0.116280511021614], "B": [0.135653406381607, -0.0986194610595703, 0.0252614933997393], "S": [-0.5531301310001682, -0.08316735890342764, -0.09858776310969997], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 1, "is_min": false, "A": [-0.391217082738876, 0.0416839048266411, -0.262175589799881], "B": [0.26581135392189, -0.24837626516819, 0.0902143344283104], "S": [-0.30908852350420224, 0.005426381523521401, -0.21812684677626654], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 2, "is_min": true, "A": [-0.0760926231741905, 0.0831761360168457, -0.358826547861099], "B": [0.341588526964188, -0.381566286087036, 0.140730187296867], "S": [-0.023882479150965065, 0.02508333296909626, -0.29638195566025705], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 3, "is_min": false, "A": [0.268121778964996, 0.0038879532366991, -0.404501497745514], "B": [0.369062006473541, -0.522067308425903, 0.189789891242981], "S": [0.280739306202672, -0.06185644821380403, -0.3302150811922734], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 4, "is_min": false, "A": [0.50480842590332, -0.239209935069084, -0.372062712907791], "B": [0.217665746808052, -0.676529049873352, 0.233165577054024], "S": [0.4689155968854858, -0.2938748154810007, -0.29640918903317315], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 5, "is_min": false, "A": [0.655802130699158, -0.550278544425964, -0.320942044258118], "B": [0.128906264901161, -0.753609895706177, 0.245659649372101], "S": [0.589940166565787, -0.5756949559685466, -0.2501168530844077], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 6, "is_min": false, "A": [0.672615468502045, -0.759738862514496, -0.205818101763725], "B": [-0.0114965885877609, -0.681889593601227, 0.201527431607246], "S": [0.5871014746527726, -0.7500077054123405, -0.15489991800389538], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 7, "is_min": false, "A": [0.628270268440247, -0.935435593128204, -0.149676918983459], "B": [-0.0373491980135441, -0.62974351644516, 0.172042042016983], "S": [0.5450678357663963, -0.8972240838334765, -0.10946204916429518], "P": [0.154346406459808, -0.0, -0.114224135875702]}], "4": [{"index": -3, "is_min": false, "A": [-0.839335680007935, -0.38302081823349, 0.205978527665138], "B": [-0.180413201451302, 0.0211255885660648, -0.000145125202834606], "S": [-0.7569703773404851, -0.332502521770264, 0.1802130732939653], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": -2, "is_min": false, "A": [-0.782151281833649, -0.201023727655411, 0.0406193025410175], "B": [-0.00215906649827957, -0.0249891895800829, 0.0156419035047293], "S": [-0.6846522461602316, -0.17901940841976272, 0.03749712738107547], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": -1, "is_min": false, "A": [-0.641205728054047, -0.0431902147829533, -0.135922372341156], "B": [0.14090459048748, -0.0770426541566849, 0.0288726594299078], "S": [-0.5434419336931737, -0.047421769901314394, -0.115322992412499], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 0, "is_min": false, "A": [-0.641205728054047, -0.0431902147829533, -0.135922372341156], "B": [0.14090459048748, -0.0770426541566849, 0.0288726594299078], "S": [-0.5434419336931737, -0.047421769901314394, -0.115322992412499], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 1, "is_min": false, "A": [-0.39479124546051, 0.08272635191679, -0.30736842751503], "B": [0.272438585758209, -0.161611899733543, 0.0601961612701416], "S": [-0.31138755277468544, 0.05218408372291505, -0.26142287386789287], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 2, "is_min": true, "A": [-0.0372983813285828, 0.088725671172142, -0.414386481046677], "B": [0.323740363121033, -0.358941823244095, 0.141711264848709], "S": [0.00783146653886331, 0.032767228404443495, -0.3448742553991308], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 3, "is_min": false, "A": [0.238547563552856, 0.00208926945924759, -0.452134698629379], "B": [0.317303836345673, -0.479837656021118, 0.181540161371231], "S": [0.24839209811185198, -0.05815159903998956, -0.3729253374289858], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 4, "is_min": false, "A": [0.481574773788452, -0.190233767032623, -0.406008958816528], "B": [0.157509356737137, -0.601948142051697, 0.198534548282623], "S": [0.44106659580578766, -0.2416980649914921, -0.33044101884112875], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 5, "is_min": false, "A": [0.67641282081604, -0.562953650951385, -0.389870434999466], "B": [0.174949318170547, -0.687105596065521, 0.220965653657913], "S": [0.613729886764319, -0.5784726431550586, -0.3135159285204773], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 6, "is_min": false, "A": [0.665929675102234, -0.894451498985291, -0.301254451274872], "B": [0.0721089914441109, -0.719348192214966, 0.205417200922966], "S": [0.5917021091020402, -0.8725635913764185, -0.237920511351697], "P": [0.154346406459808, -0.0, -0.114224135875702]}, {"index": 7, "is_min": false, "A": [0.516038537025452, -1.27952003479004, -0.225186094641685], "B": [0.0681304633617401, -0.787487745285034, 0.218979582190514], "S": [0.46005005252434694, -1.2180160257426895, -0.1696654095380864], "P": [0.154346406459808, -0.0, -0.114224135875702]}], "5": [{"index": -4, "is_min": false, "A": [-0.799542784690857, -0.432304531335831, 0.189945489168167], "B": [-0.10538649559021, -0.0493696592748165, 0.0826693177223206], "S": [-0.712773265290196, -0.3844376815612117, 0.17653597032399013], "P": [0.154346406459808, -0.0, -0.0532745122909546]}, {"index": -3, "is_min": false, "A": [-0.731525182723999, -0.260814040899277, 0.0658266916871071], "B": [0.0539994388818741, -0.11219622194767, 0.0952242985367775], "S": [-0.6333346362100711, -0.24223681943073333, 0.06950139137617557], "P": [0.154346406459808, -0.0, -0.0532745122909546]}, {"index": -2, "is_min": false, "A": [-0.595634639263153, -0.114991001784801, -0.0680710002779961], "B": [0.183183804154396, -0.177257612347603, 0.103872902691364], "S": [-0.49828233416807144, -0.12277432807859885, -0.04657801248014824], "P": [0.154346406459808, -0.0, -0.0532745122909546]}, {"index": -1, "is_min": false, "A": [-0.41275891661644, -0.00118715222924948, -0.214473322033882], "B": [0.297729820013046, -0.202537313103676, 0.0932017117738724], "S": [-0.32394782860295146, -0.02635592118648933, -0.17601394456833427], "P": [0.154346406459808, -0.0, -0.0532745122909546]}, {"index": 0, "is_min": false, "A": [-0.41275891661644, -0.00118715222924948, -0.214473322033882], "B": [0.297729820013046, -0.202537313103676, 0.0932017117738724], "S": [-0.32394782860295146, -0.02635592118648933, -0.17601394456833427], "P": [0.154346406459808, -0.0, -0.0532745122909546]}, {"index": 1, "is_min": true, "A": [-0.178827255964279, 0.0859599709510803, -0.353261709213257], "B": [0.413553446531296, -0.22857254743576, 0.0828050523996353], "S": [-0.10477965787796535, 0.046643400697411734, -0.2987533564484183], "P": [0.154346406459808, -0.0, -0.0532745122909546]}, {"index": 2, "is_min": false, "A": [0.0934625715017319, 0.136513978242874, -0.472515106201172], "B": [0.528539776802063, -0.254924952983856, 0.0729053840041161], "S": [0.14784721695576902, 0.08758411652562367, -0.4043375514549842], "P": [0.154346406459808, -0.0, -0.0532745122909546]}, {"index": 3, "is_min": false, "A": [0.394615411758423, 0.1455197930336, -0.565360069274902], "B": [0.643666684627533, -0.281813651323318, 0.0634161382913589], "S": [0.42574682260883795, 0.09210310950036682, -0.48676303893168177], "P": [0.154346406459808, -0.0, -0.0532745122909546]}, {"index": 4, "is_min": false, "A": [0.666605234146118, -0.48427215218544, -0.230264142155647], "B": [0.0852425768971443, -0.770040273666382, 0.239154532551765], "S": [0.593934893511547, -0.5199931715381294, -0.17158680097133458], "P": [0.154346406459808, -0.0, -0.0532745122909546]}, {"index": 5, "is_min": false, "A": [0.694961845874786, -0.805498838424683, -0.170664250850677], "B": [0.00259548425674438, -0.755021214485168, 0.226929396390915], "S": [0.6084160423929135, -0.7991891348286102, -0.12096504019088067], "P": [0.154346406459808, -0.0, -0.0532745122909546]}, {"index": 6, "is_min": false, "A": [0.650008916854858, -0.896020174026489, -0.121485158801079], "B": [-0.0331941097974777, -0.604403734207153, 0.17548879981041], "S": [0.5646085422391125, -0.8595681206351121, -0.08436341558982136], "P": [0.154346406459808, -0.0, -0.0532745122909546]}]};

    const STATIC_COUNT  = 8;
    const DYNAMIC_COUNT = 5;

    let currentTrial = "1";
    let currentCamera = null;

    // restyle対象トレース（動的5本）
    function dynamicTraceIndices() {
      const arr = [];
      for (let i = 0; i < DYNAMIC_COUNT; i++) arr.push(STATIC_COUNT + i);
      return arr;
    }
    const DYN_IDX = dynamicTraceIndices();

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        // 初期 camera 保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ユーザー操作で camera 変化を保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey && gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
          }
        });

        // 端末回転/リサイズ：Plotlyが勝手に変えることがあるので再適用
        let resizeTimer = null;
        function handleResize() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function() {
            Plotly.Plots.resize(gd).then(function() {
              if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
            });
          }, 150);
        }
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, currentTrial);
          });
        });

        // Slider
        slider.addEventListener("input", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init
        updateSliderForTrial(gd, currentTrial);

        function updateSliderForTrial(gd, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, trialKey, initPos);
        }

        // ★ここが本丸：restyle で x/y/z だけ更新（レイアウト触らない→カメラ戻らない）
        function updateFrame(gd, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          // Bat line (trace 0)
          const x0 = [f.A[0], f.B[0]];
          const y0 = [f.A[1], f.B[1]];
          const z0 = [f.A[2], f.B[2]];

          // Bottom marker (trace 1)
          const x1 = [f.B[0]];
          const y1 = [f.B[1]];
          const z1 = [f.B[2]];

          // Sweet (trace 2)
          const x2 = [f.S[0]];
          const y2 = [f.S[1]];
          const z2 = [f.S[2]];

          // Ball (trace 3)
          const x3 = [f.P[0]];
          const y3 = [f.P[1]];
          const z3 = [f.P[2]];

          // S->P (trace 4)
          const x4 = [f.S[0], f.P[0]];
          const y4 = [f.S[1], f.P[1]];
          const z4 = [f.S[2], f.P[2]];

          // restyle は「配列の配列」にするのがコツ
          Plotly.restyle(gd, {
            x: [x0, x1, x2, x3, x4],
            y: [y0, y1, y2, y3, y4],
            z: [z0, z1, z2, z3, z4],
          }, DYN_IDX).then(function() {
            // 念押し：カメラ保持（restyleだけなら基本不要だが、iOS保険）
            if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

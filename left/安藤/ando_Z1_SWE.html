<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Ando_Z1_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
          <button class="trial-btn" id="trialBtn_5" data-trial="5">5球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.3711567, -0.3711567, -0.3711567, -0.3711567, -0.3711567, -0.3711567], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.1427085, 0.1427085, 0.1427085, 0.1427085, 0.1427085, 0.1427085], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.3711567, 0.1427085], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.3711567, 0.1427085], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.3711567, 0.1427085], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.3711567, 0.1427085], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.3711567, 0.1427085], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [0.05706424, 0.05706424, 0.05706424, -0.1142241, -0.1142241, -0.1142241, -0.2855125, -0.2855125, -0.2855125], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [-0.0377389006316662, 0.455481380224228], "y": [0.151416882872581, -0.318608403205872], "z": [-0.187647357583046, 0.231649801135063], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [0.455481380224228], "y": [-0.318608403205872], "z": [0.231649801135063], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.0239136285841434], "y": [0.09266372772690329], "z": [-0.13523521775149866], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [0.100275993347168], "z": [0.0570642352104187], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.0239136285841434, 0.154346406459808], "y": [0.09266372772690329, 0.100275993347168], "z": [-0.13523521775149866, 0.0570642352104187], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z1 (Z1)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -2, "is_min": false, "A": [-0.7189120054245, -0.413491040468216, 0.260516077280045], "B": [-0.0811746865510941, 0.0494326055049896, 0.122701980173588], "S": [-0.639194835286941, -0.35562558089006857, 0.243289314001087], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": -1, "is_min": false, "A": [-0.656224310398102, -0.206278115510941, 0.140263095498085], "B": [0.12014689296484, -0.0134222358465195, 0.147633507847786], "S": [-0.5591779068472724, -0.18217112977526032, 0.1411843970715164], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 0, "is_min": false, "A": [-0.656224310398102, -0.206278115510941, 0.140263095498085], "B": [0.12014689296484, -0.0134222358465195, 0.147633507847786], "S": [-0.5591779068472724, -0.18217112977526032, 0.1411843970715164], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 1, "is_min": false, "A": [-0.541883885860443, -0.038979459553957, 0.0279011130332947], "B": [0.247597873210907, -0.0607562549412251, 0.155353933572769], "S": [-0.44319865812697756, -0.04170155919388473, 0.04383271686794872], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 2, "is_min": false, "A": [-0.351356685161591, 0.102060824632645, -0.0815519988536835], "B": [0.369358539581299, -0.131928652524948, 0.174998819828033], "S": [-0.26126727032634356, 0.07281213617562901, -0.049483142338567244], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 3, "is_min": true, "A": [-0.0377389006316662, 0.151416882872581, -0.187647357583046], "B": [0.455481380224228, -0.318608403205872, 0.231649801135063], "S": [0.0239136285841434, 0.09266372772690329, -0.13523521775149866], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 4, "is_min": false, "A": [0.290910512208939, 0.10782241076231, -0.256904542446136], "B": [0.502500653266907, -0.460183441638947, 0.265205532312393], "S": [0.3173592805371313, 0.03682167734391088, -0.1916407813840348], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 5, "is_min": false, "A": [0.561785757541656, -0.0933683663606644, -0.256404638290405], "B": [0.389565467834473, -0.642707943916321, 0.299082666635513], "S": [0.5402582204131648, -0.16203581647404003, -0.18696872222308072], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 6, "is_min": false, "A": [0.726286351680756, -0.379230976104736, -0.268063008785248], "B": [0.292365968227386, -0.734040141105652, 0.302746415138245], "S": [0.672046297019285, -0.4235821272326909, -0.19671182194195896], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 7, "is_min": false, "A": [0.744994342327118, -0.698946237564087, -0.274810314178467], "B": [0.184253796935081, -0.770983815193176, 0.291211485862732], "S": [0.6749017768888648, -0.7079509344162649, -0.2040575919348348], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 8, "is_min": false, "A": [0.726924955844879, -0.85597836971283, -0.147522196173668], "B": [0.0611413270235062, -0.638961791992188, 0.239306315779686], "S": [0.6437020238978636, -0.8288513045565542, -0.09916864476170244], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}], "2": [{"index": -2, "is_min": false, "A": [-0.722140908241272, -0.297150671482086, 0.16980567574501], "B": [0.0010094940662384, 0.0397929921746254, 0.11045703291893], "S": [-0.6317470937045931, -0.2550327068861925, 0.16238709422240305], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": -1, "is_min": false, "A": [-0.627235174179077, -0.107775554060936, 0.0609753131866455], "B": [0.164616942405701, -0.0160350855439901, 0.128458514809608], "S": [-0.5282536650657986, -0.09630799612886812, 0.06941071292421926], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 0, "is_min": false, "A": [-0.627235174179077, -0.107775554060936, 0.0609753131866455], "B": [0.164616942405701, -0.0160350855439901, 0.128458514809608], "S": [-0.5282536650657986, -0.09630799612886812, 0.06941071292421926], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 1, "is_min": false, "A": [-0.467003405094147, 0.058833796530962, -0.0620252341032028], "B": [0.296240031719208, -0.0708094537258148, 0.139598459005356], "S": [-0.3715979777135262, 0.042628390626128485, -0.036822273051360585], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 2, "is_min": false, "A": [-0.283903688192368, 0.194411590695381, -0.176244214177132], "B": [0.402545481920242, -0.0815831944346428, 0.128082111477852], "S": [-0.19809754843440278, 0.1599122451699848, -0.1382034263546399], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 3, "is_min": true, "A": [0.141109377145767, 0.201249301433563, -0.230983003973961], "B": [0.47843724489212, -0.36918032169342, 0.217146351933479], "S": [0.18327536176950432, 0.1299455965888076, -0.1749668329505614], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 4, "is_min": false, "A": [0.483656316995621, 0.0932956784963608, -0.278536707162857], "B": [0.506320357322693, -0.510941326618195, 0.245280161499977], "S": [0.4864893217510588, 0.017766060467210035, -0.213059605177306], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 5, "is_min": false, "A": [0.721024096012115, -0.152333706617355, -0.238614141941071], "B": [0.368397563695908, -0.666402339935303, 0.262771844863892], "S": [0.676945777365753, -0.21659228885350207, -0.175940890594822], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 6, "is_min": false, "A": [0.844676852226257, -0.477285861968994, -0.242481112480164], "B": [0.281186163425446, -0.743609070777893, 0.259066790342331], "S": [0.7742405219999468, -0.5105762602939701, -0.17978762985545566], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 7, "is_min": false, "A": [0.84002161026001, -0.678259074687958, -0.127659469842911], "B": [0.121928945183754, -0.669268667697906, 0.224849343299866], "S": [0.7502600528195446, -0.6771352741358871, -0.08359588081317823], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 8, "is_min": false, "A": [0.757664620876312, -0.909701943397522, -0.0885212123394012], "B": [0.0759139135479927, -0.611564993858337, 0.205299556255341], "S": [0.6724458032111049, -0.8724348337796872, -0.051793625208247734], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}], "3": [{"index": -6, "is_min": false, "A": [-0.806881487369537, -0.514859914779663, 0.231570810079575], "B": [-0.193277895450592, -0.0144536532461643, 0.11718463152647], "S": [-0.7301810379267615, -0.4523091317186204, 0.2172725376760072], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": -5, "is_min": false, "A": [-0.792198419570923, -0.359135925769806, 0.121249608695507], "B": [-0.0676136463880539, -0.0203753598034382, 0.106473319232464], "S": [-0.7016253337714988, -0.31679086009591045, 0.11940257273385624], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": -4, "is_min": false, "A": [-0.717492580413818, -0.185173138976097, 0.0148999849334359], "B": [0.0644006803631783, -0.0444493740797043, 0.108918763697147], "S": [-0.6197559060193708, -0.1675826653408955, 0.026652334298694357], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": -3, "is_min": false, "A": [-0.532861649990082, -0.00502992002293468, -0.0981495380401611], "B": [0.210770919919014, -0.155655711889267, 0.155469790101051], "S": [-0.4399075999429156, -0.02385813971380793, -0.06644712924995869], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": -2, "is_min": false, "A": [-0.281839221715927, 0.110310420393944, -0.204340368509293], "B": [0.315980225801468, -0.253986835479736, 0.182828277349472], "S": [-0.20711179911321748, 0.0647732684900863, -0.15594429317625547], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": -1, "is_min": true, "A": [0.0164329558610916, 0.173801094293594, -0.309329897165298], "B": [0.429075330495834, -0.297425538301468, 0.188336327672005], "S": [0.06801325511007864, 0.11489776245604179, -0.24712161614242972], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 0, "is_min": false, "A": [0.0164329558610916, 0.173801094293594, -0.309329897165298], "B": [0.429075330495834, -0.297425538301468, 0.188336327672005], "S": [0.06801325511007864, 0.11489776245604179, -0.24712161614242972], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 1, "is_min": false, "A": [0.354046374559402, 0.0196547973901033, -0.271476835012436], "B": [0.318655163049698, -0.571841180324554, 0.265998721122742], "S": [0.3496224731308763, -0.054282199653968036, -0.20429239065024996], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 2, "is_min": false, "A": [0.600960791110992, -0.204223647713661, -0.263178020715714], "B": [0.245153531432152, -0.674757719039917, 0.27719122171402], "S": [0.5564848849188084, -0.26304040495302244, -0.19563186733722682], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 3, "is_min": false, "A": [0.708381652832031, -0.411269187927246, -0.170789793133736], "B": [0.0746205896139145, -0.667263031005859, 0.244919613003731], "S": [0.629161534987571, -0.4432684122298036, -0.11882612724357311], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 4, "is_min": false, "A": [0.728321313858032, -0.678829073905945, -0.141260713338852], "B": [0.0180343091487885, -0.637780666351318, 0.224535912275314], "S": [0.6395354224635658, -0.6736980220481783, -0.095536126997115], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}], "4": [{"index": -6, "is_min": false, "A": [-0.821821391582489, -0.436930805444717, 0.178783044219017], "B": [-0.145757675170898, -0.0152202732861042, 0.107383027672768], "S": [-0.7373134193688444, -0.38421698414541683, 0.16985804134152088], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": -5, "is_min": false, "A": [-0.783471286296844, -0.279631942510605, 0.0675509199500084], "B": [-0.0226264037191868, -0.0355695076286793, 0.106901712715626], "S": [-0.6883656679765799, -0.24912413558476218, 0.07246976945936902], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": -4, "is_min": false, "A": [-0.700843930244446, -0.127567127346992, -0.056702759116888], "B": [0.0799727737903595, -0.0311394352465868, 0.0883047953248024], "S": [-0.6032418587065355, -0.11551366786797983, -0.03857681786970324], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": -3, "is_min": false, "A": [-0.425073176622391, 0.0533854737877846, -0.1781025826931], "B": [0.245994538068771, -0.213308960199356, 0.166196972131729], "S": [-0.34118971112428287, 0.020048669077706326, -0.13506513774396528], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": -2, "is_min": false, "A": [-0.162089362740517, 0.12052871286869, -0.263494700193405], "B": [0.320868998765945, -0.321744471788406, 0.196011409163475], "S": [-0.10171957761472121, 0.06524457400138303, -0.20605644609767565], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": -1, "is_min": true, "A": [0.14950031042099, 0.0928555503487587, -0.271877616643906], "B": [0.283844649791718, -0.503759324550629, 0.243876412510872], "S": [0.16629335377301255, 0.01827868685323622, -0.20740835942662994], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 0, "is_min": false, "A": [0.14950031042099, 0.0928555503487587, -0.271877616643906], "B": [0.283844649791718, -0.503759324550629, 0.243876412510872], "S": [0.16629335377301255, 0.01827868685323622, -0.20740835942662994], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 1, "is_min": false, "A": [0.440688669681549, -0.0580764040350914, -0.282787948846817], "B": [0.247661218047142, -0.611930727958679, 0.261257767677307], "S": [0.4165602373013492, -0.12730819718222475, -0.21478223167166577], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 2, "is_min": false, "A": [0.641436874866486, -0.31634059548378, -0.268715500831604], "B": [0.171681836247444, -0.685950577259064, 0.262997478246689], "S": [0.5827174962802966, -0.36254184222910385, -0.20225137985171399], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 3, "is_min": false, "A": [0.726033866405487, -0.519666016101837, -0.154434040188789], "B": [0.0322344228625298, -0.631189048290253, 0.227933719754219], "S": [0.639308946695696, -0.5336063934001275, -0.106638076111143], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 4, "is_min": false, "A": [0.721670567989349, -0.70699679851532, -0.10199511796236], "B": [-0.00580211728811264, -0.574303507804871, 0.203252360224724], "S": [0.6307364851830032, -0.6904101376969715, -0.06383918438623443], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}], "5": [{"index": -3, "is_min": false, "A": [-0.816815495491028, -0.356891959905624, 0.17492139339447], "B": [-0.0970830768346786, -0.0153454877436161, 0.101903840899467], "S": [-0.7268489649536263, -0.31419866122794315, 0.16579420154368218], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": -2, "is_min": false, "A": [-0.74840235710144, -0.184428408741951, 0.0537412241101265], "B": [0.0371785759925842, -0.0409765392541885, 0.101538501679897], "S": [-0.6502047727658176, -0.16649693095436413, 0.05971588184104286], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": -1, "is_min": false, "A": [-0.596655070781708, -0.0147308278828859, -0.0833985507488251], "B": [0.1747807264328, -0.0937313884496689, 0.113187164068222], "S": [-0.5002256127838616, -0.024605896248248063, -0.058825340640640406], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 0, "is_min": false, "A": [-0.596655070781708, -0.0147308278828859, -0.0833985507488251], "B": [0.1747807264328, -0.0937313884496689, 0.113187164068222], "S": [-0.5002256127838616, -0.024605896248248063, -0.058825340640640406], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 1, "is_min": false, "A": [-0.416608333587646, 0.121444866061211, -0.209584847092628], "B": [0.284626841545105, -0.105394124984741, 0.101563639938831], "S": [-0.3289539421528235, 0.09308999394565014, -0.17069128863494631], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 2, "is_min": true, "A": [0.0172397922724485, 0.140095621347427, -0.297923862934113], "B": [0.369302719831467, -0.371394634246826, 0.206486120820045], "S": [0.061247657590207866, 0.07615934030924591, -0.2348726158633319], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 3, "is_min": false, "A": [0.346130907535553, 0.00665123201906681, -0.307516038417816], "B": [0.298064112663269, -0.559972822666168, 0.255179882049561], "S": [0.3401225578715367, -0.06417677841178099, -0.2371790447891242], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 4, "is_min": false, "A": [0.610057950019836, -0.223473459482193, -0.299433797597885], "B": [0.25221511721611, -0.657311677932739, 0.269541472196579], "S": [0.5653275941865938, -0.2777032388892788, -0.22831188611843758], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 5, "is_min": false, "A": [0.740154266357422, -0.54217141866684, -0.271062463521957], "B": [0.175600558519363, -0.716590344905853, 0.268249243497849], "S": [0.6695850511240575, -0.5639737849884938, -0.2036484984692804], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 6, "is_min": false, "A": [0.734256446361542, -0.744890868663788, -0.16760641336441], "B": [0.046936210244894, -0.650419414043427, 0.230722695589066], "S": [0.6483414196494823, -0.7330819372214465, -0.11781527636939687], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}, {"index": 7, "is_min": false, "A": [0.646179735660553, -0.971770107746124, -0.131754234433174], "B": [0.0198856256902218, -0.609352290630341, 0.209433272480965], "S": [0.5678929658727725, -0.9264678771106207, -0.0891057927776724], "P": [0.154346406459808, 0.100275993347168, 0.0570642352104187]}]};

    const STATIC_COUNT  = 8;
    const DYNAMIC_COUNT = 5;

    let currentTrial = "1";
    let currentCamera = null;

    // restyle対象トレース（動的5本）
    function dynamicTraceIndices() {
      const arr = [];
      for (let i = 0; i < DYNAMIC_COUNT; i++) arr.push(STATIC_COUNT + i);
      return arr;
    }
    const DYN_IDX = dynamicTraceIndices();

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        // 初期 camera 保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ユーザー操作で camera 変化を保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey && gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
          }
        });

        // 端末回転/リサイズ：Plotlyが勝手に変えることがあるので再適用
        let resizeTimer = null;
        function handleResize() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function() {
            Plotly.Plots.resize(gd).then(function() {
              if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
            });
          }, 150);
        }
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, currentTrial);
          });
        });

        // Slider
        slider.addEventListener("input", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init
        updateSliderForTrial(gd, currentTrial);

        function updateSliderForTrial(gd, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, trialKey, initPos);
        }

        // ★ここが本丸：restyle で x/y/z だけ更新（レイアウト触らない→カメラ戻らない）
        function updateFrame(gd, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          // Bat line (trace 0)
          const x0 = [f.A[0], f.B[0]];
          const y0 = [f.A[1], f.B[1]];
          const z0 = [f.A[2], f.B[2]];

          // Bottom marker (trace 1)
          const x1 = [f.B[0]];
          const y1 = [f.B[1]];
          const z1 = [f.B[2]];

          // Sweet (trace 2)
          const x2 = [f.S[0]];
          const y2 = [f.S[1]];
          const z2 = [f.S[2]];

          // Ball (trace 3)
          const x3 = [f.P[0]];
          const y3 = [f.P[1]];
          const z3 = [f.P[2]];

          // S->P (trace 4)
          const x4 = [f.S[0], f.P[0]];
          const y4 = [f.S[1], f.P[1]];
          const z4 = [f.S[2], f.P[2]];

          // restyle は「配列の配列」にするのがコツ
          Plotly.restyle(gd, {
            x: [x0, x1, x2, x3, x4],
            y: [y0, y1, y2, y3, y4],
            z: [z0, z1, z2, z3, z4],
          }, DYN_IDX).then(function() {
            // 念押し：カメラ保持（restyleだけなら基本不要だが、iOS保険）
            if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

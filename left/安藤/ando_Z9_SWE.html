<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Ando_Z9_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.3711567, -0.3711567, -0.3711567, -0.3711567, -0.3711567, -0.3711567], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.1427085, 0.1427085, 0.1427085, 0.1427085, 0.1427085, 0.1427085], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.3711567, 0.1427085], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.3711567, 0.1427085], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.3711567, 0.1427085], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.3711567, 0.1427085], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.3711567, 0.1427085], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [0.05706424, 0.05706424, 0.05706424, -0.1142241, -0.1142241, -0.1142241, -0.2855125, -0.2855125, -0.2855125], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [0.1951944231987, 0.397230446338654], "y": [-0.0685327872633934, -0.534623324871063], "z": [-0.532520294189453, 0.0854934006929398], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [0.397230446338654], "y": [-0.534623324871063], "z": [0.0854934006929398], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.22044892863724705], "y": [-0.12679411033801313], "z": [-0.45526857454096115], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [-0.100275993347168], "z": [-0.285512506961823], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.22044892863724705, 0.154346406459808], "y": [-0.12679411033801313, -0.100275993347168], "z": [-0.45526857454096115, -0.285512506961823], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z9 (Z9)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -2, "is_min": false, "A": [-0.778937220573425, -0.228226020932198, 0.0983127802610397], "B": [-0.0145165920257568, -0.0765289813280106, -0.0823789685964584], "S": [-0.6833846716620146, -0.2092638968670291, 0.07572631866410792], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": -1, "is_min": false, "A": [-0.673827171325684, -0.0964833125472069, -0.0831922218203545], "B": [0.125561267137527, -0.127632558345795, -0.0859845951199532], "S": [-0.5739036124904819, -0.10037696842895961, -0.08354126849687225], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 0, "is_min": false, "A": [-0.673827171325684, -0.0964833125472069, -0.0831922218203545], "B": [0.125561267137527, -0.127632558345795, -0.0859845951199532], "S": [-0.5739036124904819, -0.10037696842895961, -0.08354126849687225], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 1, "is_min": false, "A": [-0.537294387817383, 0.015837274491787, -0.258464992046356], "B": [0.234004586935043, -0.142706871032715, -0.117179103195667], "S": [-0.44088202026086054, -0.0039807428174535725, -0.2408042567254061], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 2, "is_min": false, "A": [-0.147701501846313, 0.0277790185064077, -0.439304351806641], "B": [0.358341783285141, -0.387197554111481, 0.0208202283829451], "S": [-0.08444609078694913, -0.02409305341355013, -0.38178877890293406], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 3, "is_min": true, "A": [0.1951944231987, -0.0685327872633934, -0.532520294189453], "B": [0.397230446338654, -0.534623324871063, 0.0854934006929398], "S": [0.22044892863724705, -0.12679411033801313, -0.45526857454096115], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 4, "is_min": false, "A": [0.476064622402191, -0.307579070329666, -0.500023245811462], "B": [0.264958262443542, -0.695412993431091, 0.167074352502823], "S": [0.44967633261904494, -0.35605830114270004, -0.41663606249113816], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 5, "is_min": false, "A": [0.649714291095734, -0.634785056114197, -0.436662167310715], "B": [0.182054594159126, -0.781309008598328, 0.195655018091202], "S": [0.5912568236693045, -0.6531005518382038, -0.357622511956761], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 6, "is_min": false, "A": [0.663133502006531, -0.984683573246002, -0.318114578723907], "B": [0.0811925232410431, -0.822799503803253, 0.206421807408333], "S": [0.5903908896108147, -0.9644480673335363, -0.25254753942584857], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 7, "is_min": false, "A": [0.588333308696747, -1.09364020824432, -0.209396481513977], "B": [-0.012587072327733, -0.704058170318604, 0.14714390039444], "S": [0.5132182911461636, -1.0449424730031016, -0.16482895162110844], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 8, "is_min": false, "A": [0.303815633058548, -1.21200168132782, -0.323341816663742], "B": [-0.0348949134349823, -0.633913934230804, 0.113796293735504], "S": [0.26147681491929053, -1.1397407132349913, -0.2686995530863785], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}], "2": [{"index": -2, "is_min": false, "A": [-0.755537390708923, -0.228222623467445, 0.00822160765528679], "B": [0.0289021767675877, -0.0914499908685684, -0.0689004808664322], "S": [-0.6574824451258796, -0.21112604445387553, -0.0014186533753683932], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": -1, "is_min": false, "A": [-0.617265582084656, -0.0799358040094376, -0.190374225378036], "B": [0.168128579854965, -0.150401949882507, -0.0555026605725288], "S": [-0.5190912969869089, -0.0887440735763993, -0.17351527722632684], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 0, "is_min": false, "A": [-0.617265582084656, -0.0799358040094376, -0.190374225378036], "B": [0.168128579854965, -0.150401949882507, -0.0555026605725288], "S": [-0.5190912969869089, -0.0887440735763993, -0.17351527722632684], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 1, "is_min": false, "A": [-0.376362681388855, 0.0306813027709723, -0.37293952703476], "B": [0.291885554790497, -0.235972836613655, -0.0231683980673552], "S": [-0.2928316504220607, -0.002650465228461761, -0.3292181351578268], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 2, "is_min": false, "A": [-0.0887741670012474, 0.0976395532488823, -0.538120031356812], "B": [0.411865919828415, -0.267053157091141, -0.031801238656044], "S": [-0.026194155627241936, 0.05205296407736704, -0.4748301817430166], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 3, "is_min": true, "A": [0.311940342187881, -0.106865793466568, -0.564306974411011], "B": [0.335180193185806, -0.534967303276062, 0.111110650002956], "S": [0.31484532365171247, -0.16037848383389783, -0.47987976877002647], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 4, "is_min": false, "A": [0.549147963523865, -0.299574971199036, -0.483348041772842], "B": [0.175287619233131, -0.632465898990631, 0.140680879354477], "S": [0.5024154212630811, -0.34118633648241675, -0.40534442792644954], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 5, "is_min": false, "A": [0.686448693275452, -0.600730359554291, -0.406251937150955], "B": [0.105623640120029, -0.664961636066437, 0.140114858746529], "S": [0.6138455658802731, -0.6087592686484007, -0.3379560916609258], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 6, "is_min": false, "A": [0.695648908615112, -0.864579200744629, -0.306491792201996], "B": [0.0529124774038792, -0.655948519706726, 0.121717311441898], "S": [0.6153068495366661, -0.8385003639344359, -0.25296565079741834], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 7, "is_min": false, "A": [0.54366272687912, -0.975032687187195, -0.361846029758453], "B": [0.0160270091146231, -0.540739774703979, 0.0540751665830612], "S": [0.47770827380674014, -0.9207460827143226, -0.30985588939771586], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 8, "is_min": false, "A": [0.249638050794601, -0.930515944957733, -0.616841793060303], "B": [0.0189496837556362, -0.489034563302994, 0.00915909186005592], "S": [0.22080200583739268, -0.8753307740166416, -0.5385916849490142], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}], "3": [{"index": -3, "is_min": false, "A": [-0.770306587219238, -0.432375848293304, 0.194198593497276], "B": [-0.106957703828812, -0.0691250860691071, -0.0666033327579498], "S": [-0.6873880093209026, -0.38696952082627045, 0.16159836550307002], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": -2, "is_min": false, "A": [-0.722485601902008, -0.273669481277466, 0.0349311977624893], "B": [0.0598704069852829, -0.129169121384621, -0.0489678978919983], "S": [-0.6246911265311227, -0.255606941045017, 0.024443813566013654], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": -1, "is_min": false, "A": [-0.594862222671509, -0.131058529019356, -0.142264679074287], "B": [0.195933282375336, -0.188817605376244, -0.0359344854950905], "S": [-0.4960127653708446, -0.1382784149641146, -0.12897340229931908], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 0, "is_min": false, "A": [-0.594862222671509, -0.131058529019356, -0.142264679074287], "B": [0.195933282375336, -0.188817605376244, -0.0359344854950905], "S": [-0.4960127653708446, -0.1382784149641146, -0.12897340229931908], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 1, "is_min": false, "A": [-0.376108318567276, -0.00893518980592489, -0.305358588695526], "B": [0.314686864614487, -0.276645749807358, -0.00347608979791403], "S": [-0.28975891879308013, -0.042399010533312784, -0.2676232755132911], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 2, "is_min": true, "A": [-0.0621835514903069, 0.00532154366374016, -0.432917594909668], "B": [0.344464778900146, -0.455317944288254, 0.0793795138597488], "S": [-0.01135250741658276, -0.05225839547360557, -0.3688804528176393], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 3, "is_min": false, "A": [0.269985437393188, -0.0992311760783195, -0.512289941310883], "B": [0.3497394323349, -0.577086210250854, 0.12433698028326], "S": [0.27995468698916953, -0.1589630567175769, -0.4327115742894963], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 4, "is_min": false, "A": [0.611504673957825, -0.310664087533951, -0.549326121807098], "B": [0.424425065517426, -0.657496750354767, 0.146883860230446], "S": [0.5881197231764943, -0.3540181698790966, -0.4622998750710409], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 5, "is_min": false, "A": [0.669797599315643, -0.565836906433105, -0.412456929683685], "B": [0.114685490727425, -0.714204549789429, 0.144173920154572], "S": [0.6004086027471898, -0.5843828573076126, -0.34287809050550144], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 6, "is_min": false, "A": [0.688760221004486, -0.842767596244812, -0.342170596122742], "B": [0.0558312013745308, -0.708601713180542, 0.128361567854881], "S": [0.6096441025381848, -0.8259968627669022, -0.28335408230698517], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 7, "is_min": false, "A": [0.629530549049377, -0.955771505832672, -0.288027882575989], "B": [0.0133929122239351, -0.589595139026642, 0.0673443898558617], "S": [0.5525133547432435, -0.9099994661015495, -0.24360635446107817], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}], "4": [{"index": -3, "is_min": false, "A": [-0.753290832042694, -0.301947683095932, 0.221259862184525], "B": [-0.0982895195484161, 0.000608285889029503, -0.124331288039684], "S": [-0.6714156728966775, -0.2641281892434867, 0.1780609710001517], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": -2, "is_min": false, "A": [-0.713568031787872, -0.153451129794121, 0.0322261899709702], "B": [0.0575361549854279, -0.0360919050872326, -0.145609736442566], "S": [-0.6171800439245185, -0.13878123210618926, 0.009996707352617401], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": -1, "is_min": false, "A": [-0.584303677082062, -0.0220205578953028, -0.191067412495613], "B": [0.211547136306763, -0.0924545750021935, -0.150320515036583], "S": [-0.4848223081227927, -0.030824811563472096, -0.18597404942822254], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 0, "is_min": false, "A": [-0.584303677082062, -0.0220205578953028, -0.191067412495613], "B": [0.211547136306763, -0.0924545750021935, -0.150320515036583], "S": [-0.4848223081227927, -0.030824811563472096, -0.18597404942822254], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 1, "is_min": false, "A": [-0.287887215614319, 0.0550906211137772, -0.411758333444595], "B": [0.363938212394714, -0.25597620010376, -0.0677220672369003], "S": [-0.20640903127780322, 0.01620726567679774, -0.36875379708869094], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 2, "is_min": true, "A": [0.0616719909012318, 0.0329300053417683, -0.56355208158493], "B": [0.455822497606277, -0.389101654291153, -0.00989631377160549], "S": [0.11094080220312395, -0.01982394993207031, -0.49434511346853016], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 3, "is_min": false, "A": [0.439032018184662, -0.0546264983713627, -0.69049346446991], "B": [0.576966464519501, -0.4533531665802, -0.0107942186295986], "S": [0.45627382488949064, -0.10446733453659784, -0.6055310542410122], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 4, "is_min": false, "A": [0.674084424972534, -0.527493596076965, -0.541406393051147], "B": [0.347677707672119, -0.708686947822571, 0.166144043207169], "S": [0.6332835851718003, -0.5501427651218725, -0.4529625882193214], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 5, "is_min": false, "A": [0.773894906044006, -0.89752459526062, -0.38663649559021], "B": [0.254433393478394, -0.796841740608215, 0.213382348418236], "S": [0.7089622125813758, -0.8849392375778188, -0.3116341350161317], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 6, "is_min": false, "A": [0.743277251720428, -1.0581864118576, -0.215620890259743], "B": [0.129118993878365, -0.743099331855774, 0.188767090439796], "S": [0.6665074618488123, -1.018800522937058, -0.16507238764090482], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}, {"index": 7, "is_min": false, "A": [0.562885463237762, -1.28336775302887, -0.154078140854836], "B": [0.0959976837038994, -0.71417361497879, 0.159025326371193], "S": [0.5045244883639083, -1.2122184828075528, -0.1149402058205577], "P": [0.154346406459808, -0.100275993347168, -0.285512506961823]}]};

    const STATIC_COUNT  = 8;
    const DYNAMIC_COUNT = 5;

    let currentTrial = "1";
    let currentCamera = null;

    // restyle対象トレース（動的5本）
    function dynamicTraceIndices() {
      const arr = [];
      for (let i = 0; i < DYNAMIC_COUNT; i++) arr.push(STATIC_COUNT + i);
      return arr;
    }
    const DYN_IDX = dynamicTraceIndices();

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        // 初期 camera 保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ユーザー操作で camera 変化を保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey && gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
          }
        });

        // 端末回転/リサイズ：Plotlyが勝手に変えることがあるので再適用
        let resizeTimer = null;
        function handleResize() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function() {
            Plotly.Plots.resize(gd).then(function() {
              if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
            });
          }, 150);
        }
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, currentTrial);
          });
        });

        // Slider
        slider.addEventListener("input", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init
        updateSliderForTrial(gd, currentTrial);

        function updateSliderForTrial(gd, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, trialKey, initPos);
        }

        // ★ここが本丸：restyle で x/y/z だけ更新（レイアウト触らない→カメラ戻らない）
        function updateFrame(gd, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          // Bat line (trace 0)
          const x0 = [f.A[0], f.B[0]];
          const y0 = [f.A[1], f.B[1]];
          const z0 = [f.A[2], f.B[2]];

          // Bottom marker (trace 1)
          const x1 = [f.B[0]];
          const y1 = [f.B[1]];
          const z1 = [f.B[2]];

          // Sweet (trace 2)
          const x2 = [f.S[0]];
          const y2 = [f.S[1]];
          const z2 = [f.S[2]];

          // Ball (trace 3)
          const x3 = [f.P[0]];
          const y3 = [f.P[1]];
          const z3 = [f.P[2]];

          // S->P (trace 4)
          const x4 = [f.S[0], f.P[0]];
          const y4 = [f.S[1], f.P[1]];
          const z4 = [f.S[2], f.P[2]];

          // restyle は「配列の配列」にするのがコツ
          Plotly.restyle(gd, {
            x: [x0, x1, x2, x3, x4],
            y: [y0, y1, y2, y3, y4],
            z: [z0, z1, z2, z3, z4],
          }, DYN_IDX).then(function() {
            // 念押し：カメラ保持（restyleだけなら基本不要だが、iOS保険）
            if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

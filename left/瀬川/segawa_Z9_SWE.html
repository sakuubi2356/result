<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>segawa_vanish_Z9_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.3406982, -0.3406982, -0.3406982, -0.3406982, -0.3406982, -0.3406982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.0893752, 0.0893752, 0.0893752, 0.0893752, 0.0893752, 0.0893752], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.3406982, 0.0893752], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.3406982, 0.0893752], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.3406982, 0.0893752], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.3406982, 0.0893752], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.3406982, 0.0893752], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [0.01769632, 0.01769632, 0.01769632, -0.1256615, -0.1256615, -0.1256615, -0.2690193, -0.2690193, -0.2690193], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [0.200210303068161, -0.0235882624983788], "y": [-0.115891180932522, -0.668896734714508], "z": [-0.420543104410172, 0.112466275691986], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [-0.0235882624983788], "y": [-0.668896734714508], "z": [0.112466275691986], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.17223548105534675], "y": [-0.1850168784095651], "z": [-0.3539169287607797], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [-0.100275993347168], "z": [-0.255135715007782], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.17223548105534675, 0.154346406459808], "y": [-0.1850168784095651, -0.100275993347168], "z": [-0.3539169287607797, -0.255135715007782], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z9 (Z9)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -6, "is_min": false, "A": [-0.661496460437775, -0.0025966577231884, -0.183311462402344], "B": [0.0227826498448849, -0.356206059455872, 0.0328423902392387], "S": [-0.5759615715037437, -0.046797833016615734, -0.15629223077517437], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": -5, "is_min": false, "A": [-0.526142954826355, 0.0327899977564812, -0.271671384572983], "B": [0.0315641239285469, -0.433345019817352, 0.0625157654285431], "S": [-0.45642957496693587, -0.02547687527380131, -0.22989799380985154], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": -4, "is_min": false, "A": [-0.368149101734161, 0.0266300681978464, -0.35918715596199], "B": [0.0454732552170753, -0.496479243040085, 0.082710012793541], "S": [-0.3164463036183648, -0.038758600129423365, -0.30395000613161294], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": -3, "is_min": false, "A": [-0.192904651165009, -0.00586498901247978, -0.426574110984802], "B": [0.0465787947177887, -0.559365093708038, 0.0990543439984322], "S": [-0.16296921948103243, -0.07505250429191455, -0.3608705520298112], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": -2, "is_min": false, "A": [0.0107342544943094, -0.0187743548303843, -0.420643955469131], "B": [0.00111938116606325, -0.620890438556671, 0.106009513139725], "S": [0.00953239542223841, -0.09403885941208912, -0.354812277039659], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": -1, "is_min": true, "A": [0.200210303068161, -0.115891180932522, -0.420543104410172], "B": [-0.0235882624983788, -0.668896734714508, 0.112466275691986], "S": [0.17223548105534675, -0.1850168784095651, -0.3539169287607797], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": 0, "is_min": false, "A": [0.200210303068161, -0.115891180932522, -0.420543104410172], "B": [-0.0235882624983788, -0.668896734714508, 0.112466275691986], "S": [0.17223548105534675, -0.1850168784095651, -0.3539169287607797], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": 1, "is_min": false, "A": [0.367302805185318, -0.212561249732971, -0.365205764770508], "B": [-0.0794744119048119, -0.685433030128479, 0.100393533706665], "S": [0.3114556665373407, -0.27167020800632075, -0.3070058665173925], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": 2, "is_min": false, "A": [0.486062377691269, -0.376644253730774, -0.329088509082794], "B": [-0.110068298876286, -0.70453017950058, 0.0917666703462601], "S": [0.4115460457933112, -0.41762999298179404, -0.2764816135412322], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": 3, "is_min": false, "A": [0.552967965602875, -0.558450222015381, -0.293638586997986], "B": [-0.138423413038254, -0.712972044944763, 0.0779808387160301], "S": [0.4665440452840288, -0.5777654494320413, -0.24718615986479503], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": 4, "is_min": false, "A": [0.55425089597702, -0.732726156711578, -0.283670902252197], "B": [-0.175825625658035, -0.681115925312042, 0.0393224731087685], "S": [0.46299133533240233, -0.7262748781089727, -0.24329673234936294], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}], "2": [{"index": -6, "is_min": false, "A": [-0.680615067481995, -0.119559466838837, -0.185550540685654], "B": [0.0388844572007656, -0.351143717765808, 0.0765359997749329], "S": [-0.5906776399647485, -0.14850749399849875, -0.1527897278882961], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": -5, "is_min": false, "A": [-0.542774260044098, -0.109711326658726, -0.29506716132164], "B": [0.0754574164748192, -0.423140734434128, 0.104371793568134], "S": [-0.46549529312524973, -0.1488900063589538, -0.24513728720901573], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": -4, "is_min": false, "A": [-0.373633235692978, -0.14201931655407, -0.40482422709465], "B": [0.135868847370148, -0.466712892055511, 0.119562737643719], "S": [-0.3099454742853658, -0.18260601414478078, -0.3392758554476956], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": -3, "is_min": false, "A": [-0.234786927700043, -0.110965386033058, -0.433764010667801], "B": [0.0590773187577724, -0.578245282173157, 0.145281136035919], "S": [-0.19805389627880204, -0.16937537402692737, -0.36138336611995137], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": -2, "is_min": false, "A": [-0.0462183319032192, -0.0640534162521362, -0.417891323566437], "B": [0.00532836886122823, -0.635051548480988, 0.140054881572723], "S": [-0.039774993790171215, -0.13542818851315608, -0.3481480423226606], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": -1, "is_min": true, "A": [0.138452976942062, -0.128555700182915, -0.418511986732483], "B": [-0.0210864767432213, -0.681746661663055, 0.1369399279356], "S": [0.1185105437770678, -0.19770457541072464, -0.34908049233557004], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": 0, "is_min": false, "A": [0.138452976942062, -0.128555700182915, -0.418511986732483], "B": [-0.0210864767432213, -0.681746661663055, 0.1369399279356], "S": [0.1185105437770678, -0.19770457541072464, -0.34908049233557004], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": 1, "is_min": false, "A": [0.295806258916855, -0.199781537055969, -0.390947461128235], "B": [-0.0769944190979004, -0.696454286575317, 0.113369680941105], "S": [0.24920617217825797, -0.2618656333927869, -0.3279078156819291], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": 2, "is_min": false, "A": [0.406013756990433, -0.352864921092987, -0.392175734043121], "B": [-0.110776335000992, -0.713149845600128, 0.100899063050747], "S": [0.34141499455970714, -0.3979005373059909, -0.3305413835173496], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": 3, "is_min": false, "A": [0.470497846603394, -0.51626843214035, -0.390916526317596], "B": [-0.139985978603363, -0.716106593608856, 0.085921585559845], "S": [0.3941873909019512, -0.5412481949752384, -0.3313117798677463], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": 4, "is_min": false, "A": [0.529123842716217, -0.610110580921173, -0.343752175569534], "B": [-0.158558994531631, -0.676786482334137, 0.0595430284738541], "S": [0.44316351371931517, -0.6184450661099573, -0.29334029011201196], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}], "3": [{"index": -6, "is_min": false, "A": [-0.68637490272522, -0.0316335260868073, -0.226460456848145], "B": [0.0094805546104908, -0.329193025827408, 0.0328532457351685], "S": [-0.599392975297224, -0.06882846152791998, -0.19404624579122878], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": -5, "is_min": false, "A": [-0.556789577007294, -0.0032952856272459, -0.319448530673981], "B": [0.0365905687212944, -0.386799067258835, 0.055817749351263], "S": [-0.4826170546650606, -0.051233260997946915, -0.2725402430613538], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": -4, "is_min": false, "A": [-0.403910130262375, 0.0290615987032652, -0.387860268354416], "B": [0.0323180258274078, -0.456270962953568, 0.0749109908938408], "S": [-0.3493816081080563, -0.03160497444445716, -0.33001385814446405], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": -3, "is_min": false, "A": [-0.235084608197212, 0.0184218250215054, -0.444495141506195], "B": [0.0355042591691017, -0.513236343860626, 0.0885351002216339], "S": [-0.20126099930812733, -0.04803544700887685, -0.377866360367726], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": -2, "is_min": false, "A": [-0.0430766642093658, 0.0419616885483265, -0.424799859523773], "B": [-0.00460797362029552, -0.570290386676788, 0.0886857509613037], "S": [-0.0382680775699744, -0.03456982588028306, -0.36061415399836033], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": -1, "is_min": true, "A": [0.139609232544899, -0.0344711467623711, -0.434300631284714], "B": [-0.0199926905333996, -0.616886734962463, 0.0904082357883453], "S": [0.11965899350696851, -0.10727309037246419, -0.3687120273285216], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": 0, "is_min": false, "A": [0.139609232544899, -0.0344711467623711, -0.434300631284714], "B": [-0.0199926905333996, -0.616886734962463, 0.0904082357883453], "S": [0.11965899350696851, -0.10727309037246419, -0.3687120273285216], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": 1, "is_min": false, "A": [0.302468031644821, -0.140606507658958, -0.419616043567657], "B": [-0.0447677820920944, -0.655093431472778, 0.0850925147533417], "S": [0.2590635628612088, -0.20491736138089817, -0.3565274853089074], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": 2, "is_min": false, "A": [0.435275465250015, -0.236647665500641, -0.365505963563919], "B": [-0.089639738202095, -0.663416743278503, 0.0614976659417152], "S": [0.3696610605214507, -0.28999380371648237, -0.312130506380186], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": 3, "is_min": false, "A": [0.527208685874939, -0.398058861494064, -0.338781177997589], "B": [-0.115999937057495, -0.678480327129364, 0.045467272400856], "S": [0.44680763329936685, -0.43311153367229616, -0.29075013680644385], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": 4, "is_min": false, "A": [0.573859393596649, -0.543615281581879, -0.310701131820679], "B": [-0.150359332561493, -0.657877504825592, 0.00937915220856667], "S": [0.48333205333630685, -0.5578980594069695, -0.27069109654217227], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}], "4": [{"index": -6, "is_min": false, "A": [-0.487372756004333, 0.0985162705183029, -0.290056109428406], "B": [0.00291704572737217, -0.435617834329605, 0.0480514578521252], "S": [-0.4260865335982333, 0.03174951047399538, -0.24779266545638753], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": -5, "is_min": false, "A": [-0.36004051566124, 0.102218478918076, -0.341706514358521], "B": [0.0122483856976032, -0.480618715286255, 0.0604153722524643], "S": [-0.3135044114520304, 0.029363842888105576, -0.2914412876707787], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": -4, "is_min": false, "A": [-0.223816737532616, 0.0898924469947815, -0.380745500326157], "B": [0.0155244739726186, -0.525522232055664, 0.070896290242672], "S": [-0.19389908024424493, 0.012965597070896062, -0.324290265465574], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": -3, "is_min": false, "A": [-0.0806994363665581, 0.0882135778665543, -0.373882442712784], "B": [-0.0060769347473979, -0.568344175815582, 0.0770758241415024], "S": [-0.07137162337348697, 0.006143856098805939, -0.317512657599386], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": -2, "is_min": false, "A": [0.060949083417654, 0.0401198714971542, -0.381526410579681], "B": [-0.0132989091798663, -0.606522858142853, 0.0835974961519241], "S": [0.051668083130736994, -0.040710480265408334, -0.3233859146442777], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": -1, "is_min": true, "A": [0.196153745055199, -0.0262090880423784, -0.373219072818756], "B": [-0.0297230202704668, -0.639994382858276, 0.0874838903546333], "S": [0.1679191476584224, -0.10293225459827714, -0.3156311988913591], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": 0, "is_min": false, "A": [0.196153745055199, -0.0262090880423784, -0.373219072818756], "B": [-0.0297230202704668, -0.639994382858276, 0.0874838903546333], "S": [0.1679191476584224, -0.10293225459827714, -0.3156311988913591], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": 1, "is_min": false, "A": [0.313417822122574, -0.0954912230372429, -0.343389749526978], "B": [-0.0610202327370644, -0.65910279750824, 0.0833870992064476], "S": [0.2666130777861026, -0.16594265099928546, -0.2900426577064609], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": 2, "is_min": false, "A": [0.417825102806091, -0.208156675100327, -0.330725759267807], "B": [-0.0791109800338745, -0.680990695953369, 0.0809567719697952], "S": [0.35570809187993824, -0.2672609282504124, -0.27926544238993645], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": 3, "is_min": false, "A": [0.495126664638519, -0.306549042463303, -0.293729722499847], "B": [-0.110200211405754, -0.681989550590515, 0.0704455375671387], "S": [0.4194607946136072, -0.35347911250361413, -0.24820780866283176], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}, {"index": 4, "is_min": false, "A": [0.552811205387115, -0.432583630084991, -0.264399439096451], "B": [-0.12813438475132, -0.691493332386017, 0.0661739110946655], "S": [0.46769299801031405, -0.46494734614612926, -0.22307776614297622], "P": [0.154346406459808, -0.100275993347168, -0.255135715007782]}]};

    const STATIC_COUNT  = 8;
    const DYNAMIC_COUNT = 5;

    let currentTrial = "1";
    let currentCamera = null;

    // restyle対象トレース（動的5本）
    function dynamicTraceIndices() {
      const arr = [];
      for (let i = 0; i < DYNAMIC_COUNT; i++) arr.push(STATIC_COUNT + i);
      return arr;
    }
    const DYN_IDX = dynamicTraceIndices();

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        // 初期 camera 保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ユーザー操作で camera 変化を保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey && gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
          }
        });

        // 端末回転/リサイズ：Plotlyが勝手に変えることがあるので再適用
        let resizeTimer = null;
        function handleResize() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function() {
            Plotly.Plots.resize(gd).then(function() {
              if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
            });
          }, 150);
        }
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, currentTrial);
          });
        });

        // Slider
        slider.addEventListener("input", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init
        updateSliderForTrial(gd, currentTrial);

        function updateSliderForTrial(gd, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, trialKey, initPos);
        }

        // ★ここが本丸：restyle で x/y/z だけ更新（レイアウト触らない→カメラ戻らない）
        function updateFrame(gd, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          // Bat line (trace 0)
          const x0 = [f.A[0], f.B[0]];
          const y0 = [f.A[1], f.B[1]];
          const z0 = [f.A[2], f.B[2]];

          // Bottom marker (trace 1)
          const x1 = [f.B[0]];
          const y1 = [f.B[1]];
          const z1 = [f.B[2]];

          // Sweet (trace 2)
          const x2 = [f.S[0]];
          const y2 = [f.S[1]];
          const z2 = [f.S[2]];

          // Ball (trace 3)
          const x3 = [f.P[0]];
          const y3 = [f.P[1]];
          const z3 = [f.P[2]];

          // S->P (trace 4)
          const x4 = [f.S[0], f.P[0]];
          const y4 = [f.S[1], f.P[1]];
          const z4 = [f.S[2], f.P[2]];

          // restyle は「配列の配列」にするのがコツ
          Plotly.restyle(gd, {
            x: [x0, x1, x2, x3, x4],
            y: [y0, y1, y2, y3, y4],
            z: [z0, z1, z2, z3, z4],
          }, DYN_IDX).then(function() {
            // 念押し：カメラ保持（restyleだけなら基本不要だが、iOS保険）
            if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>segawa_vanish_Z7_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }
    #frameSlider::-moz-range-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-moz-range-thumb {
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.3406982, -0.3406982, -0.3406982, -0.3406982, -0.3406982, -0.3406982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.0893752, 0.0893752, 0.0893752, 0.0893752, 0.0893752, 0.0893752], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.3406982, 0.0893752], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.3406982, 0.0893752], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.3406982, 0.0893752], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.3406982, 0.0893752], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.3406982, 0.0893752], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [0.01769632, 0.01769632, 0.01769632, -0.1256615, -0.1256615, -0.1256615, -0.2690193, -0.2690193, -0.2690193], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [0.129433065652847, -0.0460240468382835], "y": [0.0544807463884354, -0.497145682573318], "z": [-0.458907693624496, 0.0932906940579414], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [-0.0460240468382835], "y": [-0.497145682573318], "z": [0.0932906940579414], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.10750092615987068], "y": [-0.014472558588660651], "z": [-0.38988289380590757], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [0.100275993347168], "z": [-0.269019305706024], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.10750092615987068, 0.154346406459808], "y": [-0.014472558588660651, 0.100275993347168], "z": [-0.38988289380590757, -0.269019305706024], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z7 (Z7)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -6, "is_min": false, "A": [-0.815099716186523, -0.0677617788314819, -0.274495422840118], "B": [-0.0509370490908623, -0.0381961092352867, -0.0395884811878204], "S": [-0.719579381444211, -0.06406607007951846, -0.24513205471693894], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": -5, "is_min": false, "A": [-0.664730250835419, -0.00580086559057236, -0.362312227487564], "B": [-0.0349509604275227, -0.245271444320679, 0.0690019652247429], "S": [-0.5860078423351707, -0.03573468686686812, -0.3083979553166553], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": -4, "is_min": false, "A": [-0.484485030174255, 0.0384383276104927, -0.44813084602356], "B": [-0.00482756830751896, -0.309119433164597, 0.0895793586969376], "S": [-0.42452784472691313, -0.005006394452946282, -0.3809170673910237], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": -3, "is_min": false, "A": [-0.284306019544601, 0.0582332350313663, -0.500379979610443], "B": [0.00827404577285051, -0.375897854566574, 0.104539029300213], "S": [-0.24773350866321361, 0.003966844800568151, -0.42476509787973116], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": -2, "is_min": false, "A": [-0.0849793776869774, 0.117991290986538, -0.467082172632217], "B": [-0.0302755255252123, -0.444106251001358, 0.099533885717392], "S": [-0.07814139571657082, 0.04772909361226324, -0.39625516067554295], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": -1, "is_min": true, "A": [0.129433065652847, 0.0544807463884354, -0.458907693624496], "B": [-0.0460240468382835, -0.497145682573318, 0.0932906940579414], "S": [0.10750092615987068, -0.014472558588660651, -0.38988289380590757], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": 0, "is_min": false, "A": [0.129433065652847, 0.0544807463884354, -0.458907693624496], "B": [-0.0460240468382835, -0.497145682573318, 0.0932906940579414], "S": [0.10750092615987068, -0.014472558588660651, -0.38988289380590757], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": 1, "is_min": false, "A": [0.298589169979095, -0.00956420041620731, -0.405260026454926], "B": [-0.0994424745440483, -0.522116243839264, 0.0625660419464111], "S": [0.2488352150952847, -0.07363320496640403, -0.3467817687058562], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": 2, "is_min": false, "A": [0.427444338798523, -0.156790941953659, -0.38300496339798], "B": [-0.130532488226891, -0.544154644012451, 0.0396189801394939], "S": [0.3576972231503676, -0.20521141322918318, -0.3301769611622436], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": 3, "is_min": false, "A": [0.49425134062767, -0.352559745311737, -0.394200801849365], "B": [-0.168566673994064, -0.548892736434937, 0.00844788365066051], "S": [0.4113991100208262, -0.3771013629163129, -0.34386972905311763], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": 4, "is_min": false, "A": [0.557704389095306, -0.451457113027573, -0.303220719099045], "B": [-0.190468549728394, -0.494084626436234, -0.0231847316026688], "S": [0.46418277215008075, -0.4567855521804246, -0.2682162208146113], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}], "2": [{"index": -6, "is_min": false, "A": [-0.744596481323242, -0.0304326564073563, -0.173384442925453], "B": [-0.0176104232668877, -0.208986088633537, 0.108767725527287], "S": [-0.6537232171747843, -0.052751837128213616, -0.1381154191942188], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": -5, "is_min": false, "A": [-0.605037569999695, 0.0338122397661209, -0.267414480447769], "B": [0.0230313837528229, -0.26431792974472, 0.128373101353645], "S": [-0.5265289519183034, -0.003454030882706481, -0.2179410334395149], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": -4, "is_min": false, "A": [-0.446015149354935, 0.132670029997826, -0.305806338787079], "B": [0.0268194172531366, -0.335013657808304, 0.13882765173912], "S": [-0.3869108259777727, 0.07420956649869767, -0.25022708757230544], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": -3, "is_min": false, "A": [-0.254156768321991, 0.169367372989655, -0.341586828231812], "B": [0.0369070470333099, -0.393224239349365, 0.147056683897972], "S": [-0.21777378994811009, 0.09904341863596383, -0.2805063867737997], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": -2, "is_min": false, "A": [-0.0422052554786205, 0.164540976285934, -0.357143759727478], "B": [0.0348400138318539, -0.44919416308403, 0.15019553899765], "S": [-0.03257459650521182, 0.08782408139844991, -0.29372634534814035], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": -1, "is_min": true, "A": [0.149116918444633, 0.153640553355217, -0.322893023490906], "B": [0.00485049514099956, -0.487083494663239, 0.133899837732315], "S": [0.13108361306148886, 0.07355003638216509, -0.2657939080166051], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": 0, "is_min": false, "A": [0.149116918444633, 0.153640553355217, -0.322893023490906], "B": [0.00485049514099956, -0.487083494663239, 0.133899837732315], "S": [0.13108361306148886, 0.07355003638216509, -0.2657939080166051], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": 1, "is_min": false, "A": [0.342939049005508, 0.059378731995821, -0.30041366815567], "B": [-0.0104179121553898, -0.520413875579834, 0.122645974159241], "S": [0.29876943130200456, -0.013095339944912993, -0.24753121578954315], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": 2, "is_min": false, "A": [0.502112567424774, -0.0388541482388973, -0.232692420482635], "B": [-0.03956039249897, -0.526604056358337, 0.0969899818301201], "S": [0.4344034503319271, -0.09982288414466164, -0.19148212195714112], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": 3, "is_min": false, "A": [0.619409441947937, -0.209116593003273, -0.196878582239151], "B": [-0.0572581849992275, -0.535361886024475, 0.0782303288578987], "S": [0.5348259873598085, -0.2498972552189995, -0.16248996785611988], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": 4, "is_min": false, "A": [0.684594690799713, -0.384107887744904, -0.163168877363205], "B": [-0.0684451162815094, -0.533600389957428, 0.0617386549711227], "S": [0.5904647411950062, -0.40279444530430886, -0.13505544367049482], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}], "3": [{"index": -6, "is_min": false, "A": [-0.793264865875244, -0.123773902654648, -0.0315302908420563], "B": [0.00136568769812584, -0.148852497339249, 0.0575395300984383], "S": [-0.6939360533201041, -0.12690872678061593, -0.020396563968941066], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": -5, "is_min": false, "A": [-0.652113974094391, -0.0462527275085449, -0.182075873017311], "B": [0.0791960209608078, -0.226703703403473, 0.0874111875891685], "S": [-0.56070023466826, -0.06880909703882174, -0.14838999411019277], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": -4, "is_min": false, "A": [-0.451824247837067, -0.0041975574567914, -0.326492846012115], "B": [0.169850289821625, -0.266670972108841, 0.103191211819649], "S": [-0.3741149253920628, -0.03700673649966132, -0.27278233516301503], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": -3, "is_min": false, "A": [-0.27655017375946, 0.106248714029789, -0.34149158000946], "B": [0.0517319291830063, -0.445530414581299, 0.13576178252697], "S": [-0.2355149146725207, 0.037276329308317174, -0.28183491518899717], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": -2, "is_min": false, "A": [-0.0239566937088966, 0.0979586765170097, -0.369482010602951], "B": [0.0356857366859913, -0.517742574214935, 0.137819454073906], "S": [-0.01650139005933814, 0.020996021721959343, -0.30606932879252136], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": -1, "is_min": true, "A": [0.233539164066315, 0.0238739848136902, -0.347470194101334], "B": [0.00155365839600563, -0.574247241020203, 0.130477130413055], "S": [0.20454097405974295, -0.05089117305071705, -0.28772677483315845], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": 0, "is_min": false, "A": [0.233539164066315, 0.0238739848136902, -0.347470194101334], "B": [0.00155365839600563, -0.574247241020203, 0.130477130413055], "S": [0.20454097405974295, -0.05089117305071705, -0.28772677483315845], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": 1, "is_min": false, "A": [0.431609451770782, -0.0852767452597618, -0.281994819641113], "B": [-0.0791635513305664, -0.573691070079803, 0.0929218158125877], "S": [0.3677628312178243, -0.1463285312391917, -0.23513024375816574], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": 2, "is_min": false, "A": [0.554486811161041, -0.304140090942383, -0.279634863138199], "B": [-0.115485176444054, -0.578054368495941, 0.0611120387911797], "S": [0.47074030922953825, -0.33837937705971016, -0.23704149862666268], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": 3, "is_min": false, "A": [0.591185927391052, -0.498972415924072, -0.296831965446472], "B": [-0.147472754120827, -0.520111799240112, 0.00965866353362799], "S": [0.4988535941462735, -0.5016148387829366, -0.25852063763066635], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": 4, "is_min": false, "A": [0.488603323698044, -0.780238628387451, -0.390575677156448], "B": [-0.16288360953331, -0.488438010215759, -0.029442647472024], "S": [0.4071674500499044, -0.7437635479832823, -0.34543404456885024], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}], "4": [{"index": -6, "is_min": false, "A": [-0.955301284790039, -0.290636152029037, 0.164200320839882], "B": [-0.173758566379547, -0.124353982508183, 0.124942049384117], "S": [-0.8576084444146842, -0.2698508807167959, 0.15929303687907617], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": -5, "is_min": false, "A": [-0.860403299331665, -0.157926753163338, 0.00370120629668236], "B": [-0.0777652263641357, -0.188405200839043, 0.166639670729637], "S": [-0.7625735579593927, -0.1617365584316108, 0.02406851065568265], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": -4, "is_min": false, "A": [-0.681870877742767, -0.0495099164545536, -0.157849296927452], "B": [-0.00420800969004631, -0.266437083482742, 0.207822427153587], "S": [-0.5971630303755701, -0.07662580876723768, -0.11214033742821825], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": -3, "is_min": false, "A": [-0.478705704212189, 0.0463833063840866, -0.255387187004089], "B": [-0.0196853931993246, -0.382585406303406, 0.239876553416252], "S": [-0.42132816421323405, -0.007237783750717965, -0.19347921824058095], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": -2, "is_min": false, "A": [-0.199034690856934, 0.0596937611699104, -0.324183970689774], "B": [-0.0218892171978951, -0.466964691877365, 0.251359492540359], "S": [-0.17689150531873082, -0.006138549417573982, -0.2522410334621788], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": -1, "is_min": true, "A": [0.0883682072162628, 0.0206216461956501, -0.309201776981354], "B": [-0.0470850989222527, -0.540533721446991, 0.244654625654221], "S": [0.07143654209067714, -0.04952278245811796, -0.23996971905360298], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": 0, "is_min": false, "A": [0.0883682072162628, 0.0206216461956501, -0.309201776981354], "B": [-0.0470850989222527, -0.540533721446991, 0.244654625654221], "S": [0.07143654209067714, -0.04952278245811796, -0.23996971905360298], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": 1, "is_min": false, "A": [0.323718398809433, -0.0167331993579865, -0.189936965703964], "B": [-0.11388149112463, -0.565980195999146, 0.193252354860306], "S": [0.26901841181487274, -0.08538907488300015, -0.1420382999742303], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": 2, "is_min": false, "A": [0.517124354839325, -0.238066136837006, -0.139123573899269], "B": [-0.141323775053024, -0.588864624500275, 0.149643570184708], "S": [0.43481833745872667, -0.2819159484044276, -0.10302768038703851], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": 3, "is_min": false, "A": [0.613270878791809, -0.431281596422195, -0.075498603284359], "B": [-0.163968428969383, -0.550400972366333, 0.0718434825539589], "S": [0.5161159696870732, -0.4461715177461708, -0.057080843382125296], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}, {"index": 4, "is_min": false, "A": [0.624944031238556, -0.639707088470459, -0.0686271637678146], "B": [-0.161903262138367, -0.531758666038513, 0.0273854248225689], "S": [0.5265881151225944, -0.6262135350568097, -0.05662558965177016], "P": [0.154346406459808, 0.100275993347168, -0.269019305706024]}]};
    const STATIC_COUNT = 8;

    let currentTrial = "1";
    let currentCamera = null; // ★ユーザー操作のカメラを保存

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        const staticTraces = (STATIC_COUNT > 0) ? gd.data.slice(0, STATIC_COUNT) : [];

        // ★初期カメラを保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ★ユーザーが回転/ズームしたらカメラを保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey) {
            if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
              currentCamera = gd.layout.scene.camera;
            }
          }
        });

        // trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, staticTraces, currentTrial);
          });
        });

        // Safari対策：input + change
        slider.addEventListener("input", function() {
          updateFrame(gd, staticTraces, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, staticTraces, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, staticTraces, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, staticTraces, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init draw
        updateSliderForTrial(gd, staticTraces, currentTrial);

        function updateSliderForTrial(gd, staticTraces, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, staticTraces, trialKey, initPos);
        }

        function dynamicTracesFromFrame(f) {
          const bat = {
            type: "scatter3d",
            mode: "lines",
            x: [f.A[0], f.B[0]],
            y: [f.A[1], f.B[1]],
            z: [f.A[2], f.B[2]],
            line: {width: 4},
            showlegend: false
          };
          const bottom = {
            type: "scatter3d",
            mode: "markers",
            x: [f.B[0]],
            y: [f.B[1]],
            z: [f.B[2]],
            marker: {
              size: 10,
              color: "white",
              symbol: "circle",
              line: {width: 3, color: "red"}
            },
            showlegend: false
          };
          const sweet = {
            type: "scatter3d",
            mode: "markers",
            x: [f.S[0]],
            y: [f.S[1]],
            z: [f.S[2]],
            marker: {size: 7, color: "orange"},
            showlegend: false
          };
          const ball = {
            type: "scatter3d",
            mode: "markers",
            x: [f.P[0]],
            y: [f.P[1]],
            z: [f.P[2]],
            marker: {size: 7, color: "blue", symbol: "x"},
            showlegend: false
          };
          const sp = {
            type: "scatter3d",
            mode: "lines",
            x: [f.S[0], f.P[0]],
            y: [f.S[1], f.P[1]],
            z: [f.S[2], f.P[2]],
            line: {width: 3, dash: "dash"},
            showlegend: false
          };
          return [bat, bottom, sweet, ball, sp];
        }

        function updateFrame(gd, staticTraces, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          const dyn = dynamicTracesFromFrame(f);
          const newData = staticTraces.concat(dyn);

          // ★react前に「現在のカメラ」をlayoutへ注入（向きが戻るのを防ぐ）
          const layout2 = JSON.parse(JSON.stringify(gd.layout));
          layout2.scene = layout2.scene || {};
          layout2.uirevision = "KEEP_CAMERA_FOREVER";

          if (currentCamera) {
            layout2.scene.camera = currentCamera;
          } else if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
            layout2.scene.camera = currentCamera;
          }

          Plotly.react(gd, newData, layout2).then(function() {
            // ★念押し：react後にSafariがcameraを落とす場合があるので再適用
            if (currentCamera) {
              Plotly.relayout(gd, {'scene.camera': currentCamera});
            }
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

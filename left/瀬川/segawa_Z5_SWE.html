<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>segawa_vanish_Z5_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    /* Slider: big for iPhone */
    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px;
      border-radius: 999px;
      background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }
    #frameSlider::-moz-range-track {
      height: 10px;
      border-radius: 999px;
      background: #d0d0d0;
    }
    #frameSlider::-moz-range-thumb {
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
          <button class="trial-btn" id="trialBtn_5" data-trial="5">5球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.3406982, -0.3406982, -0.3406982, -0.3406982, -0.3406982, -0.3406982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.0893752, 0.0893752, 0.0893752, 0.0893752, 0.0893752, 0.0893752], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.3406982, 0.0893752], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.3406982, 0.0893752], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.3406982, 0.0893752], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.3406982, 0.0893752], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.3406982, 0.0893752], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [0.01769632, 0.01769632, 0.01769632, -0.1256615, -0.1256615, -0.1256615, -0.2690193, -0.2690193, -0.2690193], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [0.212151646614075, -0.0094160633161664], "y": [0.0871462970972061, -0.604914605617523], "z": [-0.209289088845253, 0.125314459204674], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [-0.0094160633161664], "y": [-0.604914605617523], "z": [0.125314459204674], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.1844556845500808], "y": [0.0006386894968234413], "z": [-0.16746364787198875], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [-0.0], "z": [-0.10757851600647], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.1844556845500808, 0.154346406459808], "y": [0.0006386894968234413, -0.0], "z": [-0.16746364787198875, -0.10757851600647], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z5 (Z5)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "Z5_keep_camera"}};
    const trialInfo = {"1": [{"index": -4, "is_min": false, "A": [-0.257215470075607, 0.213094845414162, -0.161958515644073], "B": [0.0214146301150322, -0.482476860284805, 0.11830073595047], "S": [-0.22238670696963472, 0.12614838074853185, -0.12692610860920894], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -3, "is_min": false, "A": [-0.13939157128334, 0.201533898711205, -0.187248632311821], "B": [0.0216643027961254, -0.518108367919922, 0.122873961925507], "S": [-0.1192595871799641, 0.1115786160818554, -0.14848330833361528], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -2, "is_min": false, "A": [-0.0188492462038994, 0.187645435333252, -0.189845234155655], "B": [0.00878999847918749, -0.548129737377167, 0.122998088598251], "S": [-0.015394340557014607, 0.09567353710730693, -0.15073981811532208], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -1, "is_min": false, "A": [0.0995699465274811, 0.145521968603134, -0.201593354344368], "B": [0.00128466309979558, -0.578208804130554, 0.12483237683773], "S": [0.08728428596769754, 0.055055621044417524, -0.16079013751045534], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 0, "is_min": false, "A": [0.0995699465274811, 0.145521968603134, -0.201593354344368], "B": [0.00128466309979558, -0.578208804130554, 0.12483237683773], "S": [0.08728428596769754, 0.055055621044417524, -0.16079013751045534], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 1, "is_min": true, "A": [0.212151646614075, 0.0871462970972061, -0.209289088845253], "B": [-0.0094160633161664, -0.604914605617523, 0.125314459204674], "S": [0.1844556845500808, 0.0006386894968234413, -0.16746364787198875], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 2, "is_min": false, "A": [0.315664231777191, 0.0271795466542244, -0.200226128101349], "B": [-0.0299853440374136, -0.619167387485504, 0.120338954031467], "S": [0.27245803346419556, -0.053613822611810635, -0.16015549159554568], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 3, "is_min": false, "A": [0.408156245946884, -0.0599239692091942, -0.201081842184067], "B": [-0.0457611717283726, -0.636479258537292, 0.117576405405998], "S": [0.35141657328012366, -0.13199337460524274, -0.16124956442432917], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 4, "is_min": false, "A": [0.488535642623901, -0.140950277447701, -0.174945846199989], "B": [-0.0688804388046265, -0.638416945934296, 0.111085817217827], "S": [0.41885862627063647, -0.20313361651914272, -0.13919188510428632], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 5, "is_min": false, "A": [0.548906981945038, -0.240682289004326, -0.167689323425293], "B": [-0.085442416369915, -0.644409835338593, 0.10544952750206], "S": [0.4696133023669217, -0.2911482353438763, -0.13354696499742996], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 6, "is_min": false, "A": [0.593178510665894, -0.352492302656174, -0.161839842796326], "B": [-0.103775069117546, -0.645789682865143, 0.0993733182549477], "S": [0.5060593105465001, -0.3891544762960005, -0.12918819667304127], "P": [0.154346406459808, -0.0, -0.10757851600647]}], "2": [{"index": -6, "is_min": false, "A": [-0.576185286045074, -0.00699064508080482, -0.172558575868607], "B": [0.0485129877924919, -0.36522850394249, 0.175892025232315], "S": [-0.4980980090302173, -0.051770373301112504, -0.12900225475535856], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -5, "is_min": false, "A": [-0.426647067070007, 0.0104740895330906, -0.251371026039124], "B": [0.0953522771596909, -0.402874648571014, 0.192092061042786], "S": [-0.36139714925910243, -0.04119450255744998, -0.19593814033892315], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -4, "is_min": false, "A": [-0.282248497009277, 0.0671123787760735, -0.253274112939835], "B": [0.0649197101593018, -0.490631937980652, 0.203229442238808], "S": [-0.2388524705312169, -0.0026056617535117205, -0.19621116777722863], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -3, "is_min": false, "A": [-0.114305086433887, 0.0645274370908737, -0.273293644189835], "B": [0.0678936615586281, -0.545518279075623, 0.211110949516296], "S": [-0.09153024240080118, -0.011728279217971968, -0.212743068556787], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -2, "is_min": false, "A": [0.055484302341938, 0.0721248537302017, -0.230484798550606], "B": [0.0394744351506233, -0.598110616207123, 0.206010416150093], "S": [0.053483068901539026, -0.011654581748672399, -0.1759228955819759], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -1, "is_min": true, "A": [0.222612172365189, 0.0156493373215199, -0.20972116291523], "B": [0.026730589568615, -0.641146540641785, 0.202891692519188], "S": [0.1981269704651949, -0.06645016100506124, -0.158144547453955], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 0, "is_min": false, "A": [0.222612172365189, 0.0156493373215199, -0.20972116291523], "B": [0.026730589568615, -0.641146540641785, 0.202891692519188], "S": [0.1981269704651949, -0.06645016100506124, -0.158144547453955], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 1, "is_min": false, "A": [0.377671539783478, -0.0731834694743156, -0.176837533712387], "B": [0.00964093580842018, -0.678606390953064, 0.194668143987656], "S": [0.33166771097566694, -0.14886134010575028, -0.1303993206576898], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 2, "is_min": false, "A": [0.500451683998108, -0.1567352861166, -0.112004771828651], "B": [-0.0244020652025938, -0.690879464149475, 0.16945318877697], "S": [0.4348449676321962, -0.2235033060461013, -0.07682252797786006], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 3, "is_min": false, "A": [0.600398421287537, -0.305517613887787, -0.0937978699803352], "B": [-0.0464151874184608, -0.708111107349396, 0.150232374668121], "S": [0.5195467281384231, -0.35584179562896495, -0.06329409239456033], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 4, "is_min": false, "A": [0.658332705497742, -0.47231251001358, -0.095410019159317], "B": [-0.0709634050726891, -0.71499091386795, 0.126478880643845], "S": [0.5671707136440769, -0.5026473031854901, -0.06767391336759265], "P": [0.154346406459808, -0.0, -0.10757851600647]}], "3": [{"index": -6, "is_min": false, "A": [-0.831400156021118, -0.0669803768396378, 0.0176915973424911], "B": [-0.0363118387758732, -0.102704137563705, 0.098674438893795], "S": [-0.7320141039364493, -0.07144584748858868, 0.027814453802347486], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -5, "is_min": false, "A": [-0.707385897636414, 0.0021162498742342, -0.116961993277073], "B": [0.0320345051586628, -0.177136272192001, 0.130274951457977], "S": [-0.6149583549107606, -0.020290313535877322, -0.08605737773430724], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -4, "is_min": false, "A": [-0.502158641815186, 0.0577752590179443, -0.255519688129425], "B": [0.0662412792444229, -0.301838874816895, 0.177607402205467], "S": [-0.4311086445719798, 0.012823487789770986, -0.20137879641908868], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -3, "is_min": false, "A": [-0.295179784297943, 0.0569925457239151, -0.346512615680695], "B": [0.0758746415376663, -0.390681505203247, 0.202947720885277], "S": [-0.24879798484661247, 0.0010332939162906868, -0.27783007920461955], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -2, "is_min": false, "A": [-0.07282904535532, 0.0766061320900917, -0.354451864957809], "B": [0.0267675723880529, -0.482093960046768, 0.209405049681664], "S": [-0.060379467159001575, 0.0067686150845409215, -0.28396974508877304], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -1, "is_min": true, "A": [0.161879166960716, 0.00101631134748459, -0.346846073865891], "B": [0.000185717828571796, -0.55070024728775, 0.209448844194412], "S": [0.14166748532060539, -0.06794826018317472, -0.2773092073929805], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 0, "is_min": false, "A": [0.161879166960716, 0.00101631134748459, -0.346846073865891], "B": [0.000185717828571796, -0.55070024728775, 0.209448844194412], "S": [0.14166748532060539, -0.06794826018317472, -0.2773092073929805], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 1, "is_min": false, "A": [0.369782209396362, -0.136973768472672, -0.303157925605774], "B": [-0.0406755283474922, -0.606069326400757, 0.198313549160957], "S": [0.3184749856425764, -0.19561072068318863, -0.24047398327489813], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 2, "is_min": false, "A": [0.516266226768494, -0.280239522457123, -0.217767477035522], "B": [-0.113141149282455, -0.606804132461548, 0.152640223503113], "S": [0.43759030194411364, -0.32106010016978626, -0.17146651280978617], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 3, "is_min": false, "A": [0.593780040740967, -0.496635645627975, -0.163263782858849], "B": [-0.143184125423431, -0.61606377363205, 0.124174378812313], "S": [0.5016595168580276, -0.5115641621328602, -0.12733401143602824], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 4, "is_min": false, "A": [0.601344168186188, -0.664329051971436, -0.133540213108063], "B": [-0.166328132152557, -0.569033980369568, 0.0704163238406181], "S": [0.505385144163802, -0.6524171696995036, -0.10804564958148402], "P": [0.154346406459808, -0.0, -0.10757851600647]}], "4": [{"index": -6, "is_min": false, "A": [-0.740063786506653, 0.0740099996328354, -0.0136939361691475], "B": [0.00399263203144073, -0.193280830979347, 0.108518369495869], "S": [-0.6470567479771784, 0.040598650759363156, 0.001582599774316287], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -5, "is_min": false, "A": [-0.578066349029541, 0.127505242824554, -0.139425233006477], "B": [0.0871713608503342, -0.232808262109756, 0.12063805013895], "S": [-0.4949116316386494, 0.0824660527276118, -0.10691732118408434], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -4, "is_min": false, "A": [-0.410416930913925, 0.130978584289551, -0.223649010062218], "B": [0.0458007529377937, -0.391515225172043, 0.174930468201637], "S": [-0.353389718493437, 0.0656668558861408, -0.1738265735851877], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -3, "is_min": false, "A": [-0.20932474732399, 0.0833297520875931, -0.319579720497131], "B": [0.0474158301949501, -0.476954847574234, 0.190484374761581], "S": [-0.1772321735805175, 0.013294173739434686, -0.2558217055032595], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -2, "is_min": false, "A": [0.00557899056002498, 0.0561513006687164, -0.324740767478943], "B": [-0.0213467627763748, -0.560247182846069, 0.184501737356186], "S": [0.002213271433476221, -0.020898508843456745, -0.2610854551405449], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -1, "is_min": true, "A": [0.213834941387177, -0.0666956752538681, -0.329651564359665], "B": [-0.059264499694109, -0.621730029582977, 0.177648738026619], "S": [0.1796975122122823, -0.13607496759340754, -0.26623902834513724], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 0, "is_min": false, "A": [0.213834941387177, -0.0666956752538681, -0.329651564359665], "B": [-0.059264499694109, -0.621730029582977, 0.177648738026619], "S": [0.1796975122122823, -0.13607496759340754, -0.26623902834513724], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 1, "is_min": false, "A": [0.388350903987885, -0.187071189284325, -0.257033973932266], "B": [-0.143207013607025, -0.632455945014954, 0.141812771558762], "S": [0.32190617086986417, -0.24274427823624078, -0.20717813568410234], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 2, "is_min": false, "A": [0.48005485534668, -0.407540857791901, -0.255861788988113], "B": [-0.189013481140137, -0.6449134349823, 0.112922422587872], "S": [0.39642131158695415, -0.4372124305434286, -0.20976376160471158], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 3, "is_min": false, "A": [0.488056778907776, -0.634042322635651, -0.277336627244949], "B": [-0.229171991348267, -0.638154923915863, 0.077016718685627], "S": [0.3984032047691137, -0.6345563976687072, -0.23304246994374544], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 4, "is_min": false, "A": [0.486985564231873, -0.760254621505737, -0.22219155728817], "B": [-0.246313810348511, -0.562959790229797, 0.0294966213405132], "S": [0.3953231540439773, -0.7355927707265577, -0.19073053895291192], "P": [0.154346406459808, -0.0, -0.10757851600647]}], "5": [{"index": -6, "is_min": false, "A": [-0.888732492923737, -0.17580509185791, 0.0758704990148544], "B": [-0.111699089407921, -0.0239348188042641, 0.190565720200539], "S": [-0.7916033541944838, -0.1568213149011747, 0.09020739624439543], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -5, "is_min": false, "A": [-0.749114394187927, -0.0596114210784435, -0.0660786181688309], "B": [-0.00755782425403595, -0.0815418809652328, 0.233276233077049], "S": [-0.6564198532491469, -0.06235272766812619, -0.028659273995927922], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -4, "is_min": false, "A": [-0.601312756538391, 0.0163561757653952, -0.137491911649704], "B": [0.023940309882164, -0.206224232912064, 0.30918088555336], "S": [-0.5231561246497569, -0.011466374815948109, -0.08165781300941835], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -3, "is_min": false, "A": [-0.358017653226852, 0.0340595841407776, -0.23430123925209], "B": [0.0508896932005882, -0.314138174057007, 0.35861799120903], "S": [-0.30690423934101435, -0.009465131872223441, -0.16018634184999767], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -2, "is_min": false, "A": [-0.0935393050312996, -0.0322331860661507, -0.288442611694336], "B": [0.0525909140706062, -0.413294196128845, 0.399626076221466], "S": [-0.07527302840867497, -0.07986581032881523, -0.20243402930747428], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": -1, "is_min": true, "A": [0.113859713077545, -0.0467538014054298, -0.248853951692581], "B": [-0.0496601313352585, -0.507446527481079, 0.384410172700882], "S": [0.09341973218452693, -0.1043403931267791, -0.16969593482118836], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 0, "is_min": false, "A": [0.113859713077545, -0.0467538014054298, -0.248853951692581], "B": [-0.0496601313352585, -0.507446527481079, 0.384410172700882], "S": [0.09341973218452693, -0.1043403931267791, -0.16969593482118836], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 1, "is_min": false, "A": [0.332471698522568, -0.164111271500587, -0.172290697693825], "B": [-0.103416204452515, -0.566259860992432, 0.36462476849556], "S": [0.27798570936616096, -0.21437984637216262, -0.10517626283791123], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 2, "is_min": false, "A": [0.497874557971954, -0.338236451148987, -0.0471892133355141], "B": [-0.159616410732269, -0.598672926425934, 0.326814293861389], "S": [0.41568819683476, -0.3707910066170149, -0.00043878059627822097], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 3, "is_min": false, "A": [0.583995521068573, -0.444487690925598, 0.0981288254261017], "B": [-0.193493127822876, -0.556940078735352, 0.249343931674957], "S": [0.48680945112116464, -0.45854423778710424, 0.1170307115358986], "P": [0.154346406459808, -0.0, -0.10757851600647]}, {"index": 4, "is_min": false, "A": [0.584392964839935, -0.699387073516846, 0.161658063530922], "B": [-0.19980788230896, -0.546059012413025, 0.200636103749275], "S": [0.48636783984751675, -0.6802210621446427, 0.16653031950750613], "P": [0.154346406459808, -0.0, -0.10757851600647]}]};
    const STATIC_COUNT = 8;

    let currentTrial = "1";

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        // 静的トレース（StrikeZone）は先頭 STATIC_COUNT 本
        const staticTraces = (STATIC_COUNT > 0) ? gd.data.slice(0, STATIC_COUNT) : [];

        // trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, staticTraces, currentTrial);
          });
        });

        // Safari対策：input + change 両方で更新
        slider.addEventListener("input", function() {
          updateFrame(gd, staticTraces, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, staticTraces, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, staticTraces, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, staticTraces, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init draw
        updateSliderForTrial(gd, staticTraces, currentTrial);

        function updateSliderForTrial(gd, staticTraces, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置へ
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, staticTraces, trialKey, initPos);
        }

        function dynamicTracesFromFrame(f) {
          // Bat line
          const bat = {
            type: "scatter3d",
            mode: "lines",
            x: [f.A[0], f.B[0]],
            y: [f.A[1], f.B[1]],
            z: [f.A[2], f.B[2]],
            line: {width: 4},
            showlegend: false
          };
          // BOTTOM marker
          const bottom = {
            type: "scatter3d",
            mode: "markers",
            x: [f.B[0]],
            y: [f.B[1]],
            z: [f.B[2]],
            marker: {
              size: 10,
              color: "white",
              symbol: "circle",
              line: {width: 3, color: "red"}
            },
            showlegend: false
          };
          // Sweet spot
          const sweet = {
            type: "scatter3d",
            mode: "markers",
            x: [f.S[0]],
            y: [f.S[1]],
            z: [f.S[2]],
            marker: {size: 7, color: "orange"},
            showlegend: false
          };
          // Ball
          const ball = {
            type: "scatter3d",
            mode: "markers",
            x: [f.P[0]],
            y: [f.P[1]],
            z: [f.P[2]],
            marker: {size: 7, color: "blue", symbol: "x"},
            showlegend: false
          };
          // S -> P
          const sp = {
            type: "scatter3d",
            mode: "lines",
            x: [f.S[0], f.P[0]],
            y: [f.S[1], f.P[1]],
            z: [f.S[2], f.P[2]],
            line: {width: 3, dash: "dash"},
            showlegend: false
          };
          return [bat, bottom, sweet, ball, sp];
        }

        function updateFrame(gd, staticTraces, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          const dyn = dynamicTracesFromFrame(f);
          const newData = staticTraces.concat(dyn);

          // ★iPhoneでも確実：Plotly.react でデータ差し替え
          Plotly.react(gd, newData, gd.layout);

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

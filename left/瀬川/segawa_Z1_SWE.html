<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>segawa_vanish_Z1_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }
    #frameSlider::-moz-range-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-moz-range-thumb {
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.3406982, -0.3406982, -0.3406982, -0.3406982, -0.3406982, -0.3406982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.0893752, 0.0893752, 0.0893752, 0.0893752, 0.0893752, 0.0893752], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.3406982, 0.0893752], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.3406982, 0.0893752], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.3406982, 0.0893752], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.3406982, 0.0893752], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.3406982, 0.0893752], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [0.01769632, 0.01769632, 0.01769632, -0.1256615, -0.1256615, -0.1256615, -0.2690193, -0.2690193, -0.2690193], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [0.329349100589752, -0.0387631468474865], "y": [0.0250542424619198, -0.586406469345093], "z": [-0.0886570662260056, 0.272741794586182], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [-0.0387631468474865], "y": [-0.586406469345093], "z": [0.272741794586182], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.2833350684160352], "y": [-0.05137834858043254], "z": [-0.043482207403108535], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [0.100275993347168], "z": [0.0399786829948425], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.2833350684160352, 0.154346406459808], "y": [-0.05137834858043254, 0.100275993347168], "z": [-0.043482207403108535, 0.0399786829948425], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z1 (Z1)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -6, "is_min": false, "A": [-0.65010017156601, 0.0120783923193812, -0.0340750068426132], "B": [0.0442208796739578, -0.231453880667686, 0.279947906732559], "S": [-0.5633100456146518, -0.01836313989114529, 0.005177854887748225], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": -5, "is_min": false, "A": [-0.481789737939835, 0.0569268986582756, -0.125863179564476], "B": [0.078182727098465, -0.313513457775116, 0.309113562107086], "S": [-0.41179317899364576, 0.010621853564024807, -0.07149108622136427], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": -4, "is_min": false, "A": [-0.314357191324234, 0.108792580664158, -0.170761317014694], "B": [0.0491153225302696, -0.410575568675995, 0.317239105701447], "S": [-0.2689231255110266, 0.04387155973697446, -0.1097612620519865], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": -3, "is_min": false, "A": [-0.102683283388615, 0.0930464565753937, -0.214564949274063], "B": [0.0426638647913933, -0.483179599046707, 0.321007311344147], "S": [-0.08451488854614547, 0.021018194389640685, -0.1476184118329933], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": -2, "is_min": false, "A": [0.114694967865944, 0.0413946695625782, -0.217690706253052], "B": [0.0238885693252087, -0.549169659614563, 0.31427538394928], "S": [0.10334416760529436, -0.032425874466014415, -0.15119494238221995], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": -1, "is_min": true, "A": [0.329349100589752, 0.0250542424619198, -0.0886570662260056], "B": [-0.0387631468474865, -0.586406469345093, 0.272741794586182], "S": [0.2833350684160352, -0.05137834858043254, -0.043482207403108535], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 0, "is_min": false, "A": [0.329349100589752, 0.0250542424619198, -0.0886570662260056], "B": [-0.0387631468474865, -0.586406469345093, 0.272741794586182], "S": [0.2833350684160352, -0.05137834858043254, -0.043482207403108535], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 1, "is_min": false, "A": [0.500639796257019, -0.133840620517731, -0.042050875723362], "B": [-0.0690986067056656, -0.615386605262756, 0.246932744979858], "S": [0.4294224912280294, -0.19403387254837878, -0.005927920772489548], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 2, "is_min": false, "A": [0.608243107795715, -0.333834409713745, -0.0221725311130285], "B": [-0.0971180349588394, -0.628394365310669, 0.213836327195168], "S": [0.5200729711749129, -0.37065440156440965, 0.007328574093151154], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 3, "is_min": false, "A": [0.651127934455872, -0.493803918361664, -0.0131925493478775], "B": [-0.122707590460777, -0.594620048999786, 0.162918448448181], "S": [0.5543985237189301, -0.506405930798938, 0.008821318577018433], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 4, "is_min": false, "A": [0.609860062599182, -0.703953325748444, -0.119879648089409], "B": [-0.139127045869827, -0.574571073055267, 0.129677295684814], "S": [0.51623668312134, -0.6877805457304385, -0.08868503314328097], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}], "2": [{"index": -6, "is_min": false, "A": [-0.679966449737549, 0.00791943818330765, 0.000478656031191349], "B": [0.0694722980260849, -0.156238034367561, 0.227181628346443], "S": [-0.5862866318900133, -0.012600240273092889, 0.02881651981974187], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": -5, "is_min": false, "A": [-0.547390341758728, 0.0667427107691765, -0.0813194960355759], "B": [0.0953102335333824, -0.256330370903015, 0.268765777349472], "S": [-0.4670527663464453, 0.026358573800384096, -0.037558834955541916], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": -4, "is_min": false, "A": [-0.383410274982452, 0.0925916880369186, -0.158719927072525], "B": [0.118176095187664, -0.332826107740402, 0.29672560095787], "S": [-0.32071196973295374, 0.039414455949912594, -0.10178922791639801], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": -3, "is_min": false, "A": [-0.231844753026962, 0.144611269235611, -0.173385635018349], "B": [0.083825096487999, -0.412298887968063, 0.306409686803818], "S": [-0.19238601961593738, 0.0749974956656708, -0.11341121641382408], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": -2, "is_min": false, "A": [-0.0369138121604919, 0.139021620154381, -0.190212562680244], "B": [0.0751489773392677, -0.474497139453888, 0.310822933912277], "S": [-0.022905962444620856, 0.062331769573080925, -0.1275831210081722], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": -1, "is_min": true, "A": [0.15947724878788, 0.105087012052536, -0.174521371722221], "B": [0.0586240664124489, -0.527402520179749, 0.304838240146637], "S": [0.1468706010920971, 0.02602582115782613, -0.11460142071936505], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 0, "is_min": false, "A": [0.15947724878788, 0.105087012052536, -0.174521371722221], "B": [0.0586240664124489, -0.527402520179749, 0.304838240146637], "S": [0.1468706010920971, 0.02602582115782613, -0.11460142071936505], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 1, "is_min": false, "A": [0.355127930641174, 0.0852220579981804, -0.0728458911180496], "B": [0.015959857031703, -0.556356728076935, 0.263816475868225], "S": [0.31273191714217285, 0.005024701608932619, -0.030763090978699406], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 2, "is_min": false, "A": [0.515003442764282, -0.0522606037557125, -0.0481171272695065], "B": [-0.00808470882475376, -0.585040330886841, 0.239153623580933], "S": [0.449617420560089, -0.11885807296298492, -0.012208281625303713], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 3, "is_min": false, "A": [0.631442844867706, -0.176921248435974, 0.00985793024301529], "B": [-0.0390614122152328, -0.573668777942657, 0.191559419035912], "S": [0.5476298122062517, -0.22651468993560298, 0.032570616484692866], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 4, "is_min": false, "A": [0.7044797539711, -0.37828004360199, 0.0157615002244711], "B": [-0.0589638575911522, -0.571454405784607, 0.156608670949936], "S": [0.6090493329249688, -0.40242683118291117, 0.03336739095683652], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}], "3": [{"index": -6, "is_min": false, "A": [-0.70106303691864, 0.0427592024207115, -0.0340058319270611], "B": [-0.00126124545931816, -0.208832249045372, 0.260916531085968], "S": [-0.613587813395286, 0.011310271134515985, 0.0028594632771740194], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": -5, "is_min": false, "A": [-0.564874649047852, 0.0946421846747398, -0.10211668908596], "B": [0.0350529104471207, -0.268197953701019, 0.28315469622612], "S": [-0.48988370897358163, 0.04928717031870318, -0.053957769044695535], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": -4, "is_min": false, "A": [-0.424160599708557, 0.143317371606827, -0.137810230255127], "B": [0.033932626247406, -0.346489280462265, 0.298355042934418], "S": [-0.3668989511887909, 0.082091545150009, -0.08328957560500039], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": -3, "is_min": false, "A": [-0.253582507371902, 0.151104599237442, -0.177445471286774], "B": [0.0432828031480312, -0.410739570856094, 0.308560758829117], "S": [-0.21647434181078706, 0.08087407467105537, -0.11669468966366194], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": -2, "is_min": false, "A": [-0.0763626545667648, 0.133006915450096, -0.196065485477448], "B": [0.0404479019343853, -0.473048686981201, 0.312905877828598], "S": [-0.061761334411103076, 0.05724996206939123, -0.13244406248027202], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": -1, "is_min": true, "A": [0.101321548223495, 0.144069954752922, -0.132456228137016], "B": [-0.000259899068623781, -0.524439752101898, 0.295066922903061], "S": [0.08862386793960579, 0.06050624552648745, -0.07901583689847781], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 0, "is_min": false, "A": [0.101321548223495, 0.144069954752922, -0.132456228137016], "B": [-0.000259899068623781, -0.524439752101898, 0.295066922903061], "S": [0.08862386793960579, 0.06050624552648745, -0.07901583689847781], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 1, "is_min": false, "A": [0.274298101663589, 0.0643530488014221, -0.105337008833885], "B": [-0.0233536921441555, -0.568168938159943, 0.28366082906723], "S": [0.237091626630655, -0.014712201283583429, -0.056712278041630794], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 2, "is_min": false, "A": [0.420903474092484, -0.0555160045623779, -0.0776901617646217], "B": [-0.0518418699502945, -0.600759983062744, 0.267594069242477], "S": [0.361810322549526, -0.12367148288791778, -0.0345296449125512], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 3, "is_min": false, "A": [0.536149084568024, -0.159203350543976, -0.00217209570109844], "B": [-0.0907409191131592, -0.594697058200836, 0.237314701080322], "S": [0.45778782014712616, -0.21364007369946555, 0.02776375922991554], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 4, "is_min": false, "A": [0.614126265048981, -0.326959848403931, 0.0246166903525591], "B": [-0.111863076686859, -0.602322995662689, 0.217268109321594], "S": [0.523377594241801, -0.361380242983369, 0.048698118543716244], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}], "4": [{"index": -4, "is_min": false, "A": [-0.453840881586075, 0.073606051504612, -0.141184121370316], "B": [0.11690816283226, -0.321893572807312, 0.256088405847549], "S": [-0.3824972446472668, 0.024168594040095387, -0.09152505102271849], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": -3, "is_min": false, "A": [-0.274945497512817, 0.0855703055858612, -0.209749653935432], "B": [0.136419877409935, -0.401701837778091, 0.273307651281357], "S": [-0.22352482458319128, 0.0246612864047, -0.1493674895335708], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": -2, "is_min": false, "A": [-0.0934983864426613, 0.115593053400517, -0.207351997494698], "B": [0.0957101359963417, -0.49638107419014, 0.271905511617661], "S": [-0.06984732035886168, 0.039096284932340214, -0.14744480688266962], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": -1, "is_min": false, "A": [0.109926447272301, 0.0731896907091141, -0.211901500821114], "B": [0.0785569995641708, -0.565241813659668, 0.269160985946655], "S": [0.1060052661378313, -0.006614250816230516, -0.15176868735350668], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 0, "is_min": false, "A": [0.109926447272301, 0.0731896907091141, -0.211901500821114], "B": [0.0785569995641708, -0.565241813659668, 0.269160985946655], "S": [0.1060052661378313, -0.006614250816230516, -0.15176868735350668], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 1, "is_min": true, "A": [0.29760330915451, 0.0423826202750206, -0.131438717246056], "B": [0.0090939411893487, -0.60427451133728, 0.240847393870354], "S": [0.26153963956193554, -0.038449518031712066, -0.08490295516699617], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 2, "is_min": false, "A": [0.464546620845795, -0.0936002358794212, -0.108102597296238], "B": [-0.0244116745889187, -0.633997023105621, 0.221883848309517], "S": [0.4034268318442246, -0.16114983657292642, -0.06685429019701858], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 3, "is_min": false, "A": [0.580143213272095, -0.196435645222664, -0.0294433161616325], "B": [-0.0711147040128708, -0.610164225101471, 0.181961238384247], "S": [0.4987359798644162, -0.24815171373517037, -0.0030177488731623903], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 4, "is_min": false, "A": [0.644439399242401, -0.382004588842392, -0.0398542657494545], "B": [-0.100061476230621, -0.602230668067932, 0.153068274259567], "S": [0.5513768033310441, -0.4095328447454995, -0.015738951752482938], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 5, "is_min": false, "A": [0.637715280056, -0.570892155170441, -0.106213770806789], "B": [-0.128076374530792, -0.573058545589447, 0.12521405518055], "S": [0.5419913524077629, -0.5711629538902817, -0.07728530137530332], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}, {"index": 6, "is_min": false, "A": [0.645014643669128, -0.680938124656677, -0.0397864989936352], "B": [-0.114935636520386, -0.491419702768326, 0.123180270195007], "S": [0.5500208459144104, -0.6572483187457354, -0.01941565011496242], "P": [0.154346406459808, 0.100275993347168, 0.0399786829948425]}]};
    const STATIC_COUNT = 8;

    let currentTrial = "1";
    let currentCamera = null; // ★ユーザー操作のカメラを保存

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        const staticTraces = (STATIC_COUNT > 0) ? gd.data.slice(0, STATIC_COUNT) : [];

        // ★初期カメラを保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ★ユーザーが回転/ズームしたらカメラを保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey) {
            if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
              currentCamera = gd.layout.scene.camera;
            }
          }
        });

        // trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, staticTraces, currentTrial);
          });
        });

        // Safari対策：input + change
        slider.addEventListener("input", function() {
          updateFrame(gd, staticTraces, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, staticTraces, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, staticTraces, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, staticTraces, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init draw
        updateSliderForTrial(gd, staticTraces, currentTrial);

        function updateSliderForTrial(gd, staticTraces, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, staticTraces, trialKey, initPos);
        }

        function dynamicTracesFromFrame(f) {
          const bat = {
            type: "scatter3d",
            mode: "lines",
            x: [f.A[0], f.B[0]],
            y: [f.A[1], f.B[1]],
            z: [f.A[2], f.B[2]],
            line: {width: 4},
            showlegend: false
          };
          const bottom = {
            type: "scatter3d",
            mode: "markers",
            x: [f.B[0]],
            y: [f.B[1]],
            z: [f.B[2]],
            marker: {
              size: 10,
              color: "white",
              symbol: "circle",
              line: {width: 3, color: "red"}
            },
            showlegend: false
          };
          const sweet = {
            type: "scatter3d",
            mode: "markers",
            x: [f.S[0]],
            y: [f.S[1]],
            z: [f.S[2]],
            marker: {size: 7, color: "orange"},
            showlegend: false
          };
          const ball = {
            type: "scatter3d",
            mode: "markers",
            x: [f.P[0]],
            y: [f.P[1]],
            z: [f.P[2]],
            marker: {size: 7, color: "blue", symbol: "x"},
            showlegend: false
          };
          const sp = {
            type: "scatter3d",
            mode: "lines",
            x: [f.S[0], f.P[0]],
            y: [f.S[1], f.P[1]],
            z: [f.S[2], f.P[2]],
            line: {width: 3, dash: "dash"},
            showlegend: false
          };
          return [bat, bottom, sweet, ball, sp];
        }

        function updateFrame(gd, staticTraces, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          const dyn = dynamicTracesFromFrame(f);
          const newData = staticTraces.concat(dyn);

          // ★react前に「現在のカメラ」をlayoutへ注入（向きが戻るのを防ぐ）
          const layout2 = JSON.parse(JSON.stringify(gd.layout));
          layout2.scene = layout2.scene || {};
          layout2.uirevision = "KEEP_CAMERA_FOREVER";

          if (currentCamera) {
            layout2.scene.camera = currentCamera;
          } else if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
            layout2.scene.camera = currentCamera;
          }

          Plotly.react(gd, newData, layout2).then(function() {
            // ★念押し：react後にSafariがcameraを落とす場合があるので再適用
            if (currentCamera) {
              Plotly.relayout(gd, {'scene.camera': currentCamera});
            }
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Oomura_Z7_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.474485, -0.474485, -0.474485, -0.474485, -0.474485, -0.474485], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.07775635, 0.07775635, 0.07775635, 0.07775635, 0.07775635, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [-0.01428384, -0.01428384, -0.01428384, -0.1983643, -0.1983643, -0.1983643, -0.3824448, -0.3824448, -0.3824448], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [0.0728624612092972, -0.00296451314352453], "y": [0.139697715640068, -0.455405980348587], "z": [-0.442179977893829, 0.0870664790272713], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [-0.00296451314352453], "y": [-0.455405980348587], "z": [0.0870664790272713], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.0633840890537012], "y": [0.06530975080442203], "z": [-0.3760241682555915], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [0.100275993347168], "z": [-0.382444798946381], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.0633840890537012, 0.154346406459808], "y": [0.06530975080442203, 0.100275993347168], "z": [-0.3760241682555915, -0.382444798946381], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z7 (Z7)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -6, "is_min": false, "A": [-0.850916981697083, 0.0160234086215496, -0.112741783261299], "B": [-0.0819839388132095, -0.172765716910362, 0.00171624775975943], "S": [-0.7548003512782511, -0.00757523208426494, -0.09843452937498146], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": -5, "is_min": false, "A": [-0.721632778644562, 0.106861732900143, -0.220087304711342], "B": [-0.0323205888271332, -0.223563268780708, 0.0158531721681356], "S": [-0.6354687472027944, 0.0655586039920126, -0.19059474246082758], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": -4, "is_min": false, "A": [-0.552365005016327, 0.17024427652359, -0.318170964717865], "B": [0.00596936792135239, -0.280571073293686, 0.0354224853217602], "S": [-0.4825732127363229, 0.11389236129841618, -0.27397178620966656], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": -3, "is_min": false, "A": [-0.359392315149307, 0.219240441918373, -0.370228916406631], "B": [0.00119730830192566, -0.349776834249496, 0.0612736716866493], "S": [-0.3143186129450474, 0.14811328354483722, -0.31629109376511455], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": -2, "is_min": false, "A": [-0.140453949570656, 0.202890366315842, -0.421955615282059], "B": [0.0054323012009263, -0.405758231878281, 0.0763053670525551], "S": [-0.12221816709536927, 0.1268092868319743, -0.35967298863478736], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": -1, "is_min": true, "A": [0.0728624612092972, 0.139697715640068, -0.442179977893829], "B": [-0.00296451314352453, -0.455405980348587, 0.0870664790272713], "S": [0.0633840890537012, 0.06530975080442203, -0.3760241682555915], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": 0, "is_min": false, "A": [0.0728624612092972, 0.139697715640068, -0.442179977893829], "B": [-0.00296451314352453, -0.455405980348587, 0.0870664790272713], "S": [0.0633840890537012, 0.06530975080442203, -0.3760241682555915], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": 1, "is_min": false, "A": [0.274541705846786, 0.0782866328954697, -0.396135360002518], "B": [-0.0429717227816582, -0.482736468315125, 0.0776137933135033], "S": [0.23485252595721592, 0.00815874292767814, -0.3369167138819027], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": 2, "is_min": false, "A": [0.440178692340851, -0.0796784237027168, -0.38054022192955], "B": [-0.0629002600908279, -0.508544385433197, 0.0699988827109337], "S": [0.37729381986364563, -0.13328667183728346, -0.3242228307837561], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": 3, "is_min": false, "A": [0.557340860366821, -0.211099058389664, -0.319040775299072], "B": [-0.0933145582675934, -0.502034306526184, 0.0442833192646503], "S": [0.47600894511639624, -0.2474659590057579, -0.27362527022341654], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": 4, "is_min": false, "A": [0.603390276432037, -0.424323469400406, -0.316989302635193], "B": [-0.11552918702364, -0.495170086622238, 0.026719156652689], "S": [0.5135253395048244, -0.4331792969468511, -0.27402574331411583], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}], "2": [{"index": -6, "is_min": false, "A": [-0.766072571277618, 0.0201787073165178, -0.0838537365198135], "B": [0.00510662794113159, -0.171241641044617, 0.00910333450883627], "S": [-0.6696751807234556, -0.0037488339082397265, -0.0722341037680515], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": -5, "is_min": false, "A": [-0.639964461326599, 0.104692012071609, -0.186538442969322], "B": [0.0561176538467407, -0.225418239831924, 0.0290928110480309], "S": [-0.5529541919802096, 0.06342822823630928, -0.15958453468383557], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": -4, "is_min": false, "A": [-0.475774198770523, 0.172877386212349, -0.26205313205719], "B": [0.0737256333231926, -0.305644005537033, 0.0682001858949661], "S": [-0.40708672200463114, 0.11306221419940779, -0.2207714686629259], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": -3, "is_min": false, "A": [-0.280201464891434, 0.196820750832558, -0.332822382450104], "B": [0.0927382111549377, -0.368760764598846, 0.0926579087972641], "S": [-0.23358400286564318, 0.1261230575819361, -0.27963734316916594], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": -2, "is_min": false, "A": [-0.0636933743953705, 0.187850341200829, -0.365562438964844], "B": [0.0655941814184189, -0.438878178596497, 0.114537492394447], "S": [-0.0475324280715875, 0.10950926727244187, -0.30554994068601227], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": -1, "is_min": true, "A": [0.14764279127121, 0.106007218360901, -0.39376112818718], "B": [0.0515072755515575, -0.493658483028412, 0.126968085765839], "S": [0.13562585091502405, 0.031049000128004295, -0.3286699716156049], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": 0, "is_min": false, "A": [0.14764279127121, 0.106007218360901, -0.39376112818718], "B": [0.0515072755515575, -0.493658483028412, 0.126968085765839], "S": [0.13562585091502405, 0.031049000128004295, -0.3286699716156049], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": 1, "is_min": false, "A": [0.343120455741882, -0.0266059059649706, -0.394934922456741], "B": [0.0264271125197411, -0.5389524102211, 0.131569012999535], "S": [0.30353378809010745, -0.09064921859093021, -0.32912193094198344], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": 2, "is_min": false, "A": [0.513883709907532, -0.139163509011269, -0.324475944042206], "B": [-0.0205294508486986, -0.549757957458496, 0.106586210429668], "S": [0.4470820548190093, -0.1904878227456479, -0.2705931666719822], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": 3, "is_min": false, "A": [0.618217647075653, -0.333884537220001, -0.289562284946442], "B": [-0.0485268719494343, -0.563890278339386, 0.0879950076341629], "S": [0.5348746084882482, -0.3626352457904546, -0.24236763826151372], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": 4, "is_min": false, "A": [0.667255461215973, -0.521588981151581, -0.234968826174736], "B": [-0.0828968212008476, -0.533459722995758, 0.0427552610635757], "S": [0.5734864281086115, -0.5230728238473726, -0.200253316082492], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}], "3": [{"index": -6, "is_min": false, "A": [-0.823072075843811, -0.0557628981769085, -0.0816636011004448], "B": [-0.0288979411125183, -0.127993911504745, -0.0178674943745136], "S": [-0.7238002949489228, -0.06479177612106726, -0.07368908663078588], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": -5, "is_min": false, "A": [-0.705536544322968, 0.0533304363489151, -0.190665245056152], "B": [0.0354315713047981, -0.177357956767082, 0.00362683087587357], "S": [-0.6129155511336379, 0.024494393829660458, -0.16637874114040027], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": -4, "is_min": false, "A": [-0.548809349536896, 0.132212489843369, -0.307066559791565], "B": [0.104845456779003, -0.206331506371498, 0.00618019141256809], "S": [-0.467102509620351, 0.08989449594787649, -0.26791072110161795], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": -3, "is_min": false, "A": [-0.338672608137131, 0.207404568791389, -0.339719027280807], "B": [0.0644737184047699, -0.332191824913025, 0.0919158756732941], "S": [-0.28827931409702695, 0.13995501526531937, -0.28576466096146746], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": -2, "is_min": false, "A": [-0.10880734026432, 0.198321536183357, -0.3918796479702], "B": [0.0691671818494797, -0.392927318811417, 0.116795219480991], "S": [-0.08656052951603645, 0.12441544431141148, -0.3282953024459626], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": -1, "is_min": true, "A": [0.124718144536018, 0.12864950299263, -0.41306146979332], "B": [0.0564413368701935, -0.449886173009872, 0.135240212082863], "S": [0.11618354347924836, 0.05633254265733653, -0.34452375876745206], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": 0, "is_min": false, "A": [0.124718144536018, 0.12864950299263, -0.41306146979332], "B": [0.0564413368701935, -0.449886173009872, 0.135240212082863], "S": [0.11618354347924836, 0.05633254265733653, -0.34452375876745206], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": 1, "is_min": false, "A": [0.341902554035187, 0.0624137669801712, -0.35444188117981], "B": [0.00879305601119995, -0.481480628252029, 0.128483518958092], "S": [0.30026386655243237, -0.005573032798995105, -0.29407620582948324], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": 2, "is_min": false, "A": [0.522253334522247, -0.0939548090100288, -0.304818779230118], "B": [-0.0103776138275862, -0.509861290454865, 0.123347505927086], "S": [0.4556744813849244, -0.14594310716049433, -0.2512980059702226], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": 3, "is_min": false, "A": [0.653700709342957, -0.234672829508781, -0.205699846148491], "B": [-0.0376892946660519, -0.511923372745514, 0.0860406309366226], "S": [0.5672769930965723, -0.2693291336770651, -0.16923230096705932], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": 4, "is_min": false, "A": [0.696847856044769, -0.481493324041367, -0.194077432155609], "B": [-0.0608286671340466, -0.515986979007721, 0.0603563487529755], "S": [0.6021382961876829, -0.4858050306599375, -0.16227321140250112], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}], "4": [{"index": -6, "is_min": false, "A": [-0.790692210197449, -0.0532867908477783, -0.109905749559402], "B": [0.004774309694767, -0.115022480487823, -0.0514070875942707], "S": [-0.6912589241938931, -0.061003749803432504, -0.10259341894517025], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": -5, "is_min": false, "A": [-0.659662842750549, 0.0650389194488525, -0.205939367413521], "B": [0.0695144981145859, -0.194027543067932, -0.002998280338943], "S": [-0.5685156830647413, 0.03265561444894846, -0.18057173373410423], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": -4, "is_min": false, "A": [-0.486114919185638, 0.148033261299133, -0.300302565097809], "B": [0.121625177562237, -0.255131870508194, 0.0284980200231075], "S": [-0.4101474055179757, 0.09763761877893248, -0.25920249110603], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": -3, "is_min": false, "A": [-0.280809253454208, 0.185025170445442, -0.36217674612999], "B": [0.121156066656113, -0.34332937002182, 0.0842147469520569], "S": [-0.2305635886013525, 0.11898085309857129, -0.3063778096734557], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": -2, "is_min": false, "A": [-0.0521691627800465, 0.162059366703033, -0.412255734205246], "B": [0.124724820256233, -0.409900099039078, 0.11837662756443], "S": [-0.0300574117054273, 0.09056442315445597, -0.3459266793996794], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": -1, "is_min": true, "A": [0.176786497235298, 0.0896996557712555, -0.420380830764771], "B": [0.109108135104179, -0.471247464418411, 0.145974144339561], "S": [0.1683267019039743, 0.019581265209347956, -0.34958645833334173], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": 0, "is_min": false, "A": [0.176786497235298, 0.0896996557712555, -0.420380830764771], "B": [0.109108135104179, -0.471247464418411, 0.145974144339561], "S": [0.1683267019039743, 0.019581265209347956, -0.34958645833334173], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": 1, "is_min": false, "A": [0.368293344974518, 0.00330066680908203, -0.370841860771179], "B": [0.0355053693056107, -0.507037580013275, 0.147624298930168], "S": [0.32669485197019826, -0.060491607979709525, -0.30603359696909216], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": 2, "is_min": false, "A": [0.528172552585602, -0.165205866098404, -0.330650061368942], "B": [0.00446853041648865, -0.536834716796875, 0.146451532840729], "S": [0.462709541463069, -0.21165947836199714, -0.27101235448449795], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": 3, "is_min": false, "A": [0.61939662694931, -0.35736072063446, -0.292025983333588], "B": [-0.0311799757182598, -0.548355579376221, 0.132557794451714], "S": [0.5380745729859435, -0.38123507170339876, -0.23895302505711372], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}, {"index": 4, "is_min": false, "A": [0.593311429023743, -0.505909204483032, -0.358072936534882], "B": [-0.073394849896431, -0.502430319786072, 0.0840705186128616], "S": [0.5099731571751364, -0.5054743439638318, -0.3028050132735853], "P": [0.154346406459808, 0.100275993347168, -0.382444798946381]}]};

    const STATIC_COUNT  = 8;
    const DYNAMIC_COUNT = 5;

    let currentTrial = "1";
    let currentCamera = null;

    // restyle対象トレース（動的5本）
    function dynamicTraceIndices() {
      const arr = [];
      for (let i = 0; i < DYNAMIC_COUNT; i++) arr.push(STATIC_COUNT + i);
      return arr;
    }
    const DYN_IDX = dynamicTraceIndices();

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        // 初期 camera 保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ユーザー操作で camera 変化を保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey && gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
          }
        });

        // 端末回転/リサイズ：Plotlyが勝手に変えることがあるので再適用
        let resizeTimer = null;
        function handleResize() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function() {
            Plotly.Plots.resize(gd).then(function() {
              if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
            });
          }, 150);
        }
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, currentTrial);
          });
        });

        // Slider
        slider.addEventListener("input", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init
        updateSliderForTrial(gd, currentTrial);

        function updateSliderForTrial(gd, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, trialKey, initPos);
        }

        // ★ここが本丸：restyle で x/y/z だけ更新（レイアウト触らない→カメラ戻らない）
        function updateFrame(gd, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          // Bat line (trace 0)
          const x0 = [f.A[0], f.B[0]];
          const y0 = [f.A[1], f.B[1]];
          const z0 = [f.A[2], f.B[2]];

          // Bottom marker (trace 1)
          const x1 = [f.B[0]];
          const y1 = [f.B[1]];
          const z1 = [f.B[2]];

          // Sweet (trace 2)
          const x2 = [f.S[0]];
          const y2 = [f.S[1]];
          const z2 = [f.S[2]];

          // Ball (trace 3)
          const x3 = [f.P[0]];
          const y3 = [f.P[1]];
          const z3 = [f.P[2]];

          // S->P (trace 4)
          const x4 = [f.S[0], f.P[0]];
          const y4 = [f.S[1], f.P[1]];
          const z4 = [f.S[2], f.P[2]];

          // restyle は「配列の配列」にするのがコツ
          Plotly.restyle(gd, {
            x: [x0, x1, x2, x3, x4],
            y: [y0, y1, y2, y3, y4],
            z: [z0, z1, z2, z3, z4],
          }, DYN_IDX).then(function() {
            // 念押し：カメラ保持（restyleだけなら基本不要だが、iOS保険）
            if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

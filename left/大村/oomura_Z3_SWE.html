<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Oomura_Z3_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
          <button class="trial-btn" id="trialBtn_5" data-trial="5">5球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.474485, -0.474485, -0.474485, -0.474485, -0.474485, -0.474485], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.07775635, 0.07775635, 0.07775635, 0.07775635, 0.07775635, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [-0.01428384, -0.01428384, -0.01428384, -0.1983643, -0.1983643, -0.1983643, -0.3824448, -0.3824448, -0.3824448], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [0.14100943505764, -0.0440889596939087], "y": [0.0361943021416664, -0.619401514530182], "z": [-0.147579595446587, 0.271863728761673], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [-0.0440889596939087], "y": [-0.619401514530182], "z": [0.271863728761673], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.11787213558355097], "y": [-0.04575517540327384], "z": [-0.09514917962563765], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [-0.100275993347168], "z": [-0.0142838358879089], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.11787213558355097, 0.154346406459808], "y": [-0.04575517540327384, -0.100275993347168], "z": [-0.09514917962563765, -0.0142838358879089], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z3 (Z3)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -6, "is_min": false, "A": [-0.750533580780029, -0.0331175662577152, 0.0205725822597742], "B": [0.014472708106041, -0.242103904485703, 0.12588158249855], "S": [-0.6549077869842783, -0.059240860635619036, 0.03373620834751942], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -5, "is_min": false, "A": [-0.619554042816162, 0.0566800907254219, -0.0742458328604698], "B": [0.0808482468128204, -0.274583905935287, 0.125004589557648], "S": [-0.532003752073258, 0.015272088995923631, -0.04933952876687049], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -4, "is_min": false, "A": [-0.426108837127686, 0.132651627063751, -0.0833982303738594], "B": [0.0468756034970284, -0.440464735031128, 0.212951719760895], "S": [-0.3669857792097875, 0.06101207836088758, -0.04635448482772333], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -3, "is_min": false, "A": [-0.218773499131203, 0.1374651491642, -0.134181097149849], "B": [0.0475469641387463, -0.515847682952881, 0.242986962199211], "S": [-0.18548344098210245, 0.0558010445599435, -0.08703508939081854], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -2, "is_min": false, "A": [-0.062086895108223, 0.104278698563576, -0.158043041825294], "B": [0.0243580434471369, -0.570484638214111, 0.26293420791626], "S": [-0.05128127891040195, 0.01993329022123097, -0.10542089106966199], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -1, "is_min": true, "A": [0.14100943505764, 0.0361943021416664, -0.147579595446587], "B": [-0.0440889596939087, -0.619401514530182, 0.271863728761673], "S": [0.11787213558355097, -0.04575517540327384, -0.09514917962563765], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 0, "is_min": false, "A": [0.14100943505764, 0.0361943021416664, -0.147579595446587], "B": [-0.0440889596939087, -0.619401514530182, 0.271863728761673], "S": [0.11787213558355097, -0.04575517540327384, -0.09514917962563765], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 1, "is_min": false, "A": [0.316724687814713, -0.107256829738617, -0.142629876732826], "B": [-0.0869763195514679, -0.657013952732086, 0.275452107191086], "S": [0.26626205964331817, -0.17597647317768178, -0.09036962641154121], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 2, "is_min": false, "A": [0.473873496055603, -0.22292172908783, -0.0424226857721806], "B": [-0.138475894927979, -0.647021055221558, 0.249412775039673], "S": [0.39732981926755584, -0.2759341468734779, -0.005943251781411349], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 3, "is_min": false, "A": [0.564383447170258, -0.428769111633301, -0.00367033388465643], "B": [-0.165502741932869, -0.651335000991821, 0.236601039767265], "S": [0.47314765622222854, -0.4565898530815367, 0.026363593520161578], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 4, "is_min": false, "A": [0.570523083209991, -0.638701200485229, -0.047706812620163], "B": [-0.183428302407265, -0.643885493278503, 0.219744846224785], "S": [0.4762791569585173, -0.6393492371053558, -0.014275354182850343], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}], "2": [{"index": -6, "is_min": false, "A": [-0.773708164691925, -0.0478075705468655, -0.00294508039951324], "B": [-0.00464056804776192, -0.21861532330513, 0.136193752288818], "S": [-0.6775747054509099, -0.0691585417872173, 0.014447275434293852], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -5, "is_min": false, "A": [-0.627455294132233, 0.0578949898481369, -0.0829147547483444], "B": [0.050830066204071, -0.289094895124435, 0.16106703877449], "S": [-0.5426696324290265, 0.014521258492454614, -0.05241703355749913], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -4, "is_min": false, "A": [-0.434039264917374, 0.134346783161163, -0.126201570034027], "B": [0.0574516803026199, -0.397865861654282, 0.213189572095871], "S": [-0.37260289656765105, 0.06782020234566805, -0.08377767713160011], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -3, "is_min": false, "A": [-0.210548281669617, 0.149778217077255, -0.162713423371315], "B": [0.063702218234539, -0.479792207479477, 0.247686073184013], "S": [-0.17626696926052726, 0.07108191418885497, -0.11141348642001268], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -2, "is_min": false, "A": [0.0257075782865286, 0.0936995893716812, -0.184082806110382], "B": [0.048270259052515, -0.558002352714539, 0.27935579419136], "S": [0.02852791375215525, 0.01223683592731338, -0.12615297347534435], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -1, "is_min": true, "A": [0.230753168463707, -0.013978261500597, -0.159814119338989], "B": [-0.0368804298341274, -0.618038773536682, 0.291276931762695], "S": [0.1972989681935654, -0.08948582659506135, -0.10342773713733958], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 0, "is_min": false, "A": [0.230753168463707, -0.013978261500597, -0.159814119338989], "B": [-0.0368804298341274, -0.618038773536682, 0.291276931762695], "S": [0.1972989681935654, -0.08948582659506135, -0.10342773713733958], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 1, "is_min": false, "A": [0.402173310518265, -0.193266868591309, -0.136304572224617], "B": [-0.0853815972805023, -0.659049034118652, 0.294203460216522], "S": [0.3412289460834666, -0.25148964019931075, -0.0824910673218424], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 2, "is_min": false, "A": [0.519303441047668, -0.332904130220413, -0.0470372773706913], "B": [-0.149261444807053, -0.644990622997284, 0.262192279100418], "S": [0.4357328240589362, -0.37191494473824266, -0.008383579917819017], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 3, "is_min": false, "A": [0.578094244003296, -0.547129809856415, -0.0051865316927433], "B": [-0.175667524337769, -0.646297991275787, 0.243829384446144], "S": [0.4838740272380519, -0.5595258319710846, 0.025940456411521345], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 4, "is_min": false, "A": [0.571809947490692, -0.770123660564423, 0.0209472700953484], "B": [-0.191835284233093, -0.641586244106293, 0.221755728125572], "S": [0.47635428936250795, -0.7540564828064857, 0.046048328443754505], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}], "3": [{"index": -3, "is_min": false, "A": [-0.576724112033844, 0.0254568569362164, -0.0536035597324371], "B": [0.134048908948898, -0.275535196065903, 0.156648278236389], "S": [-0.48787750792040885, -0.012167139733486553, -0.027322086940587884], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -2, "is_min": false, "A": [-0.398093074560165, 0.104123070836067, -0.123278707265854], "B": [0.18027438223362, -0.351771354675293, 0.189213454723358], "S": [-0.3257971420991875, 0.047136267361996415, -0.08421718682174646], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -1, "is_min": false, "A": [-0.189592599868774, 0.145954743027687, -0.196392714977264], "B": [0.242212146520615, -0.397644549608231, 0.201155453920364], "S": [-0.13561700979820035, 0.07800483551205452, -0.146699196837064], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 0, "is_min": false, "A": [-0.189592599868774, 0.145954743027687, -0.196392714977264], "B": [0.242212146520615, -0.397644549608231, 0.201155453920364], "S": [-0.13561700979820035, 0.07800483551205452, -0.146699196837064], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 1, "is_min": false, "A": [0.0422745123505592, 0.092095635831356, -0.173790723085403], "B": [0.111758589744568, -0.554266452789307, 0.292458117008209], "S": [0.05096002224530011, 0.011300372702709643, -0.11550961659418099], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 2, "is_min": true, "A": [0.262121975421906, -0.010891392827034, -0.171237632632256], "B": [0.0771128982305527, -0.619677424430847, 0.313686281442642], "S": [0.23899584065303509, -0.08698964717222074, -0.11062214305849039], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 3, "is_min": false, "A": [0.446768909692764, -0.187714338302612, -0.152520090341568], "B": [0.0263537298887968, -0.671489715576172, 0.32624152302742], "S": [0.39421702131126707, -0.24818624999726388, -0.0926748990265349], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 4, "is_min": false, "A": [0.570423722267151, -0.335598796606064, -0.0772702172398567], "B": [-0.0556973442435265, -0.664761781692505, 0.296393126249313], "S": [0.49215859842749177, -0.3767441647611265, -0.03056230495781203], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 5, "is_min": false, "A": [0.640825569629669, -0.543251395225525, -0.0183227434754372], "B": [-0.0919547826051712, -0.667388439178467, 0.277689278125763], "S": [0.5492280375677612, -0.558768523692291, 0.01867875439037435], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 6, "is_min": false, "A": [0.638014078140259, -0.774209558963776, 0.0170542784035206], "B": [-0.116389833390713, -0.661206662654877, 0.258104175329208], "S": [0.543713586923543, -0.7600841965843376, 0.04718551624625793], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 7, "is_min": false, "A": [0.610859632492065, -0.901277422904968, -0.00914405565708876], "B": [-0.0982883870601654, -0.606101274490356, 0.214419320225716], "S": [0.5222161615762868, -0.8643804174764773, 0.018801356388782407], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}], "4": [{"index": -6, "is_min": false, "A": [-0.736341059207916, -0.0390916168689728, 0.0368977189064026], "B": [0.0337664820253849, -0.22440305352211, 0.149120628833771], "S": [-0.6400776116752583, -0.06225554762453012, 0.05092558335823594], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -5, "is_min": false, "A": [-0.59878146648407, 0.0702627748250961, -0.029625428840518], "B": [0.061851192265749, -0.323205649852753, 0.191162064671516], "S": [-0.5162023859671887, 0.02107922282842229, -0.002026992762056902], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -4, "is_min": false, "A": [-0.419913530349731, 0.137496024370193, -0.0872946679592133], "B": [0.0827934443950653, -0.402708858251572, 0.221678301692009], "S": [-0.3570751542670319, 0.06997040948663269, -0.048673044147074504], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -3, "is_min": false, "A": [-0.219530493021011, 0.164720892906189, -0.118131540715694], "B": [0.0416281521320343, -0.491649091243744, 0.257334202528], "S": [-0.18688566029527987, 0.08267463965576126, -0.07119831981753155], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -2, "is_min": false, "A": [0.0041759735904634, 0.116746336221695, -0.145207047462463], "B": [0.0142434593290091, -0.561221241950989, 0.279361575841904], "S": [0.005434409399001503, 0.032000382807152894, -0.09213596570246821], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -1, "is_min": true, "A": [0.217113316059113, -0.000987265259027481, -0.153055399656296], "B": [-0.0284136421978474, -0.61758416891098, 0.293626517057419], "S": [0.18642244540285768, -0.07806188041075544, -0.09722015847678611], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 0, "is_min": false, "A": [0.217113316059113, -0.000987265259027481, -0.153055399656296], "B": [-0.0284136421978474, -0.61758416891098, 0.293626517057419], "S": [0.18642244540285768, -0.07806188041075544, -0.09722015847678611], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 1, "is_min": false, "A": [0.387225747108459, -0.118381209671497, -0.0973351076245308], "B": [-0.103810586035252, -0.625917255878448, 0.278551310300827], "S": [0.3258462111166014, -0.1818232096063721, -0.05034930970976116], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 2, "is_min": false, "A": [0.512760043144226, -0.306701928377151, -0.0494313687086105], "B": [-0.148349106311798, -0.631178081035614, 0.263058543205261], "S": [0.4301214011528575, -0.3472614466296858, -0.010370130518497604], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 3, "is_min": false, "A": [0.568767249584198, -0.527850449085236, -0.0156883746385574], "B": [-0.179854333400726, -0.629363596439362, 0.247486397624016], "S": [0.47518956299538484, -0.5405395909743494, 0.017208467927315195], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 4, "is_min": false, "A": [0.60701185464859, -0.676713705062866, 0.062249917536974], "B": [-0.174383640289307, -0.592246770858765, 0.211535945534706], "S": [0.5093374101992533, -0.666155337467747, 0.08091067248525469], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}], "5": [{"index": -6, "is_min": false, "A": [-0.715003490447998, 0.0447261147201061, 0.0411848127841949], "B": [0.00271868705749512, -0.286577433347702, 0.164119005203247], "S": [-0.6252882169078632, 0.0033131705875651396, 0.05655158706814326], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -5, "is_min": false, "A": [-0.558524966239929, 0.119609266519547, -0.0335865132510662], "B": [0.0459949746727943, -0.356228321790695, 0.185808569192886], "S": [-0.48295997194986706, 0.06012956666155431, -0.006162127337321108], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -4, "is_min": false, "A": [-0.366074800491333, 0.155908182263374, -0.100740261375904], "B": [0.074969083070755, -0.433969527482986, 0.211548909544945], "S": [-0.31094431271842704, 0.08217346543195142, -0.061704113362666374], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -3, "is_min": false, "A": [-0.157859727740288, 0.151977956295013, -0.126865282654762], "B": [0.0507034659385681, -0.52768337726593, 0.2399612814188], "S": [-0.13178932572389868, 0.06702028045402683, -0.08101195720936208], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -2, "is_min": false, "A": [0.0609952956438065, 0.0776075348258018, -0.168302446603775], "B": [0.039553627371788, -0.599837779998779, 0.256677746772766], "S": [0.058315087244816384, -0.007073125261586877, -0.11517992510768894], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": -1, "is_min": true, "A": [0.25625541806221, -0.0546137094497681, -0.19329822063446], "B": [0.0136480592191219, -0.663301706314087, 0.265657722949982], "S": [0.22592949740704896, -0.13069971106439787, -0.13592872617341883], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 0, "is_min": false, "A": [0.25625541806221, -0.0546137094497681, -0.19329822063446], "B": [0.0136480592191219, -0.663301706314087, 0.265657722949982], "S": [0.22592949740704896, -0.13069971106439787, -0.13592872617341883], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 1, "is_min": false, "A": [0.42509999871254, -0.185131132602692, -0.122926577925682], "B": [-0.0612985789775848, -0.698261499404907, 0.251390963792801], "S": [0.364300175159485, -0.24927242986850118, -0.07613688417827133], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 2, "is_min": false, "A": [0.546086013317108, -0.386461406946182, -0.085968017578125], "B": [-0.101138316094875, -0.726029455661774, 0.239292114973068], "S": [0.46518296873500437, -0.4289074148223916, -0.04531049929775159], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 3, "is_min": false, "A": [0.596801400184631, -0.557084262371063, -0.0350839048624039], "B": [-0.151307910680771, -0.706273972988129, 0.205904275178909], "S": [0.503287766548679, -0.5757329701712097, -0.004960392092713567], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}, {"index": 4, "is_min": false, "A": [0.543228983879089, -0.760926008224487, -0.169596076011658], "B": [-0.176905438303947, -0.707091331481934, 0.1746546626091], "S": [0.4532122042766527, -0.7541966753638074, -0.12656474476038726], "P": [0.154346406459808, -0.100275993347168, -0.0142838358879089]}]};

    const STATIC_COUNT  = 8;
    const DYNAMIC_COUNT = 5;

    let currentTrial = "1";
    let currentCamera = null;

    // restyle対象トレース（動的5本）
    function dynamicTraceIndices() {
      const arr = [];
      for (let i = 0; i < DYNAMIC_COUNT; i++) arr.push(STATIC_COUNT + i);
      return arr;
    }
    const DYN_IDX = dynamicTraceIndices();

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        // 初期 camera 保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ユーザー操作で camera 変化を保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey && gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
          }
        });

        // 端末回転/リサイズ：Plotlyが勝手に変えることがあるので再適用
        let resizeTimer = null;
        function handleResize() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function() {
            Plotly.Plots.resize(gd).then(function() {
              if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
            });
          }, 150);
        }
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, currentTrial);
          });
        });

        // Slider
        slider.addEventListener("input", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init
        updateSliderForTrial(gd, currentTrial);

        function updateSliderForTrial(gd, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, trialKey, initPos);
        }

        // ★ここが本丸：restyle で x/y/z だけ更新（レイアウト触らない→カメラ戻らない）
        function updateFrame(gd, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          // Bat line (trace 0)
          const x0 = [f.A[0], f.B[0]];
          const y0 = [f.A[1], f.B[1]];
          const z0 = [f.A[2], f.B[2]];

          // Bottom marker (trace 1)
          const x1 = [f.B[0]];
          const y1 = [f.B[1]];
          const z1 = [f.B[2]];

          // Sweet (trace 2)
          const x2 = [f.S[0]];
          const y2 = [f.S[1]];
          const z2 = [f.S[2]];

          // Ball (trace 3)
          const x3 = [f.P[0]];
          const y3 = [f.P[1]];
          const z3 = [f.P[2]];

          // S->P (trace 4)
          const x4 = [f.S[0], f.P[0]];
          const y4 = [f.S[1], f.P[1]];
          const z4 = [f.S[2], f.P[2]];

          // restyle は「配列の配列」にするのがコツ
          Plotly.restyle(gd, {
            x: [x0, x1, x2, x3, x4],
            y: [y0, y1, y2, y3, y4],
            z: [z0, z1, z2, z3, z4],
          }, DYN_IDX).then(function() {
            // 念押し：カメラ保持（restyleだけなら基本不要だが、iOS保険）
            if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

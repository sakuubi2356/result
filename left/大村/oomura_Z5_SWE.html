<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Oomura_Z5_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
          <button class="trial-btn" id="trialBtn_5" data-trial="5">5球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.474485, -0.474485, -0.474485, -0.474485, -0.474485, -0.474485], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.07775635, 0.07775635, 0.07775635, 0.07775635, 0.07775635, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [-0.01428384, -0.01428384, -0.01428384, -0.1983643, -0.1983643, -0.1983643, -0.3824448, -0.3824448, -0.3824448], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [0.259370893239975, -0.0203139409422874], "y": [0.0385846048593521, -0.598164975643158], "z": [-0.24831597507, 0.147065445780754], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [-0.0203139409422874], "y": [-0.598164975643158], "z": [0.147065445780754], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.22441029177211508], "y": [-0.04100908631758278], "z": [-0.1988933014288847], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [-0.0], "z": [-0.198364317417145], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.22441029177211508, 0.154346406459808], "y": [-0.04100908631758278, -0.0], "z": [-0.1988933014288847, -0.198364317417145], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z5 (Z5)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -6, "is_min": false, "A": [-0.622455835342407, 0.135937064886093, -0.0753968954086304], "B": [0.0234154537320137, -0.306869357824326, 0.0882267951965332], "S": [-0.5417219218221339, 0.08058626041148001, -0.05494393347852811], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -5, "is_min": false, "A": [-0.468978464603424, 0.181309059262276, -0.156362682580948], "B": [0.0504764243960381, -0.369241952896118, 0.102597050368786], "S": [-0.40404660053542774, 0.11249017962323264, -0.12399271449504909], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -4, "is_min": false, "A": [-0.297708332538605, 0.204196333885193, -0.197963371872902], "B": [0.0421818867325783, -0.443635880947113, 0.125746354460716], "S": [-0.25522205269516784, 0.12321730239091251, -0.15749965376255687], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -3, "is_min": false, "A": [-0.107807226479053, 0.182125419378281, -0.244216397404671], "B": [0.0408990308642387, -0.503998041152954, 0.139347538352013], "S": [-0.08921894789632005, 0.09636000335371643, -0.19627091468247834], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -2, "is_min": false, "A": [0.0861030444502831, 0.113493375480175, -0.277388840913773], "B": [0.0287468824535608, -0.560634732246399, 0.149532169103622], "S": [0.07893352410961907, 0.029227360943929845, -0.22402371398370635], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -1, "is_min": true, "A": [0.259370893239975, 0.0385846048593521, -0.24831597507], "B": [-0.0203139409422874, -0.598164975643158, 0.147065445780754], "S": [0.22441029177211508, -0.04100908631758278, -0.1988933014288847], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 0, "is_min": false, "A": [0.259370893239975, 0.0385846048593521, -0.24831597507], "B": [-0.0203139409422874, -0.598164975643158, 0.147065445780754], "S": [0.22441029177211508, -0.04100908631758278, -0.1988933014288847], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 1, "is_min": false, "A": [0.406499862670898, -0.0962111353874207, -0.243250399827957], "B": [-0.0479020103812218, -0.629625916481018, 0.142738670110703], "S": [0.34969962645528097, -0.16288798547061298, -0.19500176431529595], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 2, "is_min": false, "A": [0.522532045841217, -0.264962792396545, -0.226774394512177], "B": [-0.0778600871562958, -0.652256906032562, 0.133131995797157], "S": [0.44748303235966885, -0.31337455457350566, -0.181786097607673], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 3, "is_min": false, "A": [0.598815262317657, -0.408987641334534, -0.164922088384628], "B": [-0.117023676633835, -0.63784247636795, 0.109303906559944], "S": [0.5093353822496169, -0.4375944997736344, -0.13064383415174105], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 4, "is_min": false, "A": [0.61786413192749, -0.597120106220245, -0.162680983543396], "B": [-0.140137702226639, -0.632963955402374, 0.0905943959951401], "S": [0.5231139011766859, -0.6016005874380691, -0.13102156060604445], "P": [0.154346406459808, -0.0, -0.198364317417145]}], "2": [{"index": -6, "is_min": false, "A": [-0.73346620798111, 0.0742164105176926, -0.0569569021463394], "B": [-0.0126362442970276, -0.244550481438637, 0.0801262333989143], "S": [-0.6433624592827223, 0.034370547591290664, -0.039821509587422504], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -5, "is_min": false, "A": [-0.588983654975891, 0.135070502758026, -0.155741468071938], "B": [0.0293258186429739, -0.3058220744133, 0.0958678051829338], "S": [-0.5116949765798118, 0.07995893475184324, -0.12429031127783374], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -4, "is_min": false, "A": [-0.411387354135513, 0.163126647472382, -0.243832498788834], "B": [0.0601250231266022, -0.373284131288528, 0.116638652980328], "S": [-0.35244830222302653, 0.09607529471811195, -0.19877360118270437], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -3, "is_min": false, "A": [-0.211974382400513, 0.167308270931244, -0.276339292526245], "B": [0.0485000014305115, -0.456757664680481, 0.151088878512383], "S": [-0.17941508538876091, 0.08930003129689829, -0.22291077273343202], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -2, "is_min": false, "A": [4.94925770908594e-05, 0.111212581396103, -0.315799176692963], "B": [0.0479041188955307, -0.521893501281738, 0.170910865068436], "S": [0.006031320670920212, 0.032074323654086925, -0.2549604234659769], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -1, "is_min": true, "A": [0.196239933371544, 0.0374397560954094, -0.290797382593155], "B": [-0.00171303749084473, -0.577427268028259, 0.181169927120209], "S": [0.1714958115781331, -0.0394186232731162, -0.23180146784038042], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 0, "is_min": false, "A": [0.196239933371544, 0.0374397560954094, -0.290797382593155], "B": [-0.00171303749084473, -0.577427268028259, 0.181169927120209], "S": [0.1714958115781331, -0.0394186232731162, -0.23180146784038042], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 1, "is_min": false, "A": [0.366460978984833, -0.109221413731575, -0.288281321525574], "B": [-0.025747811421752, -0.622220695018768, 0.183951824903488], "S": [0.3174348856404477, -0.17334631675558998, -0.2292521847916839], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 2, "is_min": false, "A": [0.502546548843384, -0.285516500473022, -0.257844358682632], "B": [-0.0555980280041695, -0.656308889389038, 0.179177060723305], "S": [0.43277848139020453, -0.33186554599655116, -0.20321668489995642], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 3, "is_min": false, "A": [0.599907636642456, -0.504287123680115, -0.180533275008202], "B": [-0.111151412129402, -0.659698724746704, 0.151494219899178], "S": [0.5110252551266219, -0.5237135739050937, -0.139029837948964], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 4, "is_min": false, "A": [0.600511848926544, -0.71574330329895, -0.167249917984009], "B": [-0.140595823526382, -0.659953594207764, 0.128802716732025], "S": [0.5078734069741224, -0.7087695909501353, -0.13024334547717153], "P": [0.154346406459808, -0.0, -0.198364317417145]}], "3": [{"index": -6, "is_min": false, "A": [-0.826450526714325, -0.0505627766251564, 0.00099740969017148], "B": [-0.0385377630591393, -0.165651381015778, 0.0781225338578224], "S": [-0.7279614462438633, -0.06494884998494979, 0.010638048744175111], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -5, "is_min": false, "A": [-0.696043848991394, 0.0714280009269714, -0.0862240046262741], "B": [0.00676697120070457, -0.248823344707489, 0.122333064675331], "S": [-0.6081924981499717, 0.0313965834893733, -0.06015437146287714], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -4, "is_min": false, "A": [-0.51596736907959, 0.152328372001648, -0.179371818900108], "B": [0.0701242536306381, -0.291016459465027, 0.136764138936996], "S": [-0.44270591473190624, 0.09691026692691306, -0.13985482335657135], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -3, "is_min": false, "A": [-0.29903855919838, 0.199783563613892, -0.258458316326141], "B": [0.133255526423454, -0.333942979574203, 0.15173402428627], "S": [-0.24500179662396163, 0.13306774340452227, -0.20718427197359368], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -2, "is_min": false, "A": [-0.060158159583807, 0.166452944278717, -0.267889827489853], "B": [0.0201278738677502, -0.466175258159637, 0.215158447623253], "S": [-0.050122404820425875, 0.08737441438844994, -0.2075087895994407], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -1, "is_min": true, "A": [0.171884045004845, 0.0668957531452179, -0.283211708068848], "B": [-0.00600397121161222, -0.523530602455139, 0.226447507739067], "S": [0.14964804200424844, -0.006907544536091728, -0.21950430330361323], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 0, "is_min": false, "A": [0.171884045004845, 0.0668957531452179, -0.283211708068848], "B": [-0.00600397121161222, -0.523530602455139, 0.226447507739067], "S": [0.14964804200424844, -0.006907544536091728, -0.21950430330361323], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 1, "is_min": false, "A": [0.371210545301437, -0.0912843123078346, -0.268181979656219], "B": [-0.0414443016052246, -0.566475093364716, 0.225690290331841], "S": [0.31962869427955115, -0.15068315436479904, -0.20644795170203661], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 2, "is_min": false, "A": [0.535968780517578, -0.221012771129608, -0.172337666153908], "B": [-0.0914822742342949, -0.563419163227081, 0.186915650963783], "S": [0.4575373931171288, -0.26381357317401133, -0.1274309983327875], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 3, "is_min": false, "A": [0.628771483898163, -0.439044803380966, -0.109091602265835], "B": [-0.112821847200394, -0.569159746170044, 0.161295890808105], "S": [0.5360723148658513, -0.45530917169367313, -0.07529316466721925], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 4, "is_min": false, "A": [0.657229483127594, -0.627092719078064, -0.0453056432306767], "B": [-0.123080432415009, -0.531920909881592, 0.103216715157032], "S": [0.5596907534768093, -0.6151962441228076, -0.026740350296007156], "P": [0.154346406459808, -0.0, -0.198364317417145]}], "4": [{"index": -6, "is_min": false, "A": [-0.804126501083374, -0.0930652096867561, 0.00949009973555803], "B": [-0.0127067603170872, -0.187837779521942, 0.0778511092066765], "S": [-0.7051990546397928, -0.10491177838317635, 0.01803522409236925], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -5, "is_min": false, "A": [-0.676578164100647, 0.0283593833446503, -0.088918536901474], "B": [0.0495933182537556, -0.247917845845222, 0.101727604866028], "S": [-0.5858067345167528, -0.006175268131518103, -0.06508777067972334], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -4, "is_min": false, "A": [-0.494154870510101, 0.128532111644745, -0.162046864628792], "B": [0.0700640007853508, -0.343373954296112, 0.152534857392311], "S": [-0.4236275077206771, 0.06954385015904854, -0.12272414721424797], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -3, "is_min": false, "A": [-0.263964831829071, 0.168666750192642, -0.227932631969452], "B": [0.0871626734733582, -0.418365746736526, 0.186919391155243], "S": [-0.22007388950079224, 0.0952876811124467, -0.17607612415741708], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -2, "is_min": false, "A": [-0.0147984931245446, 0.133221179246902, -0.272116661071777], "B": [0.0807143151760101, -0.491979628801346, 0.217782557010651], "S": [-0.002859392001269445, 0.055071077679864064, -0.2108792583718758], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -1, "is_min": true, "A": [0.218090370297432, 0.0606071874499321, -0.251795709133148], "B": [0.012869288213551, -0.546481728553772, 0.22708560526371], "S": [0.19243773419010313, -0.015278929555680262, -0.19193554285743947], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 0, "is_min": false, "A": [0.218090370297432, 0.0606071874499321, -0.251795709133148], "B": [0.012869288213551, -0.546481728553772, 0.22708560526371], "S": [0.19243773419010313, -0.015278929555680262, -0.19193554285743947], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 1, "is_min": false, "A": [0.421814531087875, -0.0962962657213211, -0.225875318050385], "B": [-0.0212693195790052, -0.583461999893188, 0.228378266096115], "S": [0.36642905278267024, -0.1571919791633816, -0.16909362313656479], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 2, "is_min": false, "A": [0.586984694004059, -0.215667963027954, -0.108137652277946], "B": [-0.0598439984023571, -0.576002955436707, 0.194800540804863], "S": [0.5061311209016488, -0.260709829587225, -0.07027038444106551], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 3, "is_min": false, "A": [0.675664901733398, -0.438286364078522, -0.0602899380028248], "B": [-0.0757658332586288, -0.581081330776215, 0.174148589372635], "S": [0.5817360580338602, -0.4561357352626414, -0.030985121511344672], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 4, "is_min": false, "A": [0.655506789684296, -0.66754424571991, -0.136680871248245], "B": [-0.0860856920480728, -0.569837212562561, 0.147034168243408], "S": [0.562807750971327, -0.6553308694084021, -0.10121649953852796], "P": [0.154346406459808, -0.0, -0.198364317417145]}], "5": [{"index": -6, "is_min": false, "A": [-0.769027233123779, 0.0398954823613167, -0.091482549905777], "B": [0.0109879150986671, -0.105231530964375, 0.011058053933084], "S": [-0.6715253439293957, 0.021754606501867356, -0.07866497499559005], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -5, "is_min": false, "A": [-0.596729815006256, 0.145650088787079, -0.180937394499779], "B": [0.0793935656547546, -0.205068200826645, 0.0637127235531807], "S": [-0.512214380856198, 0.10181029658511269, -0.1503561255575716], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -4, "is_min": false, "A": [-0.387393623590469, 0.211640655994415, -0.262050986289978], "B": [0.134197607636452, -0.277198940515518, 0.0970848798751831], "S": [-0.3221947265113402, 0.15053571282640382, -0.21715900771808522], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -3, "is_min": false, "A": [-0.275556594133377, 0.211536943912506, -0.268307834863663], "B": [0.0993975773453712, -0.360673427581787, 0.146402478218079], "S": [-0.228687322102829, 0.14001064656662615, -0.2164690450695786], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -2, "is_min": false, "A": [-0.0292107723653316, 0.172339245676994, -0.316999852657318], "B": [0.104076832532883, -0.440854549407959, 0.179213643074036], "S": [-0.012549822394711165, 0.09569002424333516, -0.2549731680797072], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": -1, "is_min": true, "A": [0.212968066334724, 0.0489516928792, -0.346443116664886], "B": [0.0891460701823235, -0.518936216831207, 0.203258082270622], "S": [0.19749031648722587, -0.022034297340970448, -0.27773046533981965], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 0, "is_min": false, "A": [0.212968066334724, 0.0489516928792, -0.346443116664886], "B": [0.0891460701823235, -0.518936216831207, 0.203258082270622], "S": [0.19749031648722587, -0.022034297340970448, -0.27773046533981965], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 1, "is_min": false, "A": [0.396196454763412, -0.094923660159111, -0.309742212295532], "B": [0.00681010261178017, -0.57590240240097, 0.197246640920639], "S": [0.3475231599465188, -0.15504600392497578, -0.2463686046045777], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 2, "is_min": false, "A": [0.542838275432587, -0.28944256901741, -0.264605939388275], "B": [-0.0312588587403297, -0.613866746425629, 0.188341528177261], "S": [0.4710761322440394, -0.32999559199415085, -0.2079875048246603], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 3, "is_min": false, "A": [0.642946600914001, -0.422390341758728, -0.139818638563156], "B": [-0.0830737352371216, -0.599543571472168, 0.145683616399765], "S": [0.5521940824972714, -0.4445344897138421, -0.10413086597417015], "P": [0.154346406459808, -0.0, -0.198364317417145]}, {"index": 4, "is_min": false, "A": [0.662423610687256, -0.646958112716675, -0.108211986720562], "B": [-0.105832606554031, -0.6005619764328, 0.110031433403492], "S": [0.5663916140837252, -0.641158597526249, -0.08093156788405073], "P": [0.154346406459808, -0.0, -0.198364317417145]}]};

    const STATIC_COUNT  = 8;
    const DYNAMIC_COUNT = 5;

    let currentTrial = "1";
    let currentCamera = null;

    // restyle対象トレース（動的5本）
    function dynamicTraceIndices() {
      const arr = [];
      for (let i = 0; i < DYNAMIC_COUNT; i++) arr.push(STATIC_COUNT + i);
      return arr;
    }
    const DYN_IDX = dynamicTraceIndices();

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        // 初期 camera 保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ユーザー操作で camera 変化を保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey && gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
          }
        });

        // 端末回転/リサイズ：Plotlyが勝手に変えることがあるので再適用
        let resizeTimer = null;
        function handleResize() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function() {
            Plotly.Plots.resize(gd).then(function() {
              if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
            });
          }, 150);
        }
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, currentTrial);
          });
        });

        // Slider
        slider.addEventListener("input", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init
        updateSliderForTrial(gd, currentTrial);

        function updateSliderForTrial(gd, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, trialKey, initPos);
        }

        // ★ここが本丸：restyle で x/y/z だけ更新（レイアウト触らない→カメラ戻らない）
        function updateFrame(gd, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          // Bat line (trace 0)
          const x0 = [f.A[0], f.B[0]];
          const y0 = [f.A[1], f.B[1]];
          const z0 = [f.A[2], f.B[2]];

          // Bottom marker (trace 1)
          const x1 = [f.B[0]];
          const y1 = [f.B[1]];
          const z1 = [f.B[2]];

          // Sweet (trace 2)
          const x2 = [f.S[0]];
          const y2 = [f.S[1]];
          const z2 = [f.S[2]];

          // Ball (trace 3)
          const x3 = [f.P[0]];
          const y3 = [f.P[1]];
          const z3 = [f.P[2]];

          // S->P (trace 4)
          const x4 = [f.S[0], f.P[0]];
          const y4 = [f.S[1], f.P[1]];
          const z4 = [f.S[2], f.P[2]];

          // restyle は「配列の配列」にするのがコツ
          Plotly.restyle(gd, {
            x: [x0, x1, x2, x3, x4],
            y: [y0, y1, y2, y3, y4],
            z: [z0, z1, z2, z3, z4],
          }, DYN_IDX).then(function() {
            // 念押し：カメラ保持（restyleだけなら基本不要だが、iOS保険）
            if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

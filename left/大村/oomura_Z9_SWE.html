<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Oomura_Z9_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.474485, -0.474485, -0.474485, -0.474485, -0.474485, -0.474485], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.07775635, 0.07775635, 0.07775635, 0.07775635, 0.07775635, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [-0.01428384, -0.01428384, -0.01428384, -0.1983643, -0.1983643, -0.1983643, -0.3824448, -0.3824448, -0.3824448], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [0.0926363468170166, -0.00554467923939228], "y": [0.0190002843737602, -0.568846762180328], "z": [-0.461416184902191, 0.0722468942403793], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [-0.00554467923939228], "y": [-0.568846762180328], "z": [0.0722468942403793], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.08036371804278715], "y": [-0.05448059954204375], "z": [-0.39470829719824624], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [-0.100275993347168], "z": [-0.382444798946381], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.08036371804278715, 0.154346406459808], "y": [-0.05448059954204375, -0.100275993347168], "z": [-0.39470829719824624, -0.382444798946381], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z9 (Z9)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -6, "is_min": false, "A": [-0.729906916618347, 0.0575317889451981, -0.150516286492348], "B": [-0.0145133696496487, -0.282283365726471, -0.0376536399126053], "S": [-0.6404827402505644, 0.015054902687885743, -0.13640845835237286], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": -5, "is_min": false, "A": [-0.600587427616119, 0.102132573723793, -0.254722207784653], "B": [0.0239292401820421, -0.337256669998169, -0.0161510873585939], "S": [-0.5225228536162909, 0.047208924924803164, -0.22490082135091075], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": -4, "is_min": false, "A": [-0.448629856109619, 0.117336221039295, -0.34794756770134], "B": [0.051188625395298, -0.395645022392273, 0.00846739485859871], "S": [-0.38615254085025374, 0.05321356040554655, -0.3033956937650956], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": -3, "is_min": false, "A": [-0.275215357542038, 0.115177422761917, -0.411007016897202], "B": [0.0380745753645897, -0.465352147817612, 0.0415797866880894], "S": [-0.23605411529103734, 0.042611225257862484, -0.35443366552784267], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": -2, "is_min": false, "A": [-0.0962520241737366, 0.065283291041851, -0.465360879898071], "B": [0.0350462272763252, -0.521644711494446, 0.0621580928564072], "S": [-0.07983974245540539, -0.008082710558458897, -0.3994210071503817], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": -1, "is_min": true, "A": [0.0926363468170166, 0.0190002843737602, -0.461416184902191], "B": [-0.00554467923939228, -0.568846762180328, 0.0722468942403793], "S": [0.08036371804278715, -0.05448059954204375, -0.39470829719824624], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 0, "is_min": false, "A": [0.0926363468170166, 0.0190002843737602, -0.461416184902191], "B": [-0.00554467923939228, -0.568846762180328, 0.0722468942403793], "S": [0.08036371804278715, -0.05448059954204375, -0.39470829719824624], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 1, "is_min": false, "A": [0.25925749540329, -0.0955362692475319, -0.46306374669075], "B": [-0.0287859253585339, -0.609417498111725, 0.0781913176178932], "S": [0.22325206708409692, -0.15977142414713935, -0.39540686229178523], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 2, "is_min": false, "A": [0.402099132537842, -0.246286973357201, -0.441525191068649], "B": [-0.0592041313648224, -0.641668736934662, 0.0789289399981499], "S": [0.34443622197325935, -0.29570969601290864, -0.3764684217781444], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 3, "is_min": false, "A": [0.514163136482239, -0.371832877397537, -0.371252238750458], "B": [-0.105449289083481, -0.642223477363586, 0.0564972162246704], "S": [0.4367115972457682, -0.4056316963016651, -0.3177835665153316], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 4, "is_min": false, "A": [0.55883800983429, -0.563872635364532, -0.344307959079742], "B": [-0.135224476456642, -0.649501979351044, 0.0442084968090057], "S": [0.4720802096163964, -0.57457630205897, -0.2957434080095793], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}], "2": [{"index": -6, "is_min": false, "A": [-0.813619256019592, -0.0326993986964226, -0.0815985202789307], "B": [-0.0414971113204956, -0.236802712082863, -0.0350233316421509], "S": [-0.7171039892190707, -0.05821231252955665, -0.07577662177695828], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": -5, "is_min": false, "A": [-0.689101278781891, 0.0573077537119389, -0.188152119517326], "B": [-0.00357982143759727, -0.307900995016098, 0.00337575934827328], "S": [-0.6034110984220308, 0.011656661084232897, -0.16421113516431263], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": -4, "is_min": false, "A": [-0.526888370513916, 0.103405855596066, -0.297040820121765], "B": [0.0299755204468966, -0.368033081293106, 0.0310566015541553], "S": [-0.45728038318570374, 0.04447598767378646, -0.2560286418477678], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": -3, "is_min": false, "A": [-0.334268301725388, 0.130553930997849, -0.370752900838852], "B": [0.018061937764287, -0.438201397657394, 0.067859373986721], "S": [-0.2902270200399225, 0.05945951209217597, -0.3159263643080245], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": -2, "is_min": false, "A": [-0.119377173483372, 0.0916409268975258, -0.433659344911575], "B": [0.0142458565533161, -0.496121525764465, 0.092344619333744], "S": [-0.1026742945371885, 0.018170619472004518, -0.36790884862669104], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": -1, "is_min": true, "A": [0.0937678962945938, 0.00713016465306282, -0.457307428121567], "B": [-0.00284937769174576, -0.547280728816986, 0.111281737685204], "S": [0.08169073681894551, -0.06217119833531046, -0.3862337810577397], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 0, "is_min": false, "A": [0.0937678962945938, 0.00713016465306282, -0.457307428121567], "B": [-0.00284937769174576, -0.547280728816986, 0.111281737685204], "S": [0.08169073681894551, -0.06217119833531046, -0.3862337810577397], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 1, "is_min": false, "A": [0.304391503334045, -0.0694139897823334, -0.403880625963211], "B": [-0.0506750606000423, -0.572774648666382, 0.10656601190567], "S": [0.26000818242091256, -0.13233407274019748, -0.3400747956238337], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 2, "is_min": false, "A": [0.458991825580597, -0.245110750198364, -0.37229984998703], "B": [-0.0755201205611229, -0.599836468696594, 0.105681985616684], "S": [0.3921778318482841, -0.2894514653189704, -0.3125521201211038], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 3, "is_min": false, "A": [0.580816507339478, -0.390121966600418, -0.288236558437347], "B": [-0.102184720337391, -0.595439732074738, 0.0741917937994003], "S": [0.49544137871419147, -0.41578667981923456, -0.24293302758585944], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 4, "is_min": false, "A": [0.591423213481903, -0.616681456565857, -0.301373094320297], "B": [-0.124376446008682, -0.595099925994873, 0.0552289932966232], "S": [0.501948253520804, -0.6139837651683615, -0.2567978321103715], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}], "3": [{"index": -4, "is_min": false, "A": [-0.588028490543365, 0.0599401742219925, -0.322672665119171], "B": [0.0737969279289246, -0.271531730890274, -0.0191706605255604], "S": [-0.5053003116319303, 0.018506185280406012, -0.28473491381013666], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": -3, "is_min": false, "A": [-0.386254698038101, 0.108992524445057, -0.410115092992783], "B": [0.0919612422585487, -0.354328274726868, 0.0333297103643417], "S": [-0.3264777027981449, 0.0510774219298788, -0.35468449006679387], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": -2, "is_min": false, "A": [-0.156339317560196, 0.0962360501289368, -0.480762869119644], "B": [0.108091779053211, -0.422003298997879, 0.0683310255408287], "S": [-0.1232854287531738, 0.03145612809690444, -0.412126128694003], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": -1, "is_min": false, "A": [0.069001741707325, 0.0417578965425491, -0.494406461715698], "B": [0.0578215345740318, -0.492324501276016, 0.101102635264397], "S": [0.06760421591313773, -0.025002398528386142, -0.4199678297851188], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 0, "is_min": false, "A": [0.069001741707325, 0.0417578965425491, -0.494406461715698], "B": [0.0578215345740318, -0.492324501276016, 0.101102635264397], "S": [0.06760421591313773, -0.025002398528386142, -0.4199678297851188], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 1, "is_min": true, "A": [0.283615499734879, -0.0879839584231377, -0.488938570022583], "B": [0.0262433663010597, -0.544374167919159, 0.115600489079952], "S": [0.25144398085322645, -0.1450327385156342, -0.4133711824615097], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 2, "is_min": false, "A": [0.4621462225914, -0.249789118766785, -0.434993088245392], "B": [-0.0117569267749786, -0.581258475780487, 0.117767006158829], "S": [0.4029083220519775, -0.2912227931977257, -0.36589806843330785], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 3, "is_min": false, "A": [0.598822712898254, -0.377983033657074, -0.321768075227737], "B": [-0.0621436722576618, -0.576358199119568, 0.0829178169369698], "S": [0.5162019108741688, -0.4027799305042648, -0.271182336331812], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 4, "is_min": false, "A": [0.606083393096924, -0.618521690368652, -0.329933643341064], "B": [-0.0903313159942627, -0.578039169311523, 0.0616882294416428], "S": [0.5190315526100986, -0.6134613751289457, -0.28098090820265637], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 5, "is_min": false, "A": [0.500035345554352, -0.765267848968506, -0.42532879114151], "B": [-0.111460283398628, -0.506801962852478, 0.0210661105811596], "S": [0.4235983875638915, -0.7329596113563331, -0.3695294252350774], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 6, "is_min": false, "A": [0.4378422498703, -0.883485019207001, -0.406035482883453], "B": [-0.105482444167137, -0.470840483903885, 0.0117237325757742], "S": [0.3699266629971665, -0.831904452204148, -0.35381558085997106], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}], "4": [{"index": -6, "is_min": false, "A": [-0.863141179084778, -0.0386941991746426, -0.0305512603372335], "B": [-0.072702020406723, -0.14844274520874, -0.0867781490087509], "S": [-0.7643363050868823, -0.05241276453581024, -0.03757961993896944], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": -5, "is_min": false, "A": [-0.742333710193634, 0.0599596872925758, -0.149284452199936], "B": [-0.00241466984152794, -0.222677230834961, -0.0368724092841148], "S": [-0.6498438504653574, 0.02463008028691136, -0.1352329499219223], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": -4, "is_min": false, "A": [-0.586031913757324, 0.125348150730133, -0.268359214067459], "B": [0.0551664642989635, -0.27643358707428, -0.00867472402751446], "S": [-0.5058821139469192, 0.07512543190461321, -0.23589865177835492], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": -3, "is_min": false, "A": [-0.386165767908096, 0.137565478682518, -0.379146903753281], "B": [0.0677339062094688, -0.363990724086761, 0.0479554496705532], "S": [-0.32942830682605284, 0.07487095132820083, -0.32575910786524664], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": -2, "is_min": false, "A": [-0.159930571913719, 0.102737456560135, -0.460256397724152], "B": [0.0800356715917587, -0.433943688869476, 0.08232032507658], "S": [-0.12993479030398697, 0.0356523107612844, -0.3924343047251283], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": -1, "is_min": true, "A": [0.0734416395425797, 0.0113447681069374, -0.503071904182434], "B": [0.0735952109098434, -0.501331031322479, 0.111064478754997], "S": [0.07346083596355138, -0.052739707034408646, -0.42630485606049806], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 0, "is_min": false, "A": [0.0734416395425797, 0.0113447681069374, -0.503071904182434], "B": [0.0735952109098434, -0.501331031322479, 0.111064478754997], "S": [0.07346083596355138, -0.052739707034408646, -0.42630485606049806], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 1, "is_min": false, "A": [0.28174751996994, -0.106974579393864, -0.480847984552383], "B": [0.00620275270193815, -0.561121344566345, 0.117337688803673], "S": [0.24730443221190698, -0.1637429116070051, -0.40607479307688904], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 2, "is_min": false, "A": [0.455699265003204, -0.292180299758911, -0.438979804515839], "B": [-0.02755993232131, -0.605594575405121, 0.116206645965576], "S": [0.39529186320335774, -0.3313570855988605, -0.3695814957537182], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 3, "is_min": false, "A": [0.579714238643646, -0.433872282505035, -0.33455091714859], "B": [-0.082133561372757, -0.610551476478577, 0.0786586254835129], "S": [0.4969832748937767, -0.4559571787479763, -0.2828997313446191], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}, {"index": 4, "is_min": false, "A": [0.612340748310089, -0.674842178821564, -0.284210830926895], "B": [-0.111623004078865, -0.623321950435638, 0.052273977547884], "S": [0.5218452704268725, -0.6684021496446171, -0.24215022576139203], "P": [0.154346406459808, -0.100275993347168, -0.382444798946381]}]};

    const STATIC_COUNT  = 8;
    const DYNAMIC_COUNT = 5;

    let currentTrial = "1";
    let currentCamera = null;

    // restyle対象トレース（動的5本）
    function dynamicTraceIndices() {
      const arr = [];
      for (let i = 0; i < DYNAMIC_COUNT; i++) arr.push(STATIC_COUNT + i);
      return arr;
    }
    const DYN_IDX = dynamicTraceIndices();

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        // 初期 camera 保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ユーザー操作で camera 変化を保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey && gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
          }
        });

        // 端末回転/リサイズ：Plotlyが勝手に変えることがあるので再適用
        let resizeTimer = null;
        function handleResize() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function() {
            Plotly.Plots.resize(gd).then(function() {
              if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
            });
          }, 150);
        }
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, currentTrial);
          });
        });

        // Slider
        slider.addEventListener("input", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init
        updateSliderForTrial(gd, currentTrial);

        function updateSliderForTrial(gd, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, trialKey, initPos);
        }

        // ★ここが本丸：restyle で x/y/z だけ更新（レイアウト触らない→カメラ戻らない）
        function updateFrame(gd, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          // Bat line (trace 0)
          const x0 = [f.A[0], f.B[0]];
          const y0 = [f.A[1], f.B[1]];
          const z0 = [f.A[2], f.B[2]];

          // Bottom marker (trace 1)
          const x1 = [f.B[0]];
          const y1 = [f.B[1]];
          const z1 = [f.B[2]];

          // Sweet (trace 2)
          const x2 = [f.S[0]];
          const y2 = [f.S[1]];
          const z2 = [f.S[2]];

          // Ball (trace 3)
          const x3 = [f.P[0]];
          const y3 = [f.P[1]];
          const z3 = [f.P[2]];

          // S->P (trace 4)
          const x4 = [f.S[0], f.P[0]];
          const y4 = [f.S[1], f.P[1]];
          const z4 = [f.S[2], f.P[2]];

          // restyle は「配列の配列」にするのがコツ
          Plotly.restyle(gd, {
            x: [x0, x1, x2, x3, x4],
            y: [y0, y1, y2, y3, y4],
            z: [z0, z1, z2, z3, z4],
          }, DYN_IDX).then(function() {
            // 念押し：カメラ保持（restyleだけなら基本不要だが、iOS保険）
            if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

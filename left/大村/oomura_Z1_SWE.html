<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Oomura_Z1_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.474485, -0.474485, -0.474485, -0.474485, -0.474485, -0.474485], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.07775635, 0.07775635, 0.07775635, 0.07775635, 0.07775635, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.474485, 0.07775635], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [-0.01428384, -0.01428384, -0.01428384, -0.1983643, -0.1983643, -0.1983643, -0.3824448, -0.3824448, -0.3824448], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [0.258438587188721, -0.0177888795733452], "y": [0.16533687710762, -0.497926980257034], "z": [-0.129441931843758, 0.222380995750427], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [-0.0177888795733452], "y": [-0.497926980257034], "z": [0.222380995750427], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.22391015196222866], "y": [0.08242889041991121], "z": [-0.08546406349841151], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [0.100275993347168], "z": [-0.0142838358879089], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.22391015196222866, 0.154346406459808], "y": [0.08242889041991121, 0.100275993347168], "z": [-0.08546406349841151, -0.0142838358879089], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z1 (Z1)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -4, "is_min": false, "A": [-0.558634877204895, 0.244521498680115, -0.0954980254173279], "B": [0.0118647068738937, -0.246711909770966, 0.175093874335289], "S": [-0.4873224299318081, 0.1831173232581246, -0.061674038297701926], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": -3, "is_min": false, "A": [-0.368966341018677, 0.2972412109375, -0.119442991912365], "B": [0.0148805901408195, -0.327510714530945, 0.200473442673683], "S": [-0.32098547312641224, 0.2191472178168835, -0.07945343634116435], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": -2, "is_min": false, "A": [-0.151896849274635, 0.296545177698135, -0.153164148330688], "B": [0.0258160065859556, -0.391097575426102, 0.21502810716629], "S": [-0.1296827414602532, 0.21058983033900458, -0.10714011467019433], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": -1, "is_min": false, "A": [0.0708873718976974, 0.240166440606117, -0.172544285655022], "B": [0.0243325717747211, -0.45202910900116, 0.225824728608131], "S": [0.0650680214269412, 0.15364199013437188, -0.12274815497540958], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 0, "is_min": false, "A": [0.0708873718976974, 0.240166440606117, -0.172544285655022], "B": [0.0243325717747211, -0.45202910900116, 0.225824728608131], "S": [0.0650680214269412, 0.15364199013437188, -0.12274815497540958], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 1, "is_min": true, "A": [0.258438587188721, 0.16533687710762, -0.129441931843758], "B": [-0.0177888795733452, -0.497926980257034, 0.222380995750427], "S": [0.22391015196222866, 0.08242889041991121, -0.08546406349841151], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 2, "is_min": false, "A": [0.437062382698059, 0.0154188480228186, -0.115050315856934], "B": [-0.037292305380106, -0.537043273448944, 0.216270059347153], "S": [0.3777680446865574, -0.05363891949248855, -0.07363526755828312], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 3, "is_min": false, "A": [0.563808560371399, -0.165490686893463, -0.100536271929741], "B": [-0.058220274746418, -0.565397560596466, 0.204676389694214], "S": [0.4860549649821674, -0.21547904031985418, -0.06238469364304541], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 4, "is_min": false, "A": [0.640252351760864, -0.330946177244186, -0.0454653762280941], "B": [-0.0949914008378983, -0.557835102081299, 0.173482552170753], "S": [0.5483468938366918, -0.3593072894078381, -0.018096888498792433], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 5, "is_min": false, "A": [0.654928743839264, -0.533434748649597, -0.054499551653862], "B": [-0.119852237403393, -0.548052668571472, 0.144249066710472], "S": [0.5580811412934196, -0.5352619882604223, -0.029655979516852785], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 6, "is_min": false, "A": [0.615262687206268, -0.680535316467285, -0.0553805083036423], "B": [-0.139561414718628, -0.477626264095306, 0.115113377571106], "S": [0.5209096503983967, -0.6551716784511151, -0.03406876713317059], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}], "2": [{"index": -6, "is_min": false, "A": [-0.674533188343048, 0.17479345202446, 0.04330750182271], "B": [2.82004475593567e-05, -0.235258370637894, 0.173016145825386], "S": [-0.5902130079488613, 0.12353697006090747, 0.05952108362969655], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": -5, "is_min": false, "A": [-0.519462645053864, 0.241759687662125, -0.0265908353030682], "B": [0.0315521955490112, -0.296977609395981, 0.188222467899323], "S": [-0.45058578917344216, 0.17441752474273753, 0.0002608279110845116], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": -4, "is_min": false, "A": [-0.336484402418137, 0.269705086946487, -0.098202720284462], "B": [0.0506014302372932, -0.362016916275024, 0.203611567616463], "S": [-0.2880986731690464, 0.190739836270991, -0.06047593416650884], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": -3, "is_min": false, "A": [-0.138363316655159, 0.25929656624794, -0.146788194775581], "B": [0.0241935327649117, -0.435012727975845, 0.215854600071907], "S": [-0.11804370923932414, 0.17250789918085563, -0.10145784265710373], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": -2, "is_min": false, "A": [0.0527466163039207, 0.199458330869675, -0.184717759490013], "B": [0.0101343616843224, -0.488327652215958, 0.221649810671806], "S": [0.047420084330207904, 0.11348508062320294, -0.1339218118249629], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": -1, "is_min": true, "A": [0.250881105661392, 0.136472329497337, -0.147687524557114], "B": [-0.0349527485668659, -0.518657207489014, 0.21162348985672], "S": [0.21515187688450646, 0.05458114425380001, -0.10277365152864223], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 0, "is_min": false, "A": [0.250881105661392, 0.136472329497337, -0.147687524557114], "B": [-0.0349527485668659, -0.518657207489014, 0.21162348985672], "S": [0.21515187688450646, 0.05458114425380001, -0.10277365152864223], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 1, "is_min": false, "A": [0.418706238269806, -0.000206202268600464, -0.137282803654671], "B": [-0.0595181062817574, -0.544153153896332, 0.202457070350647], "S": [0.35892819482239197, -0.06819957165254868, -0.09481531913513476], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 2, "is_min": false, "A": [0.539646625518799, -0.172400370240211, -0.125989004969597], "B": [-0.0858130529522896, -0.55977189540863, 0.18824602663517], "S": [0.461464175665477, -0.22082180472039506, -0.08670963102074157], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 3, "is_min": false, "A": [0.617970108985901, -0.322972506284714, -0.0936717391014099], "B": [-0.112593978643417, -0.536761939525604, 0.152439102530479], "S": [0.5266496233071659, -0.34969617804346814, -0.06290789241198715], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 4, "is_min": false, "A": [0.617813289165497, -0.518985092639923, -0.151554882526398], "B": [-0.132376700639725, -0.522398412227631, 0.126300513744354], "S": [0.5240395618899478, -0.5194117574907898, -0.11682296593724413], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}], "3": [{"index": -6, "is_min": false, "A": [-0.721358001232147, 0.0871972739696503, 0.0277832522988319], "B": [0.027952216565609, -0.169019445776939, 0.141306206583977], "S": [-0.6276942438468325, 0.055170190785148794, 0.04197361857874016], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": -5, "is_min": false, "A": [-0.585054457187653, 0.18483655154705, -0.0451836362481117], "B": [0.092854343354702, -0.196981623768806, 0.140973567962646], "S": [-0.5003158548381308, 0.13710927834743172, -0.021913985095192896], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": -4, "is_min": false, "A": [-0.369848430156708, 0.231854811310768, -0.0906876400113106], "B": [0.0691585838794708, -0.365764409303665, 0.209519103169441], "S": [-0.31497255253926065, 0.15715240755926607, -0.05316179652362152], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": -3, "is_min": false, "A": [-0.160018444061279, 0.231891199946404, -0.136421531438828], "B": [0.0729916617274284, -0.440098077058792, 0.229825645685196], "S": [-0.13089218749488135, 0.1478925595197537, -0.09064064476215157], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": -2, "is_min": false, "A": [0.0544616989791393, 0.178324609994888, -0.1630669683218], "B": [0.0585477389395237, -0.508735656738281, 0.246727451682091], "S": [0.05497245398515568, 0.09244207480893699, -0.11184266472128518], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": -1, "is_min": true, "A": [0.247745364904404, 0.0965716391801834, -0.141875550150871], "B": [-0.0121200634166598, -0.553260624408722, 0.245665341615677], "S": [0.21526218520778811, 0.015342603339612265, -0.09343293695537364], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 0, "is_min": false, "A": [0.247745364904404, 0.0965716391801834, -0.141875550150871], "B": [-0.0121200634166598, -0.553260624408722, 0.245665341615677], "S": [0.21526218520778811, 0.015342603339612265, -0.09343293695537364], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 1, "is_min": false, "A": [0.413149118423462, -0.0489860624074936, -0.13319019973278], "B": [-0.0493205934762955, -0.584458649158478, 0.240160718560219], "S": [0.35534040596144956, -0.11592013398510931, -0.08652133617765384], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 2, "is_min": false, "A": [0.536772608757019, -0.231378585100174, -0.111309744417667], "B": [-0.08741295337677, -0.597681879997253, 0.229592591524124], "S": [0.45874942095609617, -0.27716649258100373, -0.06869695650243078], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 3, "is_min": false, "A": [0.626868009567261, -0.365472227334976, -0.0166791081428528], "B": [-0.116209268569946, -0.566956222057343, 0.20066924393177], "S": [0.5339833459949328, -0.39065772770703844, 0.010489436979480432], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 4, "is_min": false, "A": [0.636808276176453, -0.558258652687073, -0.0403865054249763], "B": [-0.132477730512619, -0.555276274681091, 0.179136469960213], "S": [0.5406475397184632, -0.5578858554920666, -0.012946137604765921], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}], "4": [{"index": -4, "is_min": false, "A": [-0.674308061599731, 0.117010854184628, -0.12293503433466], "B": [0.0636427104473114, -0.069595955312252, 0.123248644173145], "S": [-0.5820642040591112, 0.09368500020714551, -0.09216207083994593], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": -3, "is_min": false, "A": [-0.472175061702728, 0.237782195210457, -0.15882021188736], "B": [0.122597932815552, -0.175790056586266, 0.180595517158508], "S": [-0.3978284350406917, 0.18608566210371785, -0.11639324441713393], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": -2, "is_min": false, "A": [-0.235023200511932, 0.304726809263229, -0.19091796875], "B": [0.165909379720688, -0.254354149103165, 0.217348515987396], "S": [-0.1849066269828606, 0.2348416880729869, -0.13988465713953957], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": -1, "is_min": false, "A": [0.025325758382678, 0.287374675273895, -0.186242043972015], "B": [0.142697691917419, -0.367720246315002, 0.257688760757446], "S": [0.039997249083495924, 0.20548781560654772, -0.1307506971291424], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 0, "is_min": false, "A": [0.025325758382678, 0.287374675273895, -0.186242043972015], "B": [0.142697691917419, -0.367720246315002, 0.257688760757446], "S": [0.039997249083495924, 0.20548781560654772, -0.1307506971291424], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 1, "is_min": true, "A": [0.285197257995605, 0.19294336438179, -0.181419566273689], "B": [0.134203732013702, -0.444672614336014, 0.277543157339096], "S": [0.2663230667003796, 0.11324136473013213, -0.12404922415793751], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 2, "is_min": false, "A": [0.480057239532471, 0.0443666502833366, -0.140575081110001], "B": [0.0615804493427277, -0.503550708293915, 0.265212714672089], "S": [0.42774764038945834, -0.024123020022342484, -0.08985160627914272], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 3, "is_min": false, "A": [0.637176096439362, -0.160259589552879, -0.10080511868], "B": [0.0286602322012186, -0.540963053703308, 0.252427518367767], "S": [0.561111612252068, -0.20784752329586126, -0.05665103837710581], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 4, "is_min": false, "A": [0.650158047676086, -0.139631569385529, -0.0385635308921337], "B": [-7.00913369655609e-05, -0.519460260868073, 0.231498494744301], "S": [0.5688795280978589, -0.18711015710690204, -0.004805776773181274], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 5, "is_min": false, "A": [0.727158904075623, -0.364772886037827, -0.0158118233084679], "B": [-0.0226150378584862, -0.528390645980835, 0.210171714425087], "S": [0.6334371829117276, -0.38522510132192045, 0.01243611240460889], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}, {"index": 6, "is_min": false, "A": [0.691373646259308, -0.509810328483582, -0.142745107412338], "B": [-0.0553312562406063, -0.476841598749161, 0.142465591430664], "S": [0.5980355546879569, -0.5056892382046242, -0.10709377817020785], "P": [0.154346406459808, 0.100275993347168, -0.0142838358879089]}]};

    const STATIC_COUNT  = 8;
    const DYNAMIC_COUNT = 5;

    let currentTrial = "1";
    let currentCamera = null;

    // restyle対象トレース（動的5本）
    function dynamicTraceIndices() {
      const arr = [];
      for (let i = 0; i < DYNAMIC_COUNT; i++) arr.push(STATIC_COUNT + i);
      return arr;
    }
    const DYN_IDX = dynamicTraceIndices();

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        // 初期 camera 保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ユーザー操作で camera 変化を保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey && gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
          }
        });

        // 端末回転/リサイズ：Plotlyが勝手に変えることがあるので再適用
        let resizeTimer = null;
        function handleResize() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function() {
            Plotly.Plots.resize(gd).then(function() {
              if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
            });
          }, 150);
        }
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, currentTrial);
          });
        });

        // Slider
        slider.addEventListener("input", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init
        updateSliderForTrial(gd, currentTrial);

        function updateSliderForTrial(gd, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, trialKey, initPos);
        }

        // ★ここが本丸：restyle で x/y/z だけ更新（レイアウト触らない→カメラ戻らない）
        function updateFrame(gd, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          // Bat line (trace 0)
          const x0 = [f.A[0], f.B[0]];
          const y0 = [f.A[1], f.B[1]];
          const z0 = [f.A[2], f.B[2]];

          // Bottom marker (trace 1)
          const x1 = [f.B[0]];
          const y1 = [f.B[1]];
          const z1 = [f.B[2]];

          // Sweet (trace 2)
          const x2 = [f.S[0]];
          const y2 = [f.S[1]];
          const z2 = [f.S[2]];

          // Ball (trace 3)
          const x3 = [f.P[0]];
          const y3 = [f.P[1]];
          const z3 = [f.P[2]];

          // S->P (trace 4)
          const x4 = [f.S[0], f.P[0]];
          const y4 = [f.S[1], f.P[1]];
          const z4 = [f.S[2], f.P[2]];

          // restyle は「配列の配列」にするのがコツ
          Plotly.restyle(gd, {
            x: [x0, x1, x2, x3, x4],
            y: [y0, y1, y2, y3, y4],
            z: [z0, z1, z2, z3, z4],
          }, DYN_IDX).then(function() {
            // 念押し：カメラ保持（restyleだけなら基本不要だが、iOS保険）
            if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

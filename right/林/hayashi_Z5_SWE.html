<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>hayashi_Z5_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
          <button class="trial-btn" id="trialBtn_5" data-trial="5">5球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.5365077, -0.5365077, -0.5365077, -0.5365077, -0.5365077, -0.5365077], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.1185982, 0.1185982, 0.1185982, 0.1185982, 0.1185982, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [0.009413898, 0.009413898, 0.009413898, -0.2089548, -0.2089548, -0.2089548, -0.4273234, -0.4273234, -0.4273234], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [0.108950793743134, 0.337933272123337], "y": [-0.0675078704953194, 0.541948795318604], "z": [-0.208190605044365, 0.256706655025482], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [0.337933272123337], "y": [0.541948795318604], "z": [0.256706655025482], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.13757360655207873], "y": [0.008674220746574063], "z": [-0.15007844142162655], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [-0.0], "z": [-0.208954751491547], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.13757360655207873, 0.154346406459808], "y": [0.008674220746574063, -0.0], "z": [-0.15007844142162655, -0.208954751491547], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z5 (Z5)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -6, "is_min": false, "A": [-0.760143280029297, 0.482440739870071, 0.0577932931482792], "B": [-0.0744639039039612, 0.0705806463956833, 0.0431258343160152], "S": [-0.6744333632224463, 0.4309582313144995, 0.05595986090566868], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -5, "is_min": false, "A": [-0.675447225570679, 0.274087309837341, -0.0148902023211122], "B": [0.107199311256409, 0.173413470387459, 0.116750687360764], "S": [-0.5776164197326052, 0.26150308135519185, 0.0015649069943005165], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -4, "is_min": false, "A": [-0.551955819129944, 0.143077611923218, -0.0953780561685562], "B": [0.204175263643265, 0.22939121723175, 0.151230275630951], "S": [-0.45743942803182835, 0.1538668132433236, -0.06455201281780672], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -3, "is_min": false, "A": [-0.376588076353073, 0.0283310934901237, -0.160436719655991], "B": [0.28766593337059, 0.304736733436584, 0.189372837543488], "S": [-0.2935563376920307, 0.06288179325935848, -0.11671053161746453], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -2, "is_min": false, "A": [-0.152789533138275, -0.0601722337305546, -0.181324005126953], "B": [0.315198123455048, 0.441149681806564, 0.230578929185867], "S": [-0.09429108232604978, 0.0024929990036137925, -0.12983614384934525], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -1, "is_min": true, "A": [0.108950793743134, -0.0675078704953194, -0.208190605044365], "B": [0.337933272123337, 0.541948795318604, 0.256706655025482], "S": [0.13757360655207873, 0.008674220746574063, -0.15007844142162655], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 0, "is_min": false, "A": [0.108950793743134, -0.0675078704953194, -0.208190605044365], "B": [0.337933272123337, 0.541948795318604, 0.256706655025482], "S": [0.13757360655207873, 0.008674220746574063, -0.15007844142162655], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 1, "is_min": false, "A": [0.343747198581696, -0.0376410223543644, -0.163175627589226], "B": [0.265302836894989, 0.638900279998779, 0.256512671709061], "S": [0.3339416527598343, 0.04692664570953293, -0.11071458690787989], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 2, "is_min": false, "A": [0.582002520561218, 0.0888549759984016, -0.120048731565475], "B": [0.225858569145203, 0.698581695556641, 0.255976408720016], "S": [0.5374845298617769, 0.16507081041752253, -0.07304559243752298], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 3, "is_min": false, "A": [0.7489253282547, 0.208959370851517, -0.0148194851353765], "B": [0.154254242777824, 0.685271263122559, 0.22909340262413], "S": [0.6745914550811917, 0.26849834736441863, 0.01566962070295399], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 4, "is_min": false, "A": [0.858567178249359, 0.438374161720276, 0.035139411687851], "B": [0.117229893803596, 0.68186628818512, 0.211579412221909], "S": [0.7659000509052595, 0.4688106666200293, 0.057194403850165124], "P": [0.154346406459808, -0.0, -0.208954751491547]}], "2": [{"index": -6, "is_min": false, "A": [-0.776486814022064, 0.443702340126038, 0.0402478724718094], "B": [-0.0255217775702477, 0.170260265469551, 0.00445978716015816], "S": [-0.6826161728209181, 0.4095220765539097, 0.03577436125291318], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -5, "is_min": false, "A": [-0.702563881874084, 0.303405612707138, -0.0649414584040642], "B": [0.0842055976390839, 0.196636661887169, 0.0330090522766113], "S": [-0.6042177065617391, 0.2900594951610518, -0.05269764576748849], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -4, "is_min": false, "A": [-0.568936586380005, 0.153211802244186, -0.159349203109741], "B": [0.189319789409637, 0.251689225435257, 0.0759155079722404], "S": [-0.4741545407824524, 0.1655214799643441, -0.12994111465147312], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -3, "is_min": false, "A": [-0.380771458148956, 0.0365410968661308, -0.267173647880554], "B": [0.292789399623871, 0.269277095794678, 0.0963509529829025], "S": [-0.2965763778798952, 0.06563308741926653, -0.22173308731906144], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -2, "is_min": false, "A": [-0.133470118045807, -0.0538972578942776, -0.266262412071228], "B": [0.258091151714325, 0.492374777793884, 0.167635008692741], "S": [-0.0845249722005295, 0.01438672860503283, -0.21202524874250567], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -1, "is_min": true, "A": [0.146379232406616, -0.0501053743064404, -0.287620037794113], "B": [0.262302458286285, 0.581469833850861, 0.189532518386841], "S": [0.1608696356446617, 0.02884152673004132, -0.22797596825878702], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 0, "is_min": false, "A": [0.146379232406616, -0.0501053743064404, -0.287620037794113], "B": [0.262302458286285, 0.581469833850861, 0.189532518386841], "S": [0.1608696356446617, 0.02884152673004132, -0.22797596825878702], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 1, "is_min": false, "A": [0.441001564264297, 0.0382770970463753, -0.257237166166306], "B": [0.241421714425087, 0.661912500858307, 0.202378645539284], "S": [0.4160540816256289, 0.11623152692489867, -0.1997851864588343], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 2, "is_min": false, "A": [0.647065043449402, 0.129175469279289, -0.139269977807999], "B": [0.160026788711548, 0.676531553268433, 0.181970655918121], "S": [0.5861852848658392, 0.19759495363876556, -0.09911491393318411], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 3, "is_min": false, "A": [0.81204891204834, 0.355997055768967, -0.0643920451402664], "B": [0.122147291898727, 0.688774466514587, 0.166464924812317], "S": [0.7258112089342821, 0.3975942323993425, -0.03553492369697356], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 4, "is_min": false, "A": [0.862323760986328, 0.622660577297211, -0.0400425381958485], "B": [0.0850390717387199, 0.680142819881439, 0.140302538871765], "S": [0.7651631781075567, 0.6298458573778835, -0.01749940432276589], "P": [0.154346406459808, -0.0, -0.208954751491547]}], "3": [{"index": -4, "is_min": false, "A": [-0.695310473442078, 0.272699177265167, -0.0783392563462257], "B": [0.0919332131743431, 0.207311064004898, 0.0480413101613522], "S": [-0.5969050337617314, 0.2645256648640695, -0.06254168892757571], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -3, "is_min": false, "A": [-0.539386510848999, 0.0963265746831894, -0.162080138921738], "B": [0.204405710101128, 0.264907449483871, 0.0794848650693893], "S": [-0.4464124854418323, 0.11739918353201456, -0.13188451414111887], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -2, "is_min": false, "A": [-0.328570455312729, -0.0394840687513351, -0.257101029157639], "B": [0.31226846575737, 0.284428179264069, 0.0956119298934937], "S": [-0.24846559635300378, 0.001004959129921254, -0.21301191267439137], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -1, "is_min": false, "A": [-0.0154408738017082, -0.0800843462347984, -0.287405222654343], "B": [0.295963138341904, 0.50759881734848, 0.15718024969101], "S": [0.023484621580645147, -0.006623962366019295, -0.23183204737084848], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 0, "is_min": false, "A": [-0.0154408738017082, -0.0800843462347984, -0.287405222654343], "B": [0.295963138341904, 0.50759881734848, 0.15718024969101], "S": [0.023484621580645147, -0.006623962366019295, -0.23183204737084848], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 1, "is_min": true, "A": [0.261364251375198, -0.0713364779949188, -0.248407080769539], "B": [0.230174705386162, 0.610796272754669, 0.168393030762672], "S": [0.2574655587674083, 0.013930101833255645, -0.1963070753918471], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 2, "is_min": false, "A": [0.538520574569702, 0.0462343916296959, -0.198186904191971], "B": [0.199354901909828, 0.668897449970245, 0.172295957803726], "S": [0.4961248717394359, 0.12406726244402369, -0.15187655327203162], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 3, "is_min": false, "A": [0.756012558937073, 0.243048921227455, -0.107128694653511], "B": [0.161050662398338, 0.701866626739502, 0.167656168341637], "S": [0.681642325713485, 0.30040113145226705, -0.07278058855436632], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 4, "is_min": false, "A": [0.858984529972076, 0.462088763713837, -0.027054775506258], "B": [0.101487793028355, 0.664628446102142, 0.131616070866585], "S": [0.7642974428038053, 0.4874062226889245, -0.007220920746452086], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 5, "is_min": false, "A": [0.855766654014587, 0.74810254573822, -0.0312610380351543], "B": [0.0737150311470032, 0.651895999908447, 0.107086107134819], "S": [0.7580102296328103, 0.7360767310126459, -0.01396764992651138], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 6, "is_min": false, "A": [0.780616641044617, 0.911687195301056, -0.0578639842569828], "B": [0.0727667808532715, 0.564250886440277, 0.077178917825222], "S": [0.692135408430178, 0.868257656649028, -0.04098362147943772], "P": [0.154346406459808, -0.0, -0.208954751491547]}], "4": [{"index": -6, "is_min": false, "A": [-0.780859470367432, 0.708708465099335, 0.111675448715687], "B": [-0.293747663497925, 0.0914405658841133, -0.0356417372822762], "S": [-0.719970490945007, 0.6315499731814667, 0.09326079938816102], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -5, "is_min": false, "A": [-0.780090808868408, 0.579378724098206, -0.00243146857246757], "B": [-0.166060164570808, 0.0672437101602554, -0.0285872239619493], "S": [-0.7033369800208562, 0.515361848765221, -0.005700937924179136], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -4, "is_min": false, "A": [-0.727328479290009, 0.356015235185623, -0.100659511983395], "B": [0.0191797278821468, 0.0948869213461876, 0.0199133194983006], "S": [-0.6340149758000657, 0.32337420379350623, -0.08558791166719797], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -3, "is_min": false, "A": [-0.60043740272522, 0.170859441161156, -0.202991530299187], "B": [0.15637443959713, 0.123407319188118, 0.0519280284643173], "S": [-0.5058359113487596, 0.16492792521942332, -0.171126581719557], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -2, "is_min": false, "A": [-0.384905308485031, -0.00833236332982779, -0.276046842336655], "B": [0.289680391550064, 0.198666498064995, 0.100895568728447], "S": [-0.3005820944371449, 0.017542494818152926, -0.22892904009104664], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -1, "is_min": true, "A": [-0.0504019558429718, -0.0983997657895088, -0.302934765815735], "B": [0.370361268520355, 0.385602027177811, 0.175292313098907], "S": [0.002193423962710765, -0.03789956840114061, -0.2431564073650006], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 0, "is_min": false, "A": [-0.0504019558429718, -0.0983997657895088, -0.302934765815735], "B": [0.370361268520355, 0.385602027177811, 0.175292313098907], "S": [0.002193423962710765, -0.03789956840114061, -0.2431564073650006], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 1, "is_min": false, "A": [0.275206804275513, -0.12419181317091, -0.337384819984436], "B": [0.473198652267456, 0.429575175046921, 0.204963460564613], "S": [0.2999557793477917, -0.054970956220215264, -0.26959130115052987], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 2, "is_min": false, "A": [0.616743981838226, -0.0881021842360497, -0.332802027463913], "B": [0.574168860912323, 0.473857432603836, 0.234990626573563], "S": [0.6114220906824724, -0.01785721840363816, -0.2618279318393145], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 3, "is_min": false, "A": [0.742877602577209, 0.417440056800842, -0.253911942243576], "B": [0.220249891281128, 0.766998767852783, 0.240728676319122], "S": [0.6775491569683365, 0.4611348834403103, -0.19208188224623005], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 4, "is_min": false, "A": [0.790455937385559, 0.723096132278442, -0.210631921887398], "B": [0.122301176190376, 0.800744414329529, 0.222427144646645], "S": [0.7069366050068281, 0.7328021660507101, -0.1564995468478464], "P": [0.154346406459808, -0.0, -0.208954751491547]}], "5": [{"index": -6, "is_min": false, "A": [-0.706436038017273, 0.336808741092682, -0.0182430557906628], "B": [0.0721715986728668, 0.164254412055016, 0.0449635870754719], "S": [-0.6091100779628261, 0.31523944875112075, -0.010342224988494257], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -5, "is_min": false, "A": [-0.616443634033203, 0.211090177297592, -0.109813287854195], "B": [0.162362948060036, 0.20845890045166, 0.0730888247489929], "S": [-0.5190927959634548, 0.21076126764013056, -0.08695052018370286], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -4, "is_min": false, "A": [-0.480728656053543, 0.0676043331623077, -0.176673248410225], "B": [0.223945260047913, 0.305879443883896, 0.117706619203091], "S": [-0.3926444071047789, 0.09738872519317848, -0.13987576101660587], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -3, "is_min": false, "A": [-0.29464066028595, -0.0230179484933615, -0.247646108269691], "B": [0.270345628261566, 0.380925834178925, 0.149368181824684], "S": [-0.2240173980719165, 0.02747500728567811, -0.19801933877031874], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -2, "is_min": false, "A": [-0.0801808536052704, -0.092705637216568, -0.282179594039917], "B": [0.253545880317688, 0.474017709493637, 0.173288658261299], "S": [-0.0384650188228283, -0.021865230693507667, -0.22524607199840313], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": -1, "is_min": true, "A": [0.16333244740963, -0.0857362896203995, -0.306560903787613], "B": [0.250811129808426, 0.537460744380951, 0.187375262379646], "S": [0.1742672827153713, -0.007836660328257389, -0.2448188829834383], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 0, "is_min": false, "A": [0.16333244740963, -0.0857362896203995, -0.306560903787613], "B": [0.250811129808426, 0.537460744380951, 0.187375262379646], "S": [0.1742672827153713, -0.007836660328257389, -0.2448188829834383], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 1, "is_min": false, "A": [0.413117080926895, -0.0497436448931694, -0.250378400087357], "B": [0.234186574816704, 0.591574192047119, 0.193125531077385], "S": [0.3907507751934566, 0.03042105773434378, -0.19494042735673903], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 2, "is_min": false, "A": [0.617205083370209, 0.025380402803421, -0.160000935196877], "B": [0.182433351874352, 0.605237603187561, 0.178730711340904], "S": [0.5628586152226477, 0.09786255513284631, -0.11765947804693827], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 3, "is_min": false, "A": [0.788200795650482, 0.208730638027191, -0.107633195817471], "B": [0.158257395029068, 0.617545604705811, 0.168123364448547], "S": [0.7094578733716644, 0.2598325070456402, -0.07316362700941419], "P": [0.154346406459808, -0.0, -0.208954751491547]}, {"index": 4, "is_min": false, "A": [0.885306537151337, 0.385159015655518, -0.025925450026989], "B": [0.12658317387104, 0.579905211925507, 0.136595636606216], "S": [0.7904661409366699, 0.4095022839788921, -0.0056103193805676944], "P": [0.154346406459808, -0.0, -0.208954751491547]}]};

    const STATIC_COUNT  = 8;
    const DYNAMIC_COUNT = 5;

    let currentTrial = "1";
    let currentCamera = null;

    // restyle対象トレース（動的5本）
    function dynamicTraceIndices() {
      const arr = [];
      for (let i = 0; i < DYNAMIC_COUNT; i++) arr.push(STATIC_COUNT + i);
      return arr;
    }
    const DYN_IDX = dynamicTraceIndices();

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        // 初期 camera 保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ユーザー操作で camera 変化を保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey && gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
          }
        });

        // 端末回転/リサイズ：Plotlyが勝手に変えることがあるので再適用
        let resizeTimer = null;
        function handleResize() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function() {
            Plotly.Plots.resize(gd).then(function() {
              if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
            });
          }, 150);
        }
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, currentTrial);
          });
        });

        // Slider
        slider.addEventListener("input", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init
        updateSliderForTrial(gd, currentTrial);

        function updateSliderForTrial(gd, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, trialKey, initPos);
        }

        // ★ここが本丸：restyle で x/y/z だけ更新（レイアウト触らない→カメラ戻らない）
        function updateFrame(gd, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          // Bat line (trace 0)
          const x0 = [f.A[0], f.B[0]];
          const y0 = [f.A[1], f.B[1]];
          const z0 = [f.A[2], f.B[2]];

          // Bottom marker (trace 1)
          const x1 = [f.B[0]];
          const y1 = [f.B[1]];
          const z1 = [f.B[2]];

          // Sweet (trace 2)
          const x2 = [f.S[0]];
          const y2 = [f.S[1]];
          const z2 = [f.S[2]];

          // Ball (trace 3)
          const x3 = [f.P[0]];
          const y3 = [f.P[1]];
          const z3 = [f.P[2]];

          // S->P (trace 4)
          const x4 = [f.S[0], f.P[0]];
          const y4 = [f.S[1], f.P[1]];
          const z4 = [f.S[2], f.P[2]];

          // restyle は「配列の配列」にするのがコツ
          Plotly.restyle(gd, {
            x: [x0, x1, x2, x3, x4],
            y: [y0, y1, y2, y3, y4],
            z: [z0, z1, z2, z3, z4],
          }, DYN_IDX).then(function() {
            // 念押し：カメラ保持（restyleだけなら基本不要だが、iOS保険）
            if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

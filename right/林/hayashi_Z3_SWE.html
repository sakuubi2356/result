<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>hayashi_Z3_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
          <button class="trial-btn" id="trialBtn_5" data-trial="5">5球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.5365077, -0.5365077, -0.5365077, -0.5365077, -0.5365077, -0.5365077], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.1185982, 0.1185982, 0.1185982, 0.1185982, 0.1185982, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [0.009413898, 0.009413898, 0.009413898, -0.2089548, -0.2089548, -0.2089548, -0.4273234, -0.4273234, -0.4273234], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [0.0419803857803345, 0.295463562011719], "y": [-0.167872786521912, 0.442894220352173], "z": [-0.27058732509613, 0.179645746946335], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [0.295463562011719], "y": [0.442894220352173], "z": [0.179645746946335], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.07366578586692171], "y": [-0.09152690329521812], "z": [-0.21430818565984397], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [-0.100275993347168], "z": [0.00941389799118042], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.07366578586692171, 0.154346406459808], "y": [-0.09152690329521812, -0.100275993347168], "z": [-0.21430818565984397, 0.00941389799118042], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z3 (Z3)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -6, "is_min": false, "A": [-0.757945120334625, 0.465123504400253, 0.0643309503793716], "B": [-0.0681821629405022, 0.0616564936935902, 0.0263658817857504], "S": [-0.6717247447700916, 0.4146901246164918, 0.0595853164809642], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -5, "is_min": false, "A": [-0.711887061595917, 0.290325284004211, -0.0188280288130045], "B": [0.0648719817399979, 0.113896057009697, 0.0554562956094742], "S": [-0.6147921845466718, 0.26827163139482957, -0.009542488582264428], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -4, "is_min": false, "A": [-0.602455377578735, 0.130093559622765, -0.122563794255257], "B": [0.171546012163162, 0.154886111617088, 0.0782027840614319], "S": [-0.505705206954416, 0.13319262852296807, -0.09746797276806604], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -3, "is_min": false, "A": [-0.445181608200073, -0.0242955051362514, -0.178307875990868], "B": [0.231641530990601, 0.275073498487473, 0.125482782721519], "S": [-0.36057872415547476, 0.013125616621510523, -0.1403340474016011], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -2, "is_min": false, "A": [-0.214767336845398, -0.126543164253235, -0.244402468204498], "B": [0.281916677951813, 0.357019275426865, 0.154937475919724], "S": [-0.15268183667387805, -0.06609786092702044, -0.19448497653820818], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -1, "is_min": true, "A": [0.0419803857803345, -0.167872786521912, -0.27058732509613], "B": [0.295463562011719, 0.442894220352173, 0.179645746946335], "S": [0.07366578586692171, -0.09152690329521812, -0.21430818565984397], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 0, "is_min": false, "A": [0.0419803857803345, -0.167872786521912, -0.27058732509613], "B": [0.295463562011719, 0.442894220352173, 0.179645746946335], "S": [0.07366578586692171, -0.09152690329521812, -0.21430818565984397], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 1, "is_min": false, "A": [0.358240306377411, -0.0959151834249496, -0.319304883480072], "B": [0.358155071735382, 0.509641826152802, 0.203476756811142], "S": [0.3582296520466791, -0.020220553829707902, -0.25395717551013325], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 2, "is_min": false, "A": [0.573611497879028, -0.0197951681911945, -0.19915571808815], "B": [0.198419347405434, 0.568592369556427, 0.192035794258118], "S": [0.5267124733424854, 0.0537532830090491, -0.15025677307329138], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 3, "is_min": false, "A": [0.744439721107483, 0.177185952663422, -0.169269546866417], "B": [0.155349135398865, 0.588055789470673, 0.183091625571251], "S": [0.6708034057643726, 0.22854467677495627, -0.12522440501938334], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 4, "is_min": false, "A": [0.785893380641937, 0.353505611419678, -0.181616872549057], "B": [0.074492558836937, 0.532656610012054, 0.137466460466385], "S": [0.6969683045222544, 0.3758994795435906, -0.1417314678556423], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}], "2": [{"index": -6, "is_min": false, "A": [-0.704790711402893, 0.619483530521393, 0.0554804354906082], "B": [-0.0417128503322601, 0.184190794825554, 0.159635171294212], "S": [-0.6219059933115678, 0.5650719481061749, 0.0684997751817558], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -5, "is_min": false, "A": [-0.65953540802002, 0.437465488910675, -0.0175344161689281], "B": [0.0756137892603874, 0.19766528904438, 0.187529906630516], "S": [-0.5676417479216482, 0.4074904605224855, 0.008098627092693263], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -4, "is_min": false, "A": [-0.562334954738617, 0.228361889719963, -0.0495210401713848], "B": [0.188482016324997, 0.278072774410248, 0.222145676612854], "S": [-0.46848284076867386, 0.2345757498154403, -0.015562703255590123], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -3, "is_min": false, "A": [-0.378929257392883, 0.0497558414936066, -0.101733595132828], "B": [0.276824057102203, 0.348046362400055, 0.246132522821426], "S": [-0.29696012384211784, 0.08704214261422596, -0.05825034670680397], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -2, "is_min": false, "A": [-0.120978809893131, -0.0824097543954849, -0.156861618161201], "B": [0.375693380832672, 0.379086762666702, 0.267800539731979], "S": [-0.05889479811258217, -0.02472270096875362, -0.10377885873618499], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -1, "is_min": true, "A": [0.127121940255165, -0.139255449175835, -0.0934065505862236], "B": [0.31179341673851, 0.553938448429108, 0.26068189740181], "S": [0.15020587548462327, -0.05260620946386792, -0.0491454933049041], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 0, "is_min": false, "A": [0.127121940255165, -0.139255449175835, -0.0934065505862236], "B": [0.31179341673851, 0.553938448429108, 0.26068189740181], "S": [0.15020587548462327, -0.05260620946386792, -0.0491454933049041], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 1, "is_min": false, "A": [0.415142387151718, -0.0998525470495224, -0.0680929869413376], "B": [0.300935357809067, 0.622150123119354, 0.256974428892136], "S": [0.4008665076598885, -0.009602208069199286, -0.027459557616808072], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 2, "is_min": false, "A": [0.669425010681152, 0.0273800753057003, -0.0167659744620323], "B": [0.272083878517151, 0.668515741825104, 0.249815478920937], "S": [0.6197573920341537, 0.10752199671274833, 0.016556691864702117], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 3, "is_min": false, "A": [0.831806063652039, 0.174858093261719, 0.0995576456189156], "B": [0.199735254049301, 0.648709297180176, 0.225856781005859], "S": [0.7527972089584141, 0.2340894963703723, 0.11534503824030434], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 4, "is_min": false, "A": [0.92906528711319, 0.429890662431717, 0.0709925144910812], "B": [0.169000059366226, 0.640730559825897, 0.204585388302803], "S": [0.8340571090537685, 0.45624565642747594, 0.0876916280397928], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}], "3": [{"index": -4, "is_min": false, "A": [-0.647081971168518, 0.128531560301781, -0.0961559638381004], "B": [0.105589330196381, 0.153864338994026, 0.173741042613983], "S": [-0.5529980755260893, 0.1316981570651913, -0.06241884413764955], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -3, "is_min": false, "A": [-0.488854289054871, -0.0419278666377068, -0.133462712168694], "B": [0.166516244411469, 0.263951241970062, 0.208484187722206], "S": [-0.40693298821590124, -0.0036929854567085696, -0.09071935794928394], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -2, "is_min": false, "A": [-0.263112902641296, -0.155964314937592, -0.172614097595215], "B": [0.210502281785011, 0.346700608730316, 0.231138974428177], "S": [-0.203911000498153, -0.09313119513839287, -0.12214496010572337], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -1, "is_min": false, "A": [-0.0364985689520836, -0.239304304122925, -0.141509413719177], "B": [0.175292477011681, 0.435352146625519, 0.232633888721466], "S": [-0.010024687884957514, -0.1549722467547418, -0.09474150034587026], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 0, "is_min": false, "A": [-0.0364985689520836, -0.239304304122925, -0.141509413719177], "B": [0.175292477011681, 0.435352146625519, 0.232633888721466], "S": [-0.010024687884957514, -0.1549722467547418, -0.09474150034587026], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 1, "is_min": true, "A": [0.23604853451252, -0.220891207456589, -0.123468838632107], "B": [0.161597892642021, 0.490522414445877, 0.234787732362747], "S": [0.22674220435260792, -0.1319645054249355, -0.07868676761335855], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 2, "is_min": false, "A": [0.492872565984726, -0.120530985295773, -0.0775900557637215], "B": [0.140651240944862, 0.527744472026825, 0.231730833649635], "S": [0.4488449121530221, -0.039496574845586455, -0.03892495494830468], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 3, "is_min": false, "A": [0.676957607269287, -0.00338682346045971, 0.0250762514770031], "B": [0.0882096514105797, 0.506797611713409, 0.206976756453514], "S": [0.6033641189465045, 0.06038622559865946, 0.047813812696000754], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 4, "is_min": false, "A": [0.802960097789764, 0.220070660114288, 0.0362495183944702], "B": [0.06700699031353, 0.491643726825714, 0.193160220980644], "S": [0.7109659504111795, 0.25401729675365003, 0.05586335812468134], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 5, "is_min": false, "A": [0.821246862411499, 0.464776247739792, -0.0394909270107746], "B": [0.0525943674147129, 0.473354190587997, 0.18209420144558], "S": [0.7251653161742695, 0.46584849042130905, -0.011792790461629989], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 6, "is_min": false, "A": [0.800734341144562, 0.639513552188873, 0.00406626053154469], "B": [0.054614219814539, 0.407539516687393, 0.175801217556], "S": [0.7074693321035292, 0.6105167996555624, 0.025533128749755662], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}], "4": [{"index": -6, "is_min": false, "A": [-0.732517540454865, 0.505642056465149, 0.0651064142584801], "B": [-0.0427996665239334, 0.102587461471558, 0.107958264648914], "S": [-0.6463028084528679, 0.455260233399584, 0.07046289541815336], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -5, "is_min": false, "A": [-0.68264365196228, 0.326893210411072, 0.00497636664658785], "B": [0.0857578739523888, 0.157950714230537, 0.149950698018074], "S": [-0.586593463384099, 0.305775398863661, 0.023098157660278923], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -4, "is_min": false, "A": [-0.566731691360474, 0.170997560024261, -0.0851212590932846], "B": [0.191486716270447, 0.162803411483765, 0.169904544949532], "S": [-0.4719544243537731, 0.16997329182356968, -0.053243045006018355], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -3, "is_min": false, "A": [-0.399771988391876, 0.0201814733445644, -0.170873165130615], "B": [0.298839628696442, 0.167554914951324, 0.189990699291229], "S": [-0.3124455261223667, 0.03860315568308391, -0.12576517684349836], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -2, "is_min": false, "A": [-0.160109579563141, -0.0957017540931702, -0.148933097720146], "B": [0.294787645339966, 0.437248170375824, 0.237115070223808], "S": [-0.10324743956359073, -0.02908302889791191, -0.1006770878557757], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -1, "is_min": true, "A": [0.108710072934628, -0.12576362490654, -0.156620770692825], "B": [0.301919639110565, 0.535554647445679, 0.249985039234161], "S": [0.1328612672259407, -0.04309884593058658, -0.10579504756801313], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 0, "is_min": false, "A": [0.108710072934628, -0.12576362490654, -0.156620770692825], "B": [0.301919639110565, 0.535554647445679, 0.249985039234161], "S": [0.1328612672259407, -0.04309884593058658, -0.10579504756801313], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 1, "is_min": false, "A": [0.345176041126251, -0.134562566876411, -0.0581645853817463], "B": [0.219645202159882, 0.599179983139038, 0.234861478209496], "S": [0.32948469109989553, -0.04284477644080652, -0.02153633874119669], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 2, "is_min": false, "A": [0.585195362567902, -0.0195860303938389, 0.0050816535949707], "B": [0.181362241506577, 0.634445667266846, 0.22680675983429], "S": [0.5347162490135824, 0.06216788876853854, 0.032797277282009776], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 3, "is_min": false, "A": [0.767419695854187, 0.183008283376694, 0.0393971502780914], "B": [0.13633006811142, 0.643446087837219, 0.211800903081894], "S": [0.6885335012611464, 0.24056300245927462, 0.06094761695410961], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 4, "is_min": false, "A": [0.852501928806305, 0.367545545101166, 0.0640101730823517], "B": [0.0880497992038727, 0.574694693088531, 0.176715210080147], "S": [0.7569454315179931, 0.3934391834748667, 0.07809829991883512], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}], "5": [{"index": -6, "is_min": false, "A": [-0.7564936876297, 0.363421142101288, 0.0574940107762814], "B": [-0.0242382921278477, 0.0495724752545357, 0.130301266908646], "S": [-0.6649617522130398, 0.3241900540398151, 0.06659491888444839], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -5, "is_min": false, "A": [-0.672995686531067, 0.180410295724869, -0.0133646642789245], "B": [0.102814733982086, 0.12775793671608, 0.174639984965324], "S": [-0.5760193709072002, 0.17382874996243888, 0.010135920041411402], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -4, "is_min": false, "A": [-0.525592684745789, 0.0177518352866173, -0.082357183098793], "B": [0.211259454488754, 0.147264450788498, 0.200972691178322], "S": [-0.43348619686782347, 0.033940907034661114, -0.0469409601674459], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -3, "is_min": false, "A": [-0.324405044317245, -0.111479222774506, -0.126306653022766], "B": [0.234881773591042, 0.33986359834671, 0.225101947784424], "S": [-0.25449419708087934, -0.05506137417109069, -0.08238058106480856], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -2, "is_min": false, "A": [-0.0576749369502068, -0.175476849079132, -0.159817188978195], "B": [0.256199300289154, 0.442557156085968, 0.239578545093536], "S": [-0.01844065793093419, -0.09822259968511607, -0.10989272302807135], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": -1, "is_min": true, "A": [0.22587189078331, -0.154989838600159, -0.161114826798439], "B": [0.241217732429504, 0.536224544048309, 0.241361662745476], "S": [0.2277901207758737, -0.06858805037262673, -0.1108052711973378], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 0, "is_min": false, "A": [0.22587189078331, -0.154989838600159, -0.161114826798439], "B": [0.241217732429504, 0.536224544048309, 0.241361662745476], "S": [0.2277901207758737, -0.06858805037262673, -0.1108052711973378], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 1, "is_min": false, "A": [0.474169790744781, -0.0956238508224487, -0.0693477168679237], "B": [0.142418578267097, 0.57391881942749, 0.216403961181641], "S": [0.4327008981194768, -0.011931035072689083, -0.03362876480731896], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 2, "is_min": false, "A": [0.689729452133179, 0.0833605751395226, 0.0070529580116272], "B": [0.102511331439018, 0.58909684419632, 0.205560714006424], "S": [0.6163271655017544, 0.14657762732676022, 0.0318664347940985], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 3, "is_min": false, "A": [0.815634429454803, 0.336831629276276, 0.0704600363969803], "B": [0.0623099580407143, 0.578025102615356, 0.19015933573246], "S": [0.7214688685471877, 0.36698081407787525, 0.08542244912866259], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}, {"index": 4, "is_min": false, "A": [0.824020326137543, 0.53475946187973, -0.0139492899179459], "B": [0.0463511869311333, 0.503683865070343, 0.171159952878952], "S": [0.7268117152201709, 0.5308750135366319, 0.009189357937639083], "P": [0.154346406459808, -0.100275993347168, 0.00941389799118042]}]};

    const STATIC_COUNT  = 8;
    const DYNAMIC_COUNT = 5;

    let currentTrial = "1";
    let currentCamera = null;

    // restyle対象トレース（動的5本）
    function dynamicTraceIndices() {
      const arr = [];
      for (let i = 0; i < DYNAMIC_COUNT; i++) arr.push(STATIC_COUNT + i);
      return arr;
    }
    const DYN_IDX = dynamicTraceIndices();

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        // 初期 camera 保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ユーザー操作で camera 変化を保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey && gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
          }
        });

        // 端末回転/リサイズ：Plotlyが勝手に変えることがあるので再適用
        let resizeTimer = null;
        function handleResize() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function() {
            Plotly.Plots.resize(gd).then(function() {
              if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
            });
          }, 150);
        }
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, currentTrial);
          });
        });

        // Slider
        slider.addEventListener("input", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init
        updateSliderForTrial(gd, currentTrial);

        function updateSliderForTrial(gd, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, trialKey, initPos);
        }

        // ★ここが本丸：restyle で x/y/z だけ更新（レイアウト触らない→カメラ戻らない）
        function updateFrame(gd, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          // Bat line (trace 0)
          const x0 = [f.A[0], f.B[0]];
          const y0 = [f.A[1], f.B[1]];
          const z0 = [f.A[2], f.B[2]];

          // Bottom marker (trace 1)
          const x1 = [f.B[0]];
          const y1 = [f.B[1]];
          const z1 = [f.B[2]];

          // Sweet (trace 2)
          const x2 = [f.S[0]];
          const y2 = [f.S[1]];
          const z2 = [f.S[2]];

          // Ball (trace 3)
          const x3 = [f.P[0]];
          const y3 = [f.P[1]];
          const z3 = [f.P[2]];

          // S->P (trace 4)
          const x4 = [f.S[0], f.P[0]];
          const y4 = [f.S[1], f.P[1]];
          const z4 = [f.S[2], f.P[2]];

          // restyle は「配列の配列」にするのがコツ
          Plotly.restyle(gd, {
            x: [x0, x1, x2, x3, x4],
            y: [y0, y1, y2, y3, y4],
            z: [z0, z1, z2, z3, z4],
          }, DYN_IDX).then(function() {
            // 念押し：カメラ保持（restyleだけなら基本不要だが、iOS保険）
            if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

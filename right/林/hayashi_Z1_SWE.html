<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>hayashi_Z1_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
          <button class="trial-btn" id="trialBtn_5" data-trial="5">5球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.5365077, -0.5365077, -0.5365077, -0.5365077, -0.5365077, -0.5365077], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.1185982, 0.1185982, 0.1185982, 0.1185982, 0.1185982, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [0.009413898, 0.009413898, 0.009413898, -0.2089548, -0.2089548, -0.2089548, -0.4273234, -0.4273234, -0.4273234], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [-0.0168913677334785, 0.286253213882446], "y": [0.0180454086512327, 0.628226220607758], "z": [-0.182858675718307, 0.236406326293945], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [0.286253213882446], "y": [0.628226220607758], "z": [0.236406326293945], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.02100169305128392], "y": [0.09431798615835349], "z": [-0.1304505669489328], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [0.100275993347168], "z": [0.00941389799118042], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.02100169305128392, 0.154346406459808], "y": [0.09431798615835349, 0.100275993347168], "z": [-0.1304505669489328, 0.00941389799118042], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z1 (Z1)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -6, "is_min": false, "A": [-0.772567451000214, 0.7016921043396, 0.14158096909523], "B": [-0.154660269618034, 0.197193384170532, 0.0809868276119232], "S": [-0.6953290468972232, 0.6386297590684273, 0.13400670077924692], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": -5, "is_min": false, "A": [-0.752659559249878, 0.534060597419739, 0.0639239475131035], "B": [-0.00990751013159752, 0.241510391235352, 0.116209618747234], "S": [-0.6598155546350801, 0.49749182224734234, 0.07045965631001908], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": -4, "is_min": false, "A": [-0.673041105270386, 0.354087620973587, -0.00882240012288094], "B": [0.109494253993034, 0.292704910039902, 0.145678579807281], "S": [-0.5752241837193236, 0.34641478197798753, 0.010490222692803974], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": -3, "is_min": false, "A": [-0.52351576089859, 0.182857856154442, -0.0756373777985573], "B": [0.214850425720215, 0.361124217510223, 0.175433292984962], "S": [-0.4312199877775141, 0.20514115127411298, -0.044253544020758095], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": -2, "is_min": false, "A": [-0.301400542259216, 0.0597518011927605, -0.128895029425621], "B": [0.258325308561325, 0.517302811145782, 0.213675126433372], "S": [-0.231434825472146, 0.11694566553024112, -0.08607376885779816], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": -1, "is_min": true, "A": [-0.0168913677334785, 0.0180454086512327, -0.182858675718307], "B": [0.286253213882446, 0.628226220607758, 0.236406326293945], "S": [0.02100169305128392, 0.09431798615835349, -0.1304505669489328], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 0, "is_min": false, "A": [-0.0168913677334785, 0.0180454086512327, -0.182858675718307], "B": [0.286253213882446, 0.628226220607758, 0.236406326293945], "S": [0.02100169305128392, 0.09431798615835349, -0.1304505669489328], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 1, "is_min": false, "A": [0.347688645124435, 0.0991254150867462, -0.207798987627029], "B": [0.287782937288284, 0.750425338745117, 0.252874702215195], "S": [0.3402004347624774, 0.1805378716496525, -0.15021480037073467], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 2, "is_min": false, "A": [0.659893095493317, 0.302566468715668, -0.236656755208969], "B": [0.34278130531311, 0.832130610942841, 0.272265940904617], "S": [0.6202541334521761, 0.36876196690311586, -0.1730414370221], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 3, "is_min": false, "A": [0.73423171043396, 0.386445075273514, 0.0207160599529743], "B": [0.0784174203872681, 0.799859821796417, 0.218189761042595], "S": [0.6522549240688686, 0.4381219186577494, 0.045400272622074855], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 4, "is_min": false, "A": [0.820725619792938, 0.666496634483337, 0.0682784467935562], "B": [0.0432582572102547, 0.796178579330444, 0.205127030611038], "S": [0.7235422329978681, 0.6827068719967773, 0.08538451386923682], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}], "2": [{"index": -4, "is_min": false, "A": [-0.748023271560669, 0.367700487375259, -0.01750148832798], "B": [0.0255777575075626, 0.209928244352341, 0.111530847847462], "S": [-0.6513231411610634, 0.34797895663721135, -0.0013724460114780124], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": -3, "is_min": false, "A": [-0.610869765281677, 0.190908998250961, -0.094408243894577], "B": [0.147445186972618, 0.266146570444107, 0.14910301566124], "S": [-0.5160803957028084, 0.20031369482938394, -0.06396933627442013], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": -2, "is_min": false, "A": [-0.393545746803284, 0.0515629574656487, -0.139618322253227], "B": [0.225371658802032, 0.424619644880295, 0.20355786383152], "S": [-0.31618106757779263, 0.09819504551709295, -0.0967212970381941], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": -1, "is_min": false, "A": [-0.119514882564545, -0.0277868565171957, -0.20146806538105], "B": [0.325075000524521, 0.475625157356262, 0.233177110552788], "S": [-0.06394115798141467, 0.035139632984676095, -0.14713742895067866], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 0, "is_min": false, "A": [-0.119514882564545, -0.0277868565171957, -0.20146806538105], "B": [0.325075000524521, 0.475625157356262, 0.233177110552788], "S": [-0.06394115798141467, 0.035139632984676095, -0.14713742895067866], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 1, "is_min": true, "A": [0.140480697154999, 0.0380993708968163, -0.19288744032383], "B": [0.186046749353409, 0.698170900344849, 0.256812572479248], "S": [0.14617645016171313, 0.12060826111467937, -0.13667497344411436], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 2, "is_min": false, "A": [0.386867105960846, 0.176602959632874, -0.192678645253181], "B": [0.126914545893669, 0.78149950504303, 0.261771321296692], "S": [0.35437303433362977, 0.2522150315760543, -0.13587239660442169], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 3, "is_min": false, "A": [0.555060386657715, 0.301137804985046, -0.096286229789257], "B": [-0.0033258069306612, 0.769336938858032, 0.233857363462448], "S": [0.4852621322161433, 0.3596626801532175, -0.05501829231402615], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 4, "is_min": false, "A": [0.671073138713837, 0.524341106414795, -0.0177986174821854], "B": [-0.0561837442219257, 0.755394816398621, 0.222434461116791], "S": [0.5801660512673723, 0.5532228128807963, 0.01223050977140918], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 5, "is_min": false, "A": [0.674805700778961, 0.775291264057159, 0.000930982641875744], "B": [-0.0961402282118797, 0.71613222360611, 0.206217080354691], "S": [0.5784374445530541, 0.7678963828419121, 0.026591748877324864], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 6, "is_min": false, "A": [0.617580473423004, 0.926754474639893, -0.0190836191177368], "B": [-0.0915633738040924, 0.612631440162659, 0.176981985569], "S": [0.5289374923942985, 0.8874890952747276, 0.0054245815027536], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}], "3": [{"index": -6, "is_min": false, "A": [-0.786814987659454, 0.485439121723175, -0.0469277873635292], "B": [-0.0630200058221817, 0.153058245778084, 0.0281979572027922], "S": [-0.6963406219926964, 0.44389151547346173, -0.03753707002582746], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": -5, "is_min": false, "A": [-0.686472713947296, 0.266618430614471, -0.0971645265817642], "B": [0.0894269794225693, 0.255628764629364, 0.0974097698926926], "S": [-0.5894852722629331, 0.26524472264942206, -0.07284274453461427], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": -4, "is_min": false, "A": [-0.528013467788696, 0.107685409486294, -0.14958131313324], "B": [0.168092846870422, 0.366943538188934, 0.147439450025558], "S": [-0.44100018609404135, 0.1400926727295227, -0.11245372099732623], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": -3, "is_min": false, "A": [-0.307161718606949, 0.00531338714063168, -0.206674426794052], "B": [0.226669505238533, 0.455941081047058, 0.183145046234131], "S": [-0.24043283208013289, 0.061641834989584234, -0.15794700468063488], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": -2, "is_min": false, "A": [-0.0749958902597427, -0.0555012337863445, -0.208927571773529], "B": [0.198988869786263, 0.570625007152557, 0.206883490085602], "S": [-0.040747810170476864, 0.022764512242981316, -0.15695121167903697], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": -1, "is_min": true, "A": [0.194734260439873, -0.027831107378006, -0.208106309175491], "B": [0.18539671599865, 0.647857308387756, 0.220097482204437], "S": [0.19356706785149527, 0.05662991081567886, -0.15458085665850924], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 0, "is_min": false, "A": [0.194734260439873, -0.027831107378006, -0.208106309175491], "B": [0.18539671599865, 0.647857308387756, 0.220097482204437], "S": [0.19356706785149527, 0.05662991081567886, -0.15458085665850924], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 1, "is_min": false, "A": [0.442768961191177, 0.0780056715011597, -0.17971482872963], "B": [0.151667580008507, 0.704751551151276, 0.22333613038063], "S": [0.4063813023997769, 0.15634887662430333, -0.12933347802608408], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 2, "is_min": false, "A": [0.631931006908417, 0.181110441684723, -0.0751613602042198], "B": [0.0782132223248482, 0.691914856433868, 0.194052055478096], "S": [0.5627163053717674, 0.24496097366114195, -0.04150969371471548], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 3, "is_min": false, "A": [0.752316653728485, 0.401523470878601, -0.0511210598051548], "B": [0.0389339774847031, 0.685410976409912, 0.173585548996925], "S": [0.663143820493865, 0.43700940855433595, -0.023032734113072217], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 4, "is_min": false, "A": [0.794066309928894, 0.577793121337891, -0.0229719802737236], "B": [0.0111760534346104, 0.608906984329224, 0.13862980902195], "S": [0.6962050557336695, 0.5816823531043263, -0.0027717623638938635], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}], "4": [{"index": -2, "is_min": false, "A": [-0.680951595306396, 0.41613444685936, -0.0518640093505383], "B": [0.069280743598938, 0.182785585522652, 0.0988010615110397], "S": [-0.5871725688420134, 0.3869658441373572, -0.033030878685707206], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": -1, "is_min": false, "A": [-0.56431782245636, 0.265530943870544, -0.13995298743248], "B": [0.184914857149124, 0.226864278316498, 0.13781563937664], "S": [-0.4706637469627825, 0.260697611164354, -0.1052319125874443], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 0, "is_min": false, "A": [-0.56431782245636, 0.265530943870544, -0.13995298743248], "B": [0.184914857149124, 0.226864278316498, 0.13781563937664], "S": [-0.4706637469627825, 0.260697611164354, -0.1052319125874443], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 1, "is_min": false, "A": [-0.405415058135986, 0.148890599608421, -0.240423202514648], "B": [0.28382807970047, 0.23242275416851, 0.157026797533035], "S": [-0.3192596811477175, 0.15933211708127892, -0.1907419612975312], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 2, "is_min": false, "A": [-0.132479831576347, 0.0101452246308327, -0.224839925765991], "B": [0.344344705343246, 0.45254772901535, 0.240905076265335], "S": [-0.07287676547704514, 0.06544553673656982, -0.16662180150412287], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 3, "is_min": true, "A": [0.127680778503418, 0.00168012827634811, -0.225948870182037], "B": [0.310780107975006, 0.601399540901184, 0.270852208137512], "S": [0.15056819379777042, 0.07664505194068964, -0.1638487378058231], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 4, "is_min": false, "A": [0.400359511375427, 0.06760323792696, -0.204324305057526], "B": [0.294986605644226, 0.691102266311646, 0.285722613334656], "S": [0.387187902994288, 0.14554058786445945, -0.14306846274535412], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 5, "is_min": false, "A": [0.602961182594299, 0.174356371164322, -0.123544812202454], "B": [0.190427541732788, 0.739304184913635, 0.264592111110687], "S": [0.5513944899086048, 0.24497483087157645, -0.07502770847568506], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 6, "is_min": false, "A": [0.781316995620728, 0.38472443819046, -0.0547768473625183], "B": [0.148027151823044, 0.760854661464691, 0.257425129413605], "S": [0.7021557679550373, 0.431740714431376, -0.015751601650305674], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 7, "is_min": false, "A": [0.870106279850006, 0.608526349067688, 0.0309229586273432], "B": [0.114667981863022, 0.759601593017578, 0.246536448597908], "S": [0.7756764873236919, 0.6274107556169257, 0.057874646380067854], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 8, "is_min": false, "A": [0.86496776342392, 0.791920065879822, 0.0970460623502731], "B": [0.0803410410881042, 0.686517596244812, 0.212159648537636], "S": [0.7668894163686377, 0.7787447562669002, 0.11143526161594661], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}], "5": [{"index": -2, "is_min": false, "A": [-0.67185515165329, 0.292237251996994, -0.0294662527740002], "B": [0.0879570245742798, 0.0723296403884888, 0.0902266502380371], "S": [-0.5768786512778867, 0.2647488068128335, -0.014504643308490583], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": -1, "is_min": false, "A": [-0.554219305515289, 0.110312588512897, -0.0957923531532288], "B": [0.213854640722275, 0.114197559654713, 0.127920120954514], "S": [-0.4582100585573235, 0.11079820992422895, -0.06782829281841243], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 0, "is_min": false, "A": [-0.554219305515289, 0.110312588512897, -0.0957923531532288], "B": [0.213854640722275, 0.114197559654713, 0.127920120954514], "S": [-0.4582100585573235, 0.11079820992422895, -0.06782829281841243], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 1, "is_min": false, "A": [-0.337744414806366, -0.0611391253769398, -0.134841978549957], "B": [0.325294017791748, 0.2410758882761, 0.195380061864853], "S": [-0.2548646413942109, -0.023362262646423992, -0.09356423876942163], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 2, "is_min": false, "A": [-0.0779010206460953, -0.150999456644058, -0.181442871689796], "B": [0.403028607368469, 0.332000613212585, 0.237386390566826], "S": [-0.017784832431921666, -0.0906244632654391, -0.12908922722133734], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 3, "is_min": true, "A": [0.219793662428856, -0.0953719615936279, -0.236013799905777], "B": [0.382686585187912, 0.496950328350067, 0.276451587677002], "S": [0.24015526866002035, -0.021331708490584134, -0.17195565512992333], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 4, "is_min": false, "A": [0.495773643255234, 0.0294927917420864, -0.258211016654968], "B": [0.372236996889114, 0.595518290996552, 0.29347175359726], "S": [0.4803315630360718, 0.10024597650699132, -0.1892506729483986], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 5, "is_min": false, "A": [0.714678168296814, 0.239018857479095, -0.256490677595139], "B": [0.335737258195877, 0.676502764225006, 0.29578822851181], "S": [0.6673105683056022, 0.29370432992336903, -0.18745583440259528], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 6, "is_min": false, "A": [0.829777598381042, 0.396706581115723, -0.151755094528198], "B": [0.212061315774918, 0.698324918746948, 0.25745490193367], "S": [0.7525630539220305, 0.434408877779205, -0.1006038389200888], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 7, "is_min": false, "A": [0.896481275558472, 0.645330965518951, -0.0840114429593086], "B": [0.16913677752018, 0.707075655460358, 0.243338122963905], "S": [0.8055632249435145, 0.6530490507735152, -0.04309275245754274], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}, {"index": 8, "is_min": false, "A": [0.851529359817505, 0.812198340892792, -0.0532342307269573], "B": [0.115002989768982, 0.636795818805695, 0.205151408910751], "S": [0.7594635835067942, 0.7902730303818577, -0.020936032769404242], "P": [0.154346406459808, 0.100275993347168, 0.00941389799118042]}]};

    const STATIC_COUNT  = 8;
    const DYNAMIC_COUNT = 5;

    let currentTrial = "1";
    let currentCamera = null;

    // restyle対象トレース（動的5本）
    function dynamicTraceIndices() {
      const arr = [];
      for (let i = 0; i < DYNAMIC_COUNT; i++) arr.push(STATIC_COUNT + i);
      return arr;
    }
    const DYN_IDX = dynamicTraceIndices();

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        // 初期 camera 保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ユーザー操作で camera 変化を保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey && gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
          }
        });

        // 端末回転/リサイズ：Plotlyが勝手に変えることがあるので再適用
        let resizeTimer = null;
        function handleResize() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function() {
            Plotly.Plots.resize(gd).then(function() {
              if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
            });
          }, 150);
        }
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, currentTrial);
          });
        });

        // Slider
        slider.addEventListener("input", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init
        updateSliderForTrial(gd, currentTrial);

        function updateSliderForTrial(gd, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, trialKey, initPos);
        }

        // ★ここが本丸：restyle で x/y/z だけ更新（レイアウト触らない→カメラ戻らない）
        function updateFrame(gd, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          // Bat line (trace 0)
          const x0 = [f.A[0], f.B[0]];
          const y0 = [f.A[1], f.B[1]];
          const z0 = [f.A[2], f.B[2]];

          // Bottom marker (trace 1)
          const x1 = [f.B[0]];
          const y1 = [f.B[1]];
          const z1 = [f.B[2]];

          // Sweet (trace 2)
          const x2 = [f.S[0]];
          const y2 = [f.S[1]];
          const z2 = [f.S[2]];

          // Ball (trace 3)
          const x3 = [f.P[0]];
          const y3 = [f.P[1]];
          const z3 = [f.P[2]];

          // S->P (trace 4)
          const x4 = [f.S[0], f.P[0]];
          const y4 = [f.S[1], f.P[1]];
          const z4 = [f.S[2], f.P[2]];

          // restyle は「配列の配列」にするのがコツ
          Plotly.restyle(gd, {
            x: [x0, x1, x2, x3, x4],
            y: [y0, y1, y2, y3, y4],
            z: [z0, z1, z2, z3, z4],
          }, DYN_IDX).then(function() {
            // 念押し：カメラ保持（restyleだけなら基本不要だが、iOS保険）
            if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

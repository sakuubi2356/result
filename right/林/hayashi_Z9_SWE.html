<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>hayashi_Z9_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
          <button class="trial-btn" id="trialBtn_5" data-trial="5">5球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.5365077, -0.5365077, -0.5365077, -0.5365077, -0.5365077, -0.5365077], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.1185982, 0.1185982, 0.1185982, 0.1185982, 0.1185982, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [0.009413898, 0.009413898, 0.009413898, -0.2089548, -0.2089548, -0.2089548, -0.4273234, -0.4273234, -0.4273234], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [0.148086071014404, 0.297130167484283], "y": [-0.100592255592346, 0.460472881793976], "z": [-0.430046707391739, 0.120400622487068], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [0.297130167484283], "y": [0.460472881793976], "z": [0.120400622487068], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.16671657588215016], "y": [-0.030459140488984432], "z": [-0.3612408177145353], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [-0.100275993347168], "z": [-0.427323400974274], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.16671657588215016, 0.154346406459808], "y": [-0.030459140488984432, -0.100275993347168], "z": [-0.3612408177145353, -0.427323400974274], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z9 (Z9)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -6, "is_min": false, "A": [-0.74730771780014, 0.403265476226807, -0.0107893738895655], "B": [-0.0181334167718887, 0.0815195292234421, -0.0799588412046432], "S": [-0.6561609323720758, 0.36304723382233584, -0.01943555709521391], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -5, "is_min": false, "A": [-0.685052514076233, 0.248961582779884, -0.116951063275337], "B": [0.102466329932213, 0.132187470793724, -0.0383519940078259], "S": [-0.586612653698426, 0.23436481805848428, -0.10712617913016931], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -4, "is_min": false, "A": [-0.527363002300262, 0.0859530046582222, -0.256903409957886], "B": [0.222901701927185, 0.187832891941071, 0.00140557624399662], "S": [-0.4335799267416756, 0.09868798887527414, -0.2246147909758993], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -3, "is_min": false, "A": [-0.346298307180405, -0.0393858030438423, -0.332823097705841], "B": [0.266265451908112, 0.297312945127487, 0.0562786422669888], "S": [-0.2697278713932223, 0.002701521734952056, -0.28418540186891617], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -2, "is_min": false, "A": [-0.113755702972412, -0.102990731596947, -0.396564185619354], "B": [0.296804904937744, 0.379599809646606, 0.0918483659625053], "S": [-0.0624356455794621, -0.04266693579982653, -0.3355126387936458], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -1, "is_min": true, "A": [0.148086071014404, -0.100592255592346, -0.430046707391739], "B": [0.297130167484283, 0.460472881793976, 0.120400622487068], "S": [0.16671657588215016, -0.030459140488984432, -0.3612408177145353], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 0, "is_min": false, "A": [0.148086071014404, -0.100592255592346, -0.430046707391739], "B": [0.297130167484283, 0.460472881793976, 0.120400622487068], "S": [0.16671657588215016, -0.030459140488984432, -0.3612408177145353], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 1, "is_min": false, "A": [0.378174871206284, -0.101607233285904, -0.377031177282333], "B": [0.222619265317917, 0.506836116313934, 0.118548393249512], "S": [0.3587304199677828, -0.025551812620610292, -0.3150837293650962], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 2, "is_min": false, "A": [0.606829881668091, 0.0191013347357512, -0.328360617160797], "B": [0.188831582665443, 0.535035312175751, 0.117833837866783], "S": [0.5545800917922615, 0.08359308500210852, -0.2725863076131794], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 3, "is_min": false, "A": [0.769626975059509, 0.20708242058754, -0.272473990917206], "B": [0.145475521683693, 0.538568913936615, 0.10242848098278], "S": [0.6916080553013084, 0.24851822592877426, -0.2256111890858302], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 4, "is_min": false, "A": [0.844197511672974, 0.354492366313934, -0.214542880654335], "B": [0.101588547229767, 0.472067177295685, 0.0587851516902447], "S": [0.7513714000748694, 0.3691892162684739, -0.18037687990812573], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}], "2": [{"index": -6, "is_min": false, "A": [-0.735043704509735, 0.532599627971649, 0.0223338417708874], "B": [-0.0680122002959251, 0.101067095994949, -0.0717339739203453], "S": [-0.6516647734996633, 0.47865806601394933, 0.010575365799003842], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -5, "is_min": false, "A": [-0.694216907024384, 0.369016796350479, -0.0902971103787422], "B": [0.0631804168224335, 0.114949867129326, -0.0478780046105385], "S": [-0.5995422482911987, 0.3372584324613219, -0.08499472253562934], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -4, "is_min": false, "A": [-0.588438749313354, 0.16511669754982, -0.179858580231667], "B": [0.189105823636055, 0.197853535413742, 0.00548654142767191], "S": [-0.4912456835869559, 0.1692088020347286, -0.15669044142880575], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -3, "is_min": false, "A": [-0.406187117099762, 0.0113393487408757, -0.281639933586121], "B": [0.276666045188904, 0.270281374454498, 0.0449496060609818], "S": [-0.32083048123859875, 0.04370709838109216, -0.24081624563790835], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -2, "is_min": false, "A": [-0.14629553258419, -0.0862284600734711, -0.372159153223038], "B": [0.340854823589325, 0.354737222194672, 0.0841673761606216], "S": [-0.0854017430042944, -0.031107754263236323, -0.3151183416791885], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -1, "is_min": true, "A": [0.171624079346657, -0.11029127240181, -0.444959998130798], "B": [0.432206451892853, 0.400616735219955, 0.112776301801205], "S": [0.2041968773044747, -0.04642776872469655, -0.37524295766519516], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 0, "is_min": false, "A": [0.171624079346657, -0.11029127240181, -0.444959998130798], "B": [0.432206451892853, 0.400616735219955, 0.112776301801205], "S": [0.2041968773044747, -0.04642776872469655, -0.37524295766519516], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 1, "is_min": false, "A": [0.407767653465271, -0.0774232596158981, -0.368803471326828], "B": [0.269333302974701, 0.536839365959167, 0.124671533703804], "S": [0.39046336267089987, -0.0006404448058636575, -0.3071191064524792], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 2, "is_min": false, "A": [0.639890432357788, -0.00157275795936584, -0.263825178146362], "B": [0.194570094347, 0.548656821250916, 0.108918555080891], "S": [0.584225419849994, 0.06720590269133313, -0.21723223638901923], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 3, "is_min": false, "A": [0.839634299278259, 0.285702168941498, -0.245836496353149], "B": [0.199439764022827, 0.596087157726288, 0.119966715574265], "S": [0.7596099744995785, 0.3245002963560516, -0.20011109036435193], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 4, "is_min": false, "A": [0.865059733390808, 0.509625136852264, -0.250018566846848], "B": [0.135431587696075, 0.539167940616608, 0.0767383351922035], "S": [0.7738562209699867, 0.5133179870883273, -0.20917395668541894], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}], "3": [{"index": -6, "is_min": false, "A": [-0.80090993642807, 0.431316137313843, -0.0247130896896124], "B": [-0.0762428119778633, 0.0934534668922424, -0.0512887462973595], "S": [-0.7103265381472577, 0.38908329990972035, -0.028035047048862064], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -5, "is_min": false, "A": [-0.722918629646301, 0.251821100711823, -0.136821880936623], "B": [0.0585883297026157, 0.152278304100037, 0.00224030436947942], "S": [-0.6252302740184381, 0.23937825295560405, -0.11943911031627186], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -4, "is_min": false, "A": [-0.570943832397461, 0.0917136818170547, -0.253546416759491], "B": [0.162991985678673, 0.205487623810768, 0.043764241039753], "S": [-0.4792018495598088, 0.10593542543098544, -0.21638258227493407], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -3, "is_min": false, "A": [-0.350568532943726, -0.0259804464876652, -0.348837852478027], "B": [0.242947772145271, 0.283195495605469, 0.0895100757479668], "S": [-0.2763790106746341, 0.01266653800848368, -0.2940443731685476], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -2, "is_min": false, "A": [-0.0571244284510612, -0.0889912322163582, -0.441248774528503], "B": [0.345416843891144, 0.318035185337067, 0.117580592632294], "S": [-0.006806778926441728, -0.038112939646388254, -0.37139511684701787], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -1, "is_min": true, "A": [0.175493180751801, -0.0855130702257156, -0.387903690338135], "B": [0.233607143163681, 0.495661228895187, 0.15877677500248], "S": [0.1827574241817736, -0.012866301551843512, -0.3195686497759533], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 0, "is_min": false, "A": [0.175493180751801, -0.0855130702257156, -0.387903690338135], "B": [0.233607143163681, 0.495661228895187, 0.15877677500248], "S": [0.1827574241817736, -0.012866301551843512, -0.3195686497759533], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 1, "is_min": false, "A": [0.407529354095459, -0.0734347328543663, -0.297330945730209], "B": [0.155451461672783, 0.542198240756989, 0.147026062011719], "S": [0.3760196267093734, 0.0035193664597154284, -0.24178633592139845], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 2, "is_min": false, "A": [0.6803178191185, 0.135546490550041, -0.21554696559906], "B": [0.121518284082413, 0.584119081497192, 0.140157550573349], "S": [0.6104678768314057, 0.19161806474561976, -0.17108390081806116], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 3, "is_min": false, "A": [0.751441240310669, 0.328342735767365, -0.241825491189957], "B": [0.0537754595279694, 0.545497417449951, 0.0839143469929695], "S": [0.664233027226105, 0.35548706801659724, -0.2011080158588343], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 4, "is_min": false, "A": [0.728614151477814, 0.53424745798111, -0.311296254396439], "B": [0.0135451629757881, 0.507091104984283, 0.0463892444968224], "S": [0.6392305308440447, 0.5308529139677414, -0.2665855684998918], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}], "4": [{"index": -6, "is_min": false, "A": [-0.742277383804321, 0.367027133703232, -0.0763448923826218], "B": [0.0130997747182846, 0.10499157756567, -0.10359750688076], "S": [-0.6478552381993157, 0.3342726889121019, -0.07975146922337926], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -5, "is_min": false, "A": [-0.668862819671631, 0.210286006331444, -0.173723995685577], "B": [0.121211461722851, 0.168299660086632, -0.0553175583481789], "S": [-0.570103558245443, 0.2050377143128718, -0.15892319457747334], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -4, "is_min": false, "A": [-0.534720301628113, 0.0697985216975212, -0.269514113664627], "B": [0.207965135574341, 0.226967602968216, -0.0170924812555313], "S": [-0.44188465528608045, 0.08944464980757186, -0.2379614209342034], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -3, "is_min": false, "A": [-0.362246572971344, -0.0499527268111706, -0.34258559346199], "B": [0.233417004346848, 0.329582422971725, 0.0330975875258446], "S": [-0.2877886188110918, -0.0025108286310445774, -0.2956251914264842], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -2, "is_min": false, "A": [-0.133518502116203, -0.115126863121986, -0.401613533496857], "B": [0.255158424377441, 0.404192358255386, 0.0666153505444527], "S": [-0.08493390508286253, -0.05021198553997355, -0.34308494561349645], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -1, "is_min": true, "A": [0.119392223656178, -0.140484094619751, -0.407559901475906], "B": [0.25146347284317, 0.471510648727417, 0.0904557928442955], "S": [0.13590112964287293, -0.06398475245054717, -0.345307940295542], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 0, "is_min": false, "A": [0.119392223656178, -0.140484094619751, -0.407559901475906], "B": [0.25146347284317, 0.471510648727417, 0.0904557928442955], "S": [0.13590112964287293, -0.06398475245054717, -0.345307940295542], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 1, "is_min": false, "A": [0.35570964217186, -0.144782513380051, -0.34880194067955], "B": [0.189392164349556, 0.504487693309784, 0.087989367544651], "S": [0.3349199566590087, -0.06362373447909123, -0.29420302508975216], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 2, "is_min": false, "A": [0.578438997268677, -0.0272987894713879, -0.309186279773712], "B": [0.159447029232979, 0.528133511543274, 0.0857066661119461], "S": [0.5260649909939625, 0.042130261770096766, -0.2598246518584632], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 3, "is_min": false, "A": [0.750402629375458, 0.169806376099586, -0.269791930913925], "B": [0.128949269652367, 0.537101209163666, 0.0750129520893097], "S": [0.672720970337062, 0.21571822377446515, -0.2266913266012116], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 4, "is_min": false, "A": [0.852228760719299, 0.329306364059448, -0.175840884447098], "B": [0.0946961715817451, 0.487058758735657, 0.027282003313303], "S": [0.7575372129074499, 0.3490254080149332, -0.15045053040313183], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}], "5": [{"index": -6, "is_min": false, "A": [-0.739593148231506, 0.630625188350677, 0.0468826964497566], "B": [-0.174567684531212, 0.0879000201821327, -0.114967487752438], "S": [-0.6689649578154651, 0.562784535170278, 0.026651421289443946], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -5, "is_min": false, "A": [-0.735684514045715, 0.423169702291489, -0.0522604361176491], "B": [0.0130898654460907, 0.141581252217293, -0.0589511767029762], "S": [-0.6420877087564748, 0.38797114307905817, -0.053096778760984065], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -4, "is_min": false, "A": [-0.64802074432373, 0.243870958685875, -0.167136624455452], "B": [0.136724188923836, 0.18248887360096, -0.0242801494896412], "S": [-0.5499276539587794, 0.23619820010672002, -0.1492795698707889], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -3, "is_min": false, "A": [-0.476278603076935, 0.0770453810691833, -0.281470626592636], "B": [0.242664560675621, 0.253829538822174, 0.0216268356889486], "S": [-0.3864107063988969, 0.09914340108558584, -0.24358344329775186], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -2, "is_min": false, "A": [-0.242682859301567, -0.0338963828980923, -0.3623426258564], "B": [0.266221940517426, 0.394333124160767, 0.0822198688983917], "S": [-0.17906978008477942, 0.019632288014797834, -0.30677233214781663], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": -1, "is_min": true, "A": [0.0514995157718658, -0.0791715458035469, -0.39664289355278], "B": [0.26608669757843, 0.495228707790375, 0.117182582616806], "S": [0.07832291496699366, -0.007371510171310783, -0.3324147055133495], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 0, "is_min": false, "A": [0.0514995157718658, -0.0791715458035469, -0.39664289355278], "B": [0.26608669757843, 0.495228707790375, 0.117182582616806], "S": [0.07832291496699366, -0.007371510171310783, -0.3324147055133495], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 1, "is_min": false, "A": [0.315797984600067, -0.070954293012619, -0.351437419652939], "B": [0.184143275022507, 0.560019850730896, 0.122417591512203], "S": [0.29934114467160633, 0.007917480856338477, -0.2922055388256931], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 2, "is_min": false, "A": [0.585966289043427, 0.0476518012583256, -0.260683864355087], "B": [0.145759209990501, 0.594070136547089, 0.12356174737215], "S": [0.530940402430202, 0.11595409531882536, -0.21265316137770457], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 3, "is_min": false, "A": [0.777314245700836, 0.263331681489944, -0.159449070692062], "B": [0.105266198515892, 0.601699531078339, 0.112320549786091], "S": [0.6933082467578244, 0.3056276591866836, -0.1254778709448695], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}, {"index": 4, "is_min": false, "A": [0.843373358249664, 0.484722107648849, -0.124665625393391], "B": [0.071713462471962, 0.547882795333862, 0.0767097249627113], "S": [0.7469158938056577, 0.4926171917655324, -0.09949371247792607], "P": [0.154346406459808, -0.100275993347168, -0.427323400974274]}]};

    const STATIC_COUNT  = 8;
    const DYNAMIC_COUNT = 5;

    let currentTrial = "1";
    let currentCamera = null;

    // restyle対象トレース（動的5本）
    function dynamicTraceIndices() {
      const arr = [];
      for (let i = 0; i < DYNAMIC_COUNT; i++) arr.push(STATIC_COUNT + i);
      return arr;
    }
    const DYN_IDX = dynamicTraceIndices();

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        // 初期 camera 保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ユーザー操作で camera 変化を保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey && gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
          }
        });

        // 端末回転/リサイズ：Plotlyが勝手に変えることがあるので再適用
        let resizeTimer = null;
        function handleResize() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function() {
            Plotly.Plots.resize(gd).then(function() {
              if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
            });
          }, 150);
        }
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, currentTrial);
          });
        });

        // Slider
        slider.addEventListener("input", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init
        updateSliderForTrial(gd, currentTrial);

        function updateSliderForTrial(gd, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, trialKey, initPos);
        }

        // ★ここが本丸：restyle で x/y/z だけ更新（レイアウト触らない→カメラ戻らない）
        function updateFrame(gd, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          // Bat line (trace 0)
          const x0 = [f.A[0], f.B[0]];
          const y0 = [f.A[1], f.B[1]];
          const z0 = [f.A[2], f.B[2]];

          // Bottom marker (trace 1)
          const x1 = [f.B[0]];
          const y1 = [f.B[1]];
          const z1 = [f.B[2]];

          // Sweet (trace 2)
          const x2 = [f.S[0]];
          const y2 = [f.S[1]];
          const z2 = [f.S[2]];

          // Ball (trace 3)
          const x3 = [f.P[0]];
          const y3 = [f.P[1]];
          const z3 = [f.P[2]];

          // S->P (trace 4)
          const x4 = [f.S[0], f.P[0]];
          const y4 = [f.S[1], f.P[1]];
          const z4 = [f.S[2], f.P[2]];

          // restyle は「配列の配列」にするのがコツ
          Plotly.restyle(gd, {
            x: [x0, x1, x2, x3, x4],
            y: [y0, y1, y2, y3, y4],
            z: [z0, z1, z2, z3, z4],
          }, DYN_IDX).then(function() {
            // 念押し：カメラ保持（restyleだけなら基本不要だが、iOS保険）
            if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

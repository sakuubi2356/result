<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>hayashi_Z7_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.5365077, -0.5365077, -0.5365077, -0.5365077, -0.5365077, -0.5365077], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.1185982, 0.1185982, 0.1185982, 0.1185982, 0.1185982, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.5365077, 0.1185982], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [0.009413898, 0.009413898, 0.009413898, -0.2089548, -0.2089548, -0.2089548, -0.4273234, -0.4273234, -0.4273234], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [0.0794855505228043, 0.272473871707916], "y": [0.00175582431256771, 0.601036012172699], "z": [-0.351582497358322, 0.141995474696159], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [0.272473871707916], "y": [0.601036012172699], "z": [0.141995474696159], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.10360908218675641], "y": [0.07666582144942206], "z": [-0.2898852725502743], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [0.100275993347168], "z": [-0.427323400974274], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.10360908218675641, 0.154346406459808], "y": [0.07666582144942206, 0.100275993347168], "z": [-0.2898852725502743, -0.427323400974274], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z7 (Z7)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -6, "is_min": false, "A": [-0.799096465110779, 0.540305018424988, 0.099972128868103], "B": [-0.100842453539371, 0.189544498920441, -0.0715176165103912], "S": [-0.7118147368136902, 0.4964599651157444, 0.07853591638122072], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": -5, "is_min": false, "A": [-0.751856923103333, 0.404405534267426, -0.0200553555041552], "B": [0.0232843235135078, 0.209784984588623, -0.0558141246438026], "S": [-0.6549642521469184, 0.380077961758946, -0.024525202344555512], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": -4, "is_min": false, "A": [-0.637562215328217, 0.221512988209724, -0.115446910262108], "B": [0.151152968406677, 0.293209224939346, -0.00236253114417195], "S": [-0.5389728226155264, 0.2304750173233091, -0.10131136362569837], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": -3, "is_min": false, "A": [-0.45596119761467, 0.0854972973465919, -0.219731450080872], "B": [0.245169952511787, 0.370054543018341, 0.0399648658931255], "S": [-0.368319796472771, 0.12106695604918075, -0.18726940785204588], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": -2, "is_min": false, "A": [-0.198791295289993, 0.00174799747765064, -0.314510613679886], "B": [0.31209921836853, 0.467437267303467, 0.0881360322237015], "S": [-0.13492997781151028, 0.059959159187627176, -0.264179780363842], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": -1, "is_min": true, "A": [0.0794855505228043, 0.00175582431256771, -0.351582497358322], "B": [0.272473871707916, 0.601036012172699, 0.141995474696159], "S": [0.10360908218675641, 0.07666582144942206, -0.2898852725502743], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": 0, "is_min": false, "A": [0.0794855505228043, 0.00175582431256771, -0.351582497358322], "B": [0.272473871707916, 0.601036012172699, 0.141995474696159], "S": [0.10360908218675641, 0.07666582144942206, -0.2898852725502743], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": 1, "is_min": false, "A": [0.371582865715027, 0.101224273443222, -0.363320708274841], "B": [0.249265536665916, 0.684366285800934, 0.170518070459366], "S": [0.3562931993120515, 0.17411702628390424, -0.2965908597466678], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": 2, "is_min": false, "A": [0.601862013339996, 0.210365623235703, -0.258902043104172], "B": [0.148148328065872, 0.709392130374908, 0.171350508928299], "S": [0.5451478390824916, 0.2727438965908636, -0.20512050861957137], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": 3, "is_min": false, "A": [0.778803467750549, 0.416985124349594, -0.142693117260933], "B": [0.109752878546715, 0.722100496292114, 0.172388032078743], "S": [0.6951721579370538, 0.4551245395321589, -0.10330798010983101], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": 4, "is_min": false, "A": [0.843434929847717, 0.683350622653961, -0.0563597269356251], "B": [0.0732216089963913, 0.716733515262604, 0.157315641641617], "S": [0.7471582752920461, 0.6875234837727467, -0.029650308790495704], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}], "2": [{"index": -6, "is_min": false, "A": [-0.795732915401459, 0.563683211803436, -0.00746387150138617], "B": [-0.0948498994112015, 0.186948418617249, -0.0901315063238144], "S": [-0.7081225414380868, 0.5165913642867396, -0.01779732549616965], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": -5, "is_min": false, "A": [-0.739739000797272, 0.421344608068466, -0.120224311947823], "B": [0.0271817930042744, 0.199187308549881, -0.0704387575387955], "S": [-0.6438738994093018, 0.3935749450021419, -0.1140011175062954], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": -4, "is_min": false, "A": [-0.606430351734161, 0.233957588672638, -0.216647386550903], "B": [0.164099305868149, 0.276989281177521, -0.00585668999701738], "S": [-0.5101141744489379, 0.2393365485650847, -0.19029855766541137], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": -3, "is_min": false, "A": [-0.410832107067108, 0.0982097983360291, -0.307087689638138], "B": [0.264337480068207, 0.347131043672562, 0.0424609929323196], "S": [-0.3264359112637241, 0.12932495304875735, -0.26339410565696436], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": -2, "is_min": false, "A": [-0.169193923473358, 0.012819541618228, -0.400909304618835], "B": [0.368190258741379, 0.375743627548218, 0.0676035135984421], "S": [-0.10202089609288657, 0.05818505546855217, -0.342345198328049], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": -1, "is_min": true, "A": [0.138952270150185, 0.0439733825623989, -0.395940154790878], "B": [0.30678603053093, 0.599571585655212, 0.154644191265106], "S": [0.15993147943732483, 0.1134231223275111, -0.32711714683391224], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": 0, "is_min": false, "A": [0.138952270150185, 0.0439733825623989, -0.395940154790878], "B": [0.30678603053093, 0.599571585655212, 0.154644191265106], "S": [0.15993147943732483, 0.1134231223275111, -0.32711714683391224], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": 1, "is_min": false, "A": [0.417967319488525, 0.14829058945179, -0.382856041193008], "B": [0.282699108123779, 0.694738566875458, 0.185560271143913], "S": [0.4010587928719902, 0.21659658742130083, -0.31180400132751845], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": 2, "is_min": false, "A": [0.617379426956177, 0.248363047838211, -0.271071076393127], "B": [0.159106805920601, 0.734411001205444, 0.169091880321503], "S": [0.560095342015269, 0.3091190497637147, -0.21605069978126593], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": 3, "is_min": false, "A": [0.77556449174881, 0.45864674448967, -0.173819333314896], "B": [0.108444958925247, 0.748909056186676, 0.158895641565323], "S": [0.6921745459226826, 0.49492953528929345, -0.13222995934862553], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": 4, "is_min": false, "A": [0.820788741111755, 0.643450319766998, -0.101235434412956], "B": [0.0490970313549042, 0.679892122745514, 0.106523513793945], "S": [0.7243272683844414, 0.6480055455646858, -0.07526556346199048], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}], "3": [{"index": -6, "is_min": false, "A": [-0.883641302585602, 0.395903915166855, -0.0876995101571083], "B": [-0.101963624358177, 0.22690586745739, -0.108185134828091], "S": [-0.7859315923176169, 0.37477915909733006, -0.09026021325381109], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": -5, "is_min": false, "A": [-0.785826027393341, 0.256030291318893, -0.219641134142876], "B": [0.00290906056761742, 0.262980729341507, -0.0860421881079674], "S": [-0.6872341433971042, 0.2568990960541053, -0.20294126622709083], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": -4, "is_min": false, "A": [-0.621559202671051, 0.119462206959724, -0.334159523248672], "B": [0.0804154872894287, 0.3656105697155, -0.0398079454898834], "S": [-0.5338123892649446, 0.15023074429568645, -0.29736558560563875], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": -3, "is_min": false, "A": [-0.388913244009018, 0.0504072457551956, -0.463402450084686], "B": [0.173686295747757, 0.406632244586945, -0.0200228691101074], "S": [-0.318588298504043, 0.09493537253109541, -0.4079800000707098], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": -2, "is_min": false, "A": [-0.11113528907299, 0.0292076729238033, -0.567810952663422], "B": [0.267222225666046, 0.447567999362946, -0.000518692657351494], "S": [-0.06384061007486316, 0.08150270229077103, -0.4968994356723709], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": -1, "is_min": true, "A": [0.133012905716896, 0.0347846448421478, -0.492529541254044], "B": [0.0819889232516289, 0.632384359836578, 0.0368769392371178], "S": [0.12663490834589988, 0.10948460409634853, -0.4263537357284872], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": 0, "is_min": false, "A": [0.133012905716896, 0.0347846448421478, -0.492529541254044], "B": [0.0819889232516289, 0.632384359836578, 0.0368769392371178], "S": [0.12663490834589988, 0.10948460409634853, -0.4263537357284872], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": 1, "is_min": false, "A": [0.386666715145111, 0.175170257687569, -0.470868438482285], "B": [0.0440480783581734, 0.683274447917938, 0.0433714538812637], "S": [0.34383938773165584, 0.23868327822613572, -0.4065884552161988], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": 2, "is_min": false, "A": [0.553031027317047, 0.294416189193726, -0.380238384008408], "B": [-0.0466839000582695, 0.648935437202454, 0.0130278393626213], "S": [0.47806667391476215, 0.33873108779388444, -0.3310801142968425], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": 3, "is_min": false, "A": [0.607848882675171, 0.54429829120636, -0.377654761075974], "B": [-0.0975311845541, 0.623025059700012, -0.00854629836976528], "S": [0.5196763743103056, 0.5541391372637368, -0.3315162032579976], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": 4, "is_min": false, "A": [0.5436190366745, 0.747427403926849, -0.421158939599991], "B": [-0.133165568113327, 0.574983179569244, -0.0309980697929859], "S": [0.45902095553224764, 0.7258718744695989, -0.3723888276781744], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}], "4": [{"index": -6, "is_min": false, "A": [-0.777503132820129, 0.509672045707703, 0.113684222102165], "B": [-0.121810883283615, 0.0867859423160553, -0.0630505681037903], "S": [-0.6955416124247762, 0.45681128974704305, 0.091592376236558], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": -5, "is_min": false, "A": [-0.747550249099731, 0.372679650783539, -0.00155017501674592], "B": [0.00373950600624084, 0.101160369813442, -0.0444591604173183], "S": [-0.6536390441718879, 0.33873974588832756, -0.006913797365929409], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": -4, "is_min": false, "A": [-0.658775806427002, 0.188985466957092, -0.102431952953339], "B": [0.13321241736412, 0.179021626710892, 0.0100642219185829], "S": [-0.5597772795434166, 0.1877399869400339, -0.08836993124921866], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": -3, "is_min": false, "A": [-0.496261835098267, 0.038295391947031, -0.20729748904705], "B": [0.229872465133667, 0.251218616962433, 0.0523037277162075], "S": [-0.40549505561555443, 0.06491079271455838, -0.17484733982827855], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": -2, "is_min": false, "A": [-0.271215289831161, -0.0720950737595558, -0.284263491630554], "B": [0.253462821245193, 0.386737823486328, 0.108401171863079], "S": [-0.20563054059016633, -0.014740974409657166, -0.2351804196529586], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": -1, "is_min": true, "A": [0.0328213721513748, -0.0947636142373085, -0.362340122461319], "B": [0.332237005233765, 0.449526786804199, 0.141741752624512], "S": [0.07024831755011147, -0.026727329988812137, -0.29932990278404925], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": 0, "is_min": false, "A": [0.0328213721513748, -0.0947636142373085, -0.362340122461319], "B": [0.332237005233765, 0.449526786804199, 0.141741752624512], "S": [0.07024831755011147, -0.026727329988812137, -0.29932990278404925], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": 1, "is_min": false, "A": [0.280094385147095, -0.0938260555267334, -0.318238705396652], "B": [0.193331658840179, 0.550842344760895, 0.147460013628006], "S": [0.26924904786572923, -0.013242531548643313, -0.2600263843423769], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": 2, "is_min": false, "A": [0.546160817146301, 0.0295052565634251, -0.268397271633148], "B": [0.162251234054565, 0.59339314699173, 0.149506866931915], "S": [0.498172118884591, 0.09999124341812168, -0.21615925390404495], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": 3, "is_min": false, "A": [0.755563378334045, 0.229982629418373, -0.175458490848541], "B": [0.128107249736786, 0.613669157028198, 0.139317065477371], "S": [0.6771313742474632, 0.2779434380389483, -0.13611155232185299], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}, {"index": 4, "is_min": false, "A": [0.848574280738831, 0.463073909282684, -0.110622547566891], "B": [0.0852822512388229, 0.576665580272675, 0.100286640226841], "S": [0.7531628124961137, 0.4772728628816074, -0.0842589088866069], "P": [0.154346406459808, 0.100275993347168, -0.427323400974274]}]};

    const STATIC_COUNT  = 8;
    const DYNAMIC_COUNT = 5;

    let currentTrial = "1";
    let currentCamera = null;

    // restyle対象トレース（動的5本）
    function dynamicTraceIndices() {
      const arr = [];
      for (let i = 0; i < DYNAMIC_COUNT; i++) arr.push(STATIC_COUNT + i);
      return arr;
    }
    const DYN_IDX = dynamicTraceIndices();

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        // 初期 camera 保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ユーザー操作で camera 変化を保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey && gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
          }
        });

        // 端末回転/リサイズ：Plotlyが勝手に変えることがあるので再適用
        let resizeTimer = null;
        function handleResize() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function() {
            Plotly.Plots.resize(gd).then(function() {
              if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
            });
          }, 150);
        }
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, currentTrial);
          });
        });

        // Slider
        slider.addEventListener("input", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init
        updateSliderForTrial(gd, currentTrial);

        function updateSliderForTrial(gd, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, trialKey, initPos);
        }

        // ★ここが本丸：restyle で x/y/z だけ更新（レイアウト触らない→カメラ戻らない）
        function updateFrame(gd, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          // Bat line (trace 0)
          const x0 = [f.A[0], f.B[0]];
          const y0 = [f.A[1], f.B[1]];
          const z0 = [f.A[2], f.B[2]];

          // Bottom marker (trace 1)
          const x1 = [f.B[0]];
          const y1 = [f.B[1]];
          const z1 = [f.B[2]];

          // Sweet (trace 2)
          const x2 = [f.S[0]];
          const y2 = [f.S[1]];
          const z2 = [f.S[2]];

          // Ball (trace 3)
          const x3 = [f.P[0]];
          const y3 = [f.P[1]];
          const z3 = [f.P[2]];

          // S->P (trace 4)
          const x4 = [f.S[0], f.P[0]];
          const y4 = [f.S[1], f.P[1]];
          const z4 = [f.S[2], f.P[2]];

          // restyle は「配列の配列」にするのがコツ
          Plotly.restyle(gd, {
            x: [x0, x1, x2, x3, x4],
            y: [y0, y1, y2, y3, y4],
            z: [z0, z1, z2, z3, z4],
          }, DYN_IDX).then(function() {
            // 念押し：カメラ保持（restyleだけなら基本不要だが、iOS保険）
            if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>nomura_Z7_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.4301049, -0.4301049, -0.4301049, -0.4301049, -0.4301049, -0.4301049], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.2297358, 0.2297358, 0.2297358, 0.2297358, 0.2297358, 0.2297358], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.4301049, 0.2297358], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.4301049, 0.2297358], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.4301049, 0.2297358], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.4301049, 0.2297358], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.4301049, 0.2297358], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [0.1197624, 0.1197624, 0.1197624, -0.1001846, -0.1001846, -0.1001846, -0.3201314, -0.3201314, -0.3201314], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [0.165977746248245, 0.253166347742081], "y": [0.0264654569327831, 0.664175927639008], "z": [-0.374134719371796, 0.100969262421131], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [0.253166347742081], "y": [0.664175927639008], "z": [0.100969262421131], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.17687631896411252], "y": [0.10617924769880725], "z": [-0.31474673511178364], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [0.100275993347168], "z": [-0.320131421089172], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.17687631896411252, 0.154346406459808], "y": [0.10617924769880725, 0.100275993347168], "z": [-0.31474673511178364, -0.320131421089172], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z7 (Z7)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -6, "is_min": false, "A": [-0.870104551315308, 0.355119913816452, 0.168696105480194], "B": [-0.105098202824593, 0.241384521126747, -0.0358266234397888], "S": [-0.7744787577111054, 0.34090298972386635, 0.14313076435373678], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": -5, "is_min": false, "A": [-0.793494641780853, 0.219466179609299, 0.0408224910497665], "B": [-2.4840235710144e-05, 0.273648113012314, -0.0456060022115707], "S": [-0.6943109082437855, 0.2262389218544392, 0.0300189284832395], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": -4, "is_min": false, "A": [-0.626947641372681, 0.0848322361707687, -0.106118485331535], "B": [0.117759883403778, 0.364365249872208, -0.0208433233201504], "S": [-0.5338591903368992, 0.11977386680172256, -0.09545908888479177], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": -3, "is_min": false, "A": [-0.430351942777634, 0.00877938792109489, -0.246752992272377], "B": [0.203180566430092, 0.433237880468369, -0.0049432935193181], "S": [-0.35116040279315464, 0.061836683633267914, -0.2165267889613816], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": -2, "is_min": false, "A": [-0.17125092446804, -0.0123865697532892, -0.368184626102448], "B": [0.270166367292404, 0.524787664413452, 0.0275364127010107], "S": [-0.11607378558049297, 0.05476018203620663, -0.31871951649674524], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": -1, "is_min": true, "A": [0.165977746248245, 0.0264654569327831, -0.374134719371796], "B": [0.253166347742081, 0.664175927639008, 0.100969262421131], "S": [0.17687631896411252, 0.10617924769880725, -0.31474673511178364], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": 0, "is_min": false, "A": [0.165977746248245, 0.0264654569327831, -0.374134719371796], "B": [0.253166347742081, 0.664175927639008, 0.100969262421131], "S": [0.17687631896411252, 0.10617924769880725, -0.31474673511178364], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": 1, "is_min": false, "A": [0.788547694683075, 0.595336318016052, -0.388826340436935], "B": [0.293953359127045, 0.860522389411926, 0.181307703256607], "S": [0.7267234045259132, 0.6284845759822192, -0.31755958703556614], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": 2, "is_min": false, "A": [0.714779436588287, 0.99387389421463, -0.298812687397003], "B": [0.096562571823597, 0.893264591693878, 0.198867708444595], "S": [0.6375023345322831, 0.9812977323824243, -0.23660264277882156], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": 3, "is_min": false, "A": [0.565222322940826, 1.29207408428192, -0.21771639585495], "B": [0.00183121860027313, 0.887871444225311, 0.18129575252533], "S": [0.49479843518621613, 1.2415487544814392, -0.16783987751135723], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": 4, "is_min": false, "A": [0.350981295108795, 1.47576570510864, -0.126318275928497], "B": [-0.0726833492517471, 0.850251197814941, 0.136816456913948], "S": [0.29802321528131287, 1.397576392756398, -0.0934264347688781], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}], "2": [{"index": -6, "is_min": false, "A": [-1.01126194000244, 0.441518306732178, 0.19688007235527], "B": [-0.292127728462219, 0.183332920074463, -0.0401568785309792], "S": [-0.9213701793033728, 0.40924513905222065, 0.1672504586837592], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": -5, "is_min": false, "A": [-0.935146510601044, 0.275344967842102, 0.0486147850751877], "B": [-0.145801424980164, 0.211150676012039, -0.0645821020007133], "S": [-0.8364783831110962, 0.2673206820312472, 0.03446517536844579], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": -4, "is_min": false, "A": [-0.812614262104034, 0.141571611166, -0.113352984189987], "B": [-0.0203333832323551, 0.247435301542282, -0.080432265996933], "S": [-0.7135791433978419, 0.1548045736451926, -0.10923789404823658], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": -3, "is_min": false, "A": [-0.635660529136658, 0.0431151054799557, -0.282088398933411], "B": [0.0985163226723671, 0.295586615800858, -0.0891037508845329], "S": [-0.5438884647923923, 0.07467402978160444, -0.2579653290020206], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": -2, "is_min": false, "A": [-0.309010803699493, -0.0195240527391434, -0.417622715234756], "B": [0.225394681096077, 0.441810846328735, -0.041349932551384], "S": [-0.24221013470970987, 0.038142795305758675, -0.3705886290941324], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": -1, "is_min": true, "A": [0.0110740885138512, 0.0283199958503246, -0.520678400993347], "B": [0.299361050128937, 0.564806640148163, -0.00195588544011116], "S": [0.04710994914683516, 0.0953808085803391, -0.4558381037667758], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": 0, "is_min": false, "A": [0.0110740885138512, 0.0283199958503246, -0.520678400993347], "B": [0.299361050128937, 0.564806640148163, -0.00195588544011116], "S": [0.04710994914683516, 0.0953808085803391, -0.4558381037667758], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": 1, "is_min": false, "A": [0.286260336637497, 0.127582639455795, -0.630306601524353], "B": [0.390316098928452, 0.615470409393311, -0.00489633157849312], "S": [0.29926730607562596, 0.18856860672082731, -0.5521303228793318], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": 2, "is_min": false, "A": [0.638181567192078, 0.46024027466774, -0.417871117591858], "B": [0.226629495620728, 0.856002688407898, 0.142483130097389], "S": [0.5867375533684244, 0.509710581075374, -0.34782682999003756], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": 3, "is_min": false, "A": [0.748219311237335, 0.81936126947403, -0.322762995958328], "B": [0.137611851096153, 0.934992611408234, 0.181010782718658], "S": [0.6718933845455054, 0.8338151861125646, -0.2597912784302206], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": 4, "is_min": false, "A": [0.569112181663513, 1.15863454341888, -0.210211724042892], "B": [-0.0911190062761307, 0.902874767780304, 0.162188023328781], "S": [0.4865832738997965, 1.126664567872565, -0.1636617503920294], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}], "3": [{"index": -6, "is_min": false, "A": [-0.950857043266296, 0.467214286327362, 0.230511769652367], "B": [-0.231343150138855, 0.217632234096527, -0.0144547717645764], "S": [-0.8609178101114204, 0.436016531007736, 0.19989095316211528], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": -5, "is_min": false, "A": [-0.906903803348541, 0.318412125110626, 0.115672267973423], "B": [-0.127783983945847, 0.220468908548355, -0.0372322238981724], "S": [-0.8095138525754185, 0.3061692263907942, 0.09655921172004682], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": -4, "is_min": false, "A": [-0.768199980258942, 0.146268829703331, -0.0415540561079979], "B": [0.0222875773906708, 0.268788158893585, -0.0306523665785789], "S": [-0.669389067331149, 0.16158374092671035, -0.0401913453550796], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": -3, "is_min": false, "A": [-0.59288626909256, 0.0290690138936043, -0.197908535599709], "B": [0.135575920343399, 0.311167538166046, -0.0253877379000187], "S": [-0.5018285071135214, 0.06433132489663305, -0.17634343865825228], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": -2, "is_min": false, "A": [-0.346374720335007, -0.0398440733551979, -0.352859199047089], "B": [0.245899692177773, 0.372838348150253, -0.00803428143262863], "S": [-0.2723404178769904, 0.011741229955844541, -0.30975608382483766], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": -1, "is_min": true, "A": [-0.0397472232580185, -0.0177876837551594, -0.497750639915466], "B": [0.345971494913101, 0.455771625041962, 0.0189339481294155], "S": [0.008467604760289543, 0.04140721541484313, -0.4331650821535467], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": 0, "is_min": false, "A": [-0.0397472232580185, -0.0177876837551594, -0.497750639915466], "B": [0.345971494913101, 0.455771625041962, 0.0189339481294155], "S": [0.008467604760289543, 0.04140721541484313, -0.4331650821535467], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": 1, "is_min": false, "A": [0.227879002690315, 0.0333162695169449, -0.615285873413086], "B": [0.441277593374252, 0.483027905225754, 0.0109891630709171], "S": [0.25455382787787023, 0.08953022682985495, -0.5370014898845962], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": 2, "is_min": false, "A": [0.69004887342453, 0.332089453935623, -0.329181879758835], "B": [0.300078392028809, 0.790903508663177, 0.197518229484558], "S": [0.6413025753700897, 0.38944119651692966, -0.2633443824729022], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": 3, "is_min": false, "A": [0.856211543083191, 0.668740212917328, -0.24235562980175], "B": [0.244723066687584, 0.877066433429718, 0.229536488652229], "S": [0.779775492035852, 0.6947809875848171, -0.1833691215561721], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": 4, "is_min": false, "A": [0.86877828836441, 1.04599833488464, -0.144600808620453], "B": [0.175823852419853, 0.940894305706024, 0.241103142499924], "S": [0.7821590004612798, 1.032860333753596, -0.09638782396449813], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}], "4": [{"index": -6, "is_min": false, "A": [-0.84697437286377, 0.384704887866974, 0.177544951438904], "B": [-0.0764393135905266, 0.286262035369873, -0.01372688729316], "S": [-0.750657504681588, 0.37239953312246143, 0.15363597512899307], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": -5, "is_min": false, "A": [-0.770096182823181, 0.248917058110237, 0.0358025170862675], "B": [0.0253020785748959, 0.317957907915115, -0.0149427205324173], "S": [-0.6706714088727772, 0.2575471635785696, 0.029459362940532946], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": -4, "is_min": false, "A": [-0.627946555614471, 0.12349970638752, -0.113910727202892], "B": [0.124890193343163, 0.369853138923645, -0.00189886707812548], "S": [-0.5338419503134467, 0.1542938892770553, -0.09990924294927478], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": -3, "is_min": false, "A": [-0.458537757396698, 0.0535221174359322, -0.275756925344467], "B": [0.214670822024345, 0.392969816923141, -0.0082398047670722], "S": [-0.37438668114908713, 0.09595308179795789, -0.24231728375432302], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": -2, "is_min": false, "A": [-0.114769570529461, -0.0209578759968281, -0.336849331855774], "B": [0.236327916383743, 0.559018969535828, 0.0878364145755768], "S": [-0.070882404205132, 0.051539197416983616, -0.2837636371871245], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": -1, "is_min": true, "A": [0.198443815112114, 0.0118461288511753, -0.335104376077652], "B": [0.183759018778801, 0.653942406177521, 0.141861945390701], "S": [0.19660821577754958, 0.09210815446148407, -0.2754835926207644], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": 0, "is_min": false, "A": [0.198443815112114, 0.0118461288511753, -0.335104376077652], "B": [0.183759018778801, 0.653942406177521, 0.141861945390701], "S": [0.19660821577754958, 0.09210815446148407, -0.2754835926207644], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": 1, "is_min": false, "A": [0.477565973997116, 0.181977987289429, -0.340732246637344], "B": [0.157475799322128, 0.71253627538681, 0.165282130241394], "S": [0.4375547136222242, 0.2482977543071948, -0.2774804676432171], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": 2, "is_min": false, "A": [0.674824953079224, 0.422648221254349, -0.29702028632164], "B": [0.102581463754177, 0.742056548595428, 0.161798998713493], "S": [0.6032944848908417, 0.4625742800460771, -0.2396678500167166], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": 3, "is_min": false, "A": [0.786586701869965, 0.633217394351959, -0.147856310009956], "B": [0.029979519546032, 0.708814084529877, 0.100801691412926], "S": [0.692010810698429, 0.6426669799628634, -0.11677406200740718], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}, {"index": 4, "is_min": false, "A": [0.778066277503967, 0.890586137771606, -0.147776201367378], "B": [0.0261340141296387, 0.667864322662354, 0.0103146489709616], "S": [0.6840747337576905, 0.8627459076767444, -0.12801484279927935], "P": [0.154346406459808, 0.100275993347168, -0.320131421089172]}]};

    const STATIC_COUNT  = 8;
    const DYNAMIC_COUNT = 5;

    let currentTrial = "1";
    let currentCamera = null;

    // restyle対象トレース（動的5本）
    function dynamicTraceIndices() {
      const arr = [];
      for (let i = 0; i < DYNAMIC_COUNT; i++) arr.push(STATIC_COUNT + i);
      return arr;
    }
    const DYN_IDX = dynamicTraceIndices();

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        // 初期 camera 保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ユーザー操作で camera 変化を保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey && gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
          }
        });

        // 端末回転/リサイズ：Plotlyが勝手に変えることがあるので再適用
        let resizeTimer = null;
        function handleResize() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function() {
            Plotly.Plots.resize(gd).then(function() {
              if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
            });
          }, 150);
        }
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, currentTrial);
          });
        });

        // Slider
        slider.addEventListener("input", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init
        updateSliderForTrial(gd, currentTrial);

        function updateSliderForTrial(gd, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, trialKey, initPos);
        }

        // ★ここが本丸：restyle で x/y/z だけ更新（レイアウト触らない→カメラ戻らない）
        function updateFrame(gd, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          // Bat line (trace 0)
          const x0 = [f.A[0], f.B[0]];
          const y0 = [f.A[1], f.B[1]];
          const z0 = [f.A[2], f.B[2]];

          // Bottom marker (trace 1)
          const x1 = [f.B[0]];
          const y1 = [f.B[1]];
          const z1 = [f.B[2]];

          // Sweet (trace 2)
          const x2 = [f.S[0]];
          const y2 = [f.S[1]];
          const z2 = [f.S[2]];

          // Ball (trace 3)
          const x3 = [f.P[0]];
          const y3 = [f.P[1]];
          const z3 = [f.P[2]];

          // S->P (trace 4)
          const x4 = [f.S[0], f.P[0]];
          const y4 = [f.S[1], f.P[1]];
          const z4 = [f.S[2], f.P[2]];

          // restyle は「配列の配列」にするのがコツ
          Plotly.restyle(gd, {
            x: [x0, x1, x2, x3, x4],
            y: [y0, y1, y2, y3, y4],
            z: [z0, z1, z2, z3, z4],
          }, DYN_IDX).then(function() {
            // 念押し：カメラ保持（restyleだけなら基本不要だが、iOS保険）
            if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

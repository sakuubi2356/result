<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>nomura_Z1_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
          <button class="trial-btn" id="trialBtn_5" data-trial="5">5球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.4301049, -0.4301049, -0.4301049, -0.4301049, -0.4301049, -0.4301049], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.2297358, 0.2297358, 0.2297358, 0.2297358, 0.2297358, 0.2297358], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.4301049, 0.2297358], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.4301049, 0.2297358], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.4301049, 0.2297358], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.4301049, 0.2297358], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.4301049, 0.2297358], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [0.1197624, 0.1197624, 0.1197624, -0.1001846, -0.1001846, -0.1001846, -0.3201314, -0.3201314, -0.3201314], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [0.24420590698719, 0.024393904954195], "y": [0.0981282964348793, 0.769840896129608], "z": [-0.0340184904634953, 0.340795278549194], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [0.024393904954195], "y": [0.769840896129608], "z": [0.340795278549194], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.2167294173430221], "y": [0.18209233897428045], "z": [0.01283321257145923], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [0.100275993347168], "z": [0.119762361049652], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.2167294173430221, 0.154346406459808], "y": [0.18209233897428045, 0.100275993347168], "z": [0.01283321257145923, 0.119762361049652], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z1 (Z1)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -6, "is_min": false, "A": [-0.754874289035797, 0.0253534931689501, 0.100134074687958], "B": [0.00190546363592148, 0.266803085803986, 0.194931447505951], "S": [-0.6602768230359081, 0.05553469126435921, 0.11198374590388299], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": -5, "is_min": false, "A": [-0.478058218955994, -0.0916713625192642, 0.00913953594863415], "B": [0.100441940128803, 0.406441032886505, 0.248349696397781], "S": [-0.4057456930469932, -0.029407307907147268, 0.03904080849545748], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": -4, "is_min": false, "A": [-0.55783087015152, -0.03480064868927, 0.0512597002089024], "B": [0.0444034785032272, 0.447080552577972, 0.263638138771057], "S": [-0.4825515944485299, 0.02543448716327023, 0.0778069987241794], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": -3, "is_min": false, "A": [-0.305371880531311, -0.0812851637601852, -0.0155679564923048], "B": [0.0868301242589951, 0.544600486755371, 0.291750580072403], "S": [-0.25634662774933203, -0.003049453961751006, 0.022846862288970926], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": -2, "is_min": false, "A": [-0.020515501499176, -0.036684688180685, -0.0209308341145515], "B": [0.0473801121115685, 0.681523740291595, 0.324853420257568], "S": [-0.012028549212020269, 0.053091371575150856, 0.02229220066543743], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": -1, "is_min": true, "A": [0.24420590698719, 0.0981282964348793, -0.0340184904634953], "B": [0.024393904954195, 0.769840896129608, 0.340795278549194], "S": [0.2167294173430221, 0.18209233897428045, 0.01283321257145923], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 0, "is_min": false, "A": [0.24420590698719, 0.0981282964348793, -0.0340184904634953], "B": [0.024393904954195, 0.769840896129608, 0.340795278549194], "S": [0.2167294173430221, 0.18209233897428045, 0.01283321257145923], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 1, "is_min": false, "A": [0.493883311748505, 0.318588197231293, -0.0572360195219517], "B": [0.0578161999583244, 0.845399081707001, 0.357873439788818], "S": [0.4393749269138089, 0.38443955279035524, -0.005347341048255405], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 2, "is_min": false, "A": [0.539481639862061, 0.578058660030365, -0.0380369424819946], "B": [-0.12424697726965, 0.86338859796524, 0.305549263954163], "S": [0.45651558423568134, 0.6137248930231164, 0.0049113221850120015], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 3, "is_min": false, "A": [0.575072169303894, 0.861526906490326, -0.00804165564477444], "B": [-0.172510787844658, 0.880847156047821, 0.276117950677872], "S": [0.4816243165778438, 0.863941937247803, 0.027478288715132252], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 4, "is_min": false, "A": [0.549766719341278, 1.05615031719208, 0.110991314053535], "B": [-0.209181502461433, 0.82128244638443, 0.204984799027443], "S": [0.4548981986816244, 1.0267918355277057, 0.12274049880020935], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}], "2": [{"index": -6, "is_min": false, "A": [-0.997811079025269, 0.487964302301407, 0.251647263765335], "B": [-0.255057722330093, 0.2043826431036, 0.162770718336105], "S": [-0.904966920075031, 0.45251659896273505, 0.24053769685944498], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": -5, "is_min": false, "A": [-0.907409727573395, 0.271593749523163, 0.165792375802994], "B": [-0.108307883143425, 0.234004408121109, 0.170665234327316], "S": [-0.8075220330032961, 0.2668950835405586, 0.16640148289910886], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": -4, "is_min": false, "A": [-0.775470316410065, 0.104945152997971, 0.0745460391044617], "B": [0.00134110823273659, 0.264368444681168, 0.180133610963821], "S": [-0.6783689270729976, 0.12487305650717234, 0.08774448032072689], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": -3, "is_min": false, "A": [-0.516826391220093, -0.0310782566666603, -0.0470934733748436], "B": [0.127876073122025, 0.356322556734085, 0.22544963657856], "S": [-0.43623860864655345, 0.01734682970401089, -0.013025595397591246], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": -2, "is_min": false, "A": [-0.241840183734894, -0.0678639858961105, -0.161446079611778], "B": [0.214011907577515, 0.438240021467209, 0.258146554231644], "S": [-0.18485868896116273, -0.004601003450399807, -0.10899701569806322], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": -1, "is_min": true, "A": [0.0612258426845074, -0.0213673077523708, -0.25565379858017], "B": [0.285961210727692, 0.522803664207458, 0.285984843969345], "S": [0.08931775378144922, 0.046654039750415065, -0.18794899214202437], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 0, "is_min": false, "A": [0.0612258426845074, -0.0213673077523708, -0.25565379858017], "B": [0.285961210727692, 0.522803664207458, 0.285984843969345], "S": [0.08931775378144922, 0.046654039750415065, -0.18794899214202437], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 1, "is_min": false, "A": [0.432910174131393, 0.150632679462433, -0.208069369196892], "B": [0.276052981615067, 0.717133581638336, 0.334584176540375], "S": [0.4133030299948537, 0.2214452744365933, -0.14023769302834593], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 2, "is_min": false, "A": [0.718177855014801, 0.371040016412735, -0.111726298928261], "B": [0.269762277603149, 0.835074603557587, 0.361132800579071], "S": [0.662125923432997, 0.42904432366800305, -0.052618927934575066], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 3, "is_min": false, "A": [0.884035646915436, 0.71444970369339, 0.00952290557324886], "B": [0.213684648275375, 0.946757733821869, 0.379202157258987], "S": [0.8002417872316142, 0.7434882022105869, 0.05573280368128128], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 4, "is_min": false, "A": [0.735215544700623, 1.15300166606903, 0.0202922560274601], "B": [0.020179495215416, 0.99501758813858, 0.342417418956757], "S": [0.6458360483980515, 1.1332536585113469, 0.06055789694127525], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}], "3": [{"index": -3, "is_min": false, "A": [-0.764744877815247, 0.137767687439919, 0.107971042394638], "B": [0.0269881337881088, 0.2442796677351, 0.150560975074768], "S": [-0.6657782410022948, 0.15108168637088995, 0.1132947845370891], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": -2, "is_min": false, "A": [-0.59757786989212, -0.0107594998553395, 0.0184712074697018], "B": [0.130880236625671, 0.287734866142273, 0.160774677991867], "S": [-0.5065206334112807, 0.026552284898858955, 0.03625913604300332], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": -1, "is_min": false, "A": [-0.43001064658165, -0.12408035993576, -0.0681203603744507], "B": [0.212903589010239, 0.297323524951935, 0.153419643640518], "S": [-0.3496463622294439, -0.07140487111093874, -0.04042785818299286], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 0, "is_min": false, "A": [-0.43001064658165, -0.12408035993576, -0.0681203603744507], "B": [0.212903589010239, 0.297323524951935, 0.153419643640518], "S": [-0.3496463622294439, -0.07140487111093874, -0.04042785818299286], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 1, "is_min": false, "A": [-0.0102641396224499, -0.0873381122946739, -0.181370049715042], "B": [0.301565527915955, 0.519693076610565, 0.236093610525131], "S": [0.028714553183248465, -0.011459244120910289, -0.12918711311860653], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 2, "is_min": true, "A": [0.316637068986893, 0.0541403032839298, -0.185376286506653], "B": [0.275100976228714, 0.699033260345459, 0.286204189062119], "S": [0.31144505868203826, 0.13475190288924788, -0.12642874170565072], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 3, "is_min": false, "A": [0.592324793338776, 0.246901676058769, -0.130427107214928], "B": [0.242457017302513, 0.810332715511322, 0.316941142082214], "S": [0.5485913332039923, 0.31733053687515916, -0.07450609123037319], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 4, "is_min": false, "A": [0.709915220737457, 0.56132435798645, -0.0477630347013474], "B": [0.0769927576184273, 0.882447481155396, 0.32141050696373], "S": [0.6307999133680071, 0.6014647481185205, -0.0016163422967705038], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 5, "is_min": false, "A": [0.702486753463745, 0.893451869487762, -0.0509170591831207], "B": [-0.0124929212033749, 0.903711259365082, 0.307828962802887], "S": [0.6131142870474848, 0.8947342933240605, -0.006073802880990402], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 6, "is_min": false, "A": [0.590021252632141, 1.17140889167786, -0.0325617082417011], "B": [-0.0897446870803833, 0.883038997650146, 0.275271147489548], "S": [0.5050505098788073, 1.1353626548016826, 0.00591739885570048], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 7, "is_min": false, "A": [0.451398015022278, 1.28872931003571, 0.0159299299120903], "B": [-0.117534421384335, 0.751971781253815, 0.18388032913208], "S": [0.3802814659439677, 1.2216346241010017, 0.03692372819908735], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}], "4": [{"index": -6, "is_min": false, "A": [-0.962102115154266, 0.370531171560287, 0.297727137804031], "B": [-0.186020314693451, 0.200454488396645, 0.204075321555138], "S": [-0.8650918675000314, 0.34927158121282753, 0.2860206580461247], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": -5, "is_min": false, "A": [-0.885127484798431, 0.203871682286263, 0.238458320498466], "B": [-0.0859394669532776, 0.220473572611809, 0.206469729542732], "S": [-0.7852290122704844, 0.20594691795992884, 0.23445974781789025], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": -4, "is_min": false, "A": [-0.705467998981476, 0.0261476561427116, 0.160490334033966], "B": [0.0423761047422886, 0.299067676067352, 0.239509969949722], "S": [-0.6119875038072646, 0.0602626521405069, 0.17036778664355332], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": -3, "is_min": false, "A": [-0.493831515312195, -0.092133603990078, 0.0814527869224548], "B": [0.136359930038452, 0.366860181093216, 0.26085090637207], "S": [-0.4150575992780969, -0.03475939151373095, 0.10387754768755202], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": -2, "is_min": false, "A": [-0.224537253379822, -0.141448855400085, -0.0111027546226978], "B": [0.218030095100403, 0.45522403717041, 0.285740375518799], "S": [-0.16921634530403246, -0.06686475796370871, 0.02600262961289756], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": -1, "is_min": true, "A": [0.105423219501972, -0.0265111178159714, -0.0962371006608009], "B": [0.233266070485115, 0.64054924249649, 0.326476693153381], "S": [0.12140357249990871, 0.05687140961318901, -0.043397887593357845], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 0, "is_min": false, "A": [0.105423219501972, -0.0265111178159714, -0.0962371006608009], "B": [0.233266070485115, 0.64054924249649, 0.326476693153381], "S": [0.12140357249990871, 0.05687140961318901, -0.043397887593357845], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 1, "is_min": false, "A": [0.385584801435471, 0.138686165213585, -0.117566451430321], "B": [0.229125589132309, 0.770367026329041, 0.347729086875916], "S": [0.366027401935545, 0.21764626462501846, -0.059404515202777494], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 2, "is_min": false, "A": [0.626160264015198, 0.345425009727478, -0.160303831100464], "B": [0.28380486369133, 0.845627069473267, 0.361798763275146], "S": [0.5833658536772194, 0.40795024571444793, -0.0950410292252883], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 3, "is_min": false, "A": [0.644269347190857, 0.771778762340546, -0.0429312139749527], "B": [-0.0139636658132076, 0.975189030170441, 0.363705724477768], "S": [0.5619902228910996, 0.7972050451005684, 0.007898401894857292], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 4, "is_min": false, "A": [0.551447570323944, 1.09466826915741, -0.0771474242210388], "B": [-0.121897786855698, 0.996454358100891, 0.343518823385239], "S": [0.46727940292769415, 1.082391530603705, -0.024564144676673713], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}], "5": [{"index": -2, "is_min": false, "A": [-0.698905408382416, 0.192707121372223, 0.181557387113571], "B": [0.0992166250944138, 0.232462674379349, 0.143867790699005], "S": [-0.5991401378296024, 0.19767656631343675, 0.17684618678879674], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": -1, "is_min": false, "A": [-0.549460351467133, 0.0426545962691307, 0.0679574385285378], "B": [0.206170096993446, 0.287020862102509, 0.164435207843781], "S": [-0.45500656064688405, 0.07320037457064578, 0.08001715774746446], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 0, "is_min": false, "A": [-0.549460351467133, 0.0426545962691307, 0.0679574385285378], "B": [0.206170096993446, 0.287020862102509, 0.164435207843781], "S": [-0.45500656064688405, 0.07320037457064578, 0.08001715774746446], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 1, "is_min": false, "A": [-0.33258980512619, -0.0748293995857239, -0.0467033237218857], "B": [0.303614258766174, 0.350414216518402, 0.186561405658722], "S": [-0.2530643081939041, -0.021673954961458998, -0.01754523660236285], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 2, "is_min": false, "A": [-0.0979371070861816, -0.15193735063076, -0.155457109212875], "B": [0.396818995475769, 0.373790144920349, 0.189255803823471], "S": [-0.03609259392843759, -0.0862214133282439, -0.11236799484818423], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 3, "is_min": true, "A": [0.318911671638489, -0.0901507884263992, -0.0884605124592781], "B": [0.387243092060089, 0.615443825721741, 0.282304912805557], "S": [0.3274530995708587, -0.001951457737387613, -0.042114832241090465], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 4, "is_min": false, "A": [0.606235861778259, 0.124775588512421, -0.071780227124691], "B": [0.298101484775543, 0.753673791885376, 0.314925074577332], "S": [0.567719086765786, 0.20338781880197135, -0.023442092163345703], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 5, "is_min": false, "A": [0.806772589683533, 0.418392926454544, -0.0660570114850998], "B": [0.244204506278038, 0.831943452358246, 0.324446380138397], "S": [0.7364515674357395, 0.47008675088307883, -0.01724407932591547], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 6, "is_min": false, "A": [0.862454831600189, 0.721019625663757, 0.0300393290817738], "B": [0.113168261945248, 0.841933131217957, 0.282921940088272], "S": [0.7687940143622085, 0.7361338132175667, 0.061649654118095164], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 7, "is_min": false, "A": [0.831874489784241, 1.02403259277344, 0.111343935132027], "B": [0.0643623620271683, 0.846621632575989, 0.250811040401459], "S": [0.7359355179243833, 1.001856232944764, 0.1287773152753762], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}, {"index": 8, "is_min": false, "A": [0.564427435398102, 1.3970263004303, 0.0254327170550823], "B": [0.0390265434980392, 0.803398251533508, 0.132948830723763], "S": [0.49875232762251065, 1.322822798512137, 0.0388722305040744], "P": [0.154346406459808, 0.100275993347168, 0.119762361049652]}]};

    const STATIC_COUNT  = 8;
    const DYNAMIC_COUNT = 5;

    let currentTrial = "1";
    let currentCamera = null;

    // restyle対象トレース（動的5本）
    function dynamicTraceIndices() {
      const arr = [];
      for (let i = 0; i < DYNAMIC_COUNT; i++) arr.push(STATIC_COUNT + i);
      return arr;
    }
    const DYN_IDX = dynamicTraceIndices();

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        // 初期 camera 保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ユーザー操作で camera 変化を保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey && gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
          }
        });

        // 端末回転/リサイズ：Plotlyが勝手に変えることがあるので再適用
        let resizeTimer = null;
        function handleResize() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function() {
            Plotly.Plots.resize(gd).then(function() {
              if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
            });
          }, 150);
        }
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, currentTrial);
          });
        });

        // Slider
        slider.addEventListener("input", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init
        updateSliderForTrial(gd, currentTrial);

        function updateSliderForTrial(gd, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, trialKey, initPos);
        }

        // ★ここが本丸：restyle で x/y/z だけ更新（レイアウト触らない→カメラ戻らない）
        function updateFrame(gd, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          // Bat line (trace 0)
          const x0 = [f.A[0], f.B[0]];
          const y0 = [f.A[1], f.B[1]];
          const z0 = [f.A[2], f.B[2]];

          // Bottom marker (trace 1)
          const x1 = [f.B[0]];
          const y1 = [f.B[1]];
          const z1 = [f.B[2]];

          // Sweet (trace 2)
          const x2 = [f.S[0]];
          const y2 = [f.S[1]];
          const z2 = [f.S[2]];

          // Ball (trace 3)
          const x3 = [f.P[0]];
          const y3 = [f.P[1]];
          const z3 = [f.P[2]];

          // S->P (trace 4)
          const x4 = [f.S[0], f.P[0]];
          const y4 = [f.S[1], f.P[1]];
          const z4 = [f.S[2], f.P[2]];

          // restyle は「配列の配列」にするのがコツ
          Plotly.restyle(gd, {
            x: [x0, x1, x2, x3, x4],
            y: [y0, y1, y2, y3, y4],
            z: [z0, z1, z2, z3, z4],
          }, DYN_IDX).then(function() {
            // 念押し：カメラ保持（restyleだけなら基本不要だが、iOS保険）
            if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>nomura_Z3_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.4301049, -0.4301049, -0.4301049, -0.4301049, -0.4301049, -0.4301049], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.2297358, 0.2297358, 0.2297358, 0.2297358, 0.2297358, 0.2297358], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.4301049, 0.2297358], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.4301049, 0.2297358], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.4301049, 0.2297358], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.4301049, 0.2297358], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.4301049, 0.2297358], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [0.1197624, 0.1197624, 0.1197624, -0.1001846, -0.1001846, -0.1001846, -0.3201314, -0.3201314, -0.3201314], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [0.255329698324203, 0.383952528238297], "y": [-0.205394551157951, 0.419621884822845], "z": [-0.194587677717209, 0.287917077541351], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [0.383952528238297], "y": [0.419621884822845], "z": [0.287917077541351], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.2714075493444445], "y": [-0.12726750987287633], "z": [-0.13427459350979049], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [-0.100275993347168], "z": [0.119762361049652], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.2714075493444445, 0.154346406459808], "y": [-0.12726750987287633, -0.100275993347168], "z": [-0.13427459350979049, 0.119762361049652], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z3 (Z3)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -3, "is_min": false, "A": [-0.807909488677979, 0.161964878439903, 0.136743828654289], "B": [-0.00959151238203049, 0.114624284207821, 0.157898530364037], "S": [-0.708119760705806, 0.1560473052914447, 0.13938816586280706], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": -2, "is_min": false, "A": [-0.663842260837555, -0.0199033301323652, 0.0357299335300922], "B": [0.107958018779755, 0.13828706741333, 0.174655631184578], "S": [-0.5673672426902684, -0.00012953388352907047, 0.05309564271198919], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": -1, "is_min": false, "A": [-0.451107144355774, -0.166192427277565, -0.07340969145298], "B": [0.218619108200073, 0.178000494837761, 0.196771577000618], "S": [-0.3673913587849388, -0.12316830995673017, -0.039637031282052065], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 0, "is_min": false, "A": [-0.451107144355774, -0.166192427277565, -0.07340969145298], "B": [0.218619108200073, 0.178000494837761, 0.196771577000618], "S": [-0.3673913587849388, -0.12316830995673017, -0.039637031282052065], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 1, "is_min": false, "A": [-0.09528998285532, -0.224790781736374, -0.165047705173492], "B": [0.319265842437744, 0.317047625780106, 0.252749890089035], "S": [-0.043470513711551466, -0.15706099258346617, -0.11282301485405904], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 2, "is_min": true, "A": [0.255329698324203, -0.205394551157951, -0.194587677717209], "B": [0.383952528238297, 0.419621884822845, 0.287917077541351], "S": [0.2714075493444445, -0.12726750987287633, -0.13427459350979049], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 3, "is_min": false, "A": [0.62790858745575, -0.0390510484576225, -0.0386770218610764], "B": [0.33300593495369, 0.599979758262634, 0.341681450605392], "S": [0.5910457706947732, 0.04082777030811739, 0.008867768106245226], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 4, "is_min": false, "A": [0.855995178222656, 0.269786238670349, -0.012432312592864], "B": [0.289906233549118, 0.695319533348083, 0.359676957130432], "S": [0.7852340925766035, 0.3229778761210734, 0.034081324799869646], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 5, "is_min": false, "A": [0.923738241195679, 0.655533075332642, -0.00638414733111858], "B": [0.220121026039124, 0.759994149208069, 0.359690845012665], "S": [0.8357861031425333, 0.6685907075121321, 0.03937521951049694], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 6, "is_min": false, "A": [0.780497372150421, 0.968584895133972, 0.0443331152200699], "B": [0.0605314262211323, 0.730075240135193, 0.298817873001099], "S": [0.6905016507591188, 0.9387711954975257, 0.07614370221947761], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 7, "is_min": false, "A": [0.609437704086304, 1.21421301364899, 0.094853512942791], "B": [0.0150251109153032, 0.703591108322144, 0.25590917468071], "S": [0.5351361292025862, 1.15038527484973, 0.11498547085981334], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}], "2": [{"index": -6, "is_min": false, "A": [-0.923943281173706, 0.448073506355286, 0.240401938557625], "B": [-0.203416615724564, 0.124409019947052, 0.113584391772747], "S": [-0.8338774526054605, 0.4076154476263952, 0.22454974602141625], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": -5, "is_min": false, "A": [-0.880968809127808, 0.273157596588135, 0.159444019198418], "B": [-0.0978608727455139, 0.115638464689255, 0.115512810647488], "S": [-0.7830803375772423, 0.2534677092237117, 0.15395261927941584], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": -4, "is_min": false, "A": [-0.739540159702301, 0.0687851384282112, 0.0562025345861912], "B": [0.0500341914594173, 0.152364462614059, 0.154114186763763], "S": [-0.6408433543240171, 0.07923255516696692, 0.06844149253235271], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": -3, "is_min": false, "A": [-0.555363118648529, -0.084625780582428, -0.0512736700475216], "B": [0.162090018391609, 0.185557842254639, 0.177335411310196], "S": [-0.46568149795643243, -0.05085283580103979, -0.022697541708780366], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": -2, "is_min": false, "A": [-0.259920418262482, -0.154750794172287, -0.170292183756828], "B": [0.270374566316605, 0.294096499681473, 0.226348415017128], "S": [-0.19363356737885656, -0.09864490122136892, -0.12071212550643738], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": -1, "is_min": true, "A": [0.0442867837846279, -0.183117493987083, -0.220678240060806], "B": [0.346379280090332, 0.382969200611115, 0.257115125656128], "S": [0.08204833040998377, -0.112356686044235, -0.16095409372336172], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 0, "is_min": false, "A": [0.0442867837846279, -0.183117493987083, -0.220678240060806], "B": [0.346379280090332, 0.382969200611115, 0.257115125656128], "S": [0.08204833040998377, -0.112356686044235, -0.16095409372336172], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 1, "is_min": false, "A": [0.37862753868103, -0.078973263502121, -0.18805243074894], "B": [0.332567393779755, 0.551606595516205, 0.302098602056503], "S": [0.3728700229546271, -0.0001508137935354037, -0.12678357704171192], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 2, "is_min": false, "A": [0.656464874744415, 0.111890539526939, -0.152539879083633], "B": [0.314951479434967, 0.656152427196503, 0.324060708284378], "S": [0.613775717720724, 0.17992324777161514, -0.09296482993131219], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 3, "is_min": false, "A": [0.829330205917358, 0.396163582801819, -0.112699404358864], "B": [0.259532570838928, 0.743158757686615, 0.328803777694702], "S": [0.7581055046540727, 0.4395379777614772, -0.05751150902085212], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 4, "is_min": false, "A": [0.82515949010849, 0.695143103599548, -0.0504277572035789], "B": [0.0972067415714264, 0.75083863735199, 0.276654541492462], "S": [0.7341653984396446, 0.7021050451733656, -0.009542470719508596], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}], "3": [{"index": -6, "is_min": false, "A": [-0.871152639389038, 0.462758988142014, 0.258809983730316], "B": [-0.15784265100956, 0.127306237816811, 0.122207716107368], "S": [-0.7819888815589872, 0.4208273899859697, 0.2417346984997822], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": -5, "is_min": false, "A": [-0.834664642810822, 0.286335021257401, 0.182014018297195], "B": [-0.0522506572306156, 0.127829179167747, 0.130013257265091], "S": [-0.7368628813150042, 0.26652178830215123, 0.17551392228435153], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": -4, "is_min": false, "A": [-0.714645147323608, 0.0862776190042496, 0.0895346477627754], "B": [0.0758399963378906, 0.175151661038399, 0.174591466784477], "S": [-0.6158345059221202, 0.09738687408355516, 0.10016674997303981], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": -3, "is_min": false, "A": [-0.53895628452301, -0.0736132860183716, -0.00761525984853506], "B": [0.174401044845581, 0.220189705491066, 0.204047799110413], "S": [-0.44978662724881335, -0.036887915743955266, 0.018842619881506026], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": -2, "is_min": false, "A": [-0.334034740924835, -0.197527781128883, -0.0982814952731133], "B": [0.264843583106995, 0.231076493859291, 0.214198231697083], "S": [-0.2591749768148066, -0.14395226564494118, -0.05922154317354177], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": -1, "is_min": true, "A": [0.0353362411260605, -0.235408276319504, -0.0976642221212387], "B": [0.278834670782089, 0.424108356237411, 0.284103333950043], "S": [0.06577354148655908, -0.15296870631391402, -0.0499432828591263], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 0, "is_min": false, "A": [0.0353362411260605, -0.235408276319504, -0.0976642221212387], "B": [0.278834670782089, 0.424108356237411, 0.284103333950043], "S": [0.06577354148655908, -0.15296870631391402, -0.0499432828591263], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 1, "is_min": false, "A": [0.346921384334564, -0.172173827886581, -0.0449468120932579], "B": [0.221414163708687, 0.537276268005371, 0.302800863981247], "S": [0.33123298110925076, -0.08349256224236933, -0.0014783507910592353], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 2, "is_min": false, "A": [0.615883827209473, 0.0169095899909735, -0.0407128185033798], "B": [0.189763575792313, 0.59992903470993, 0.303540140390396], "S": [0.562618805823422, 0.08978700684257768, 0.0023187932463682934], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 3, "is_min": false, "A": [0.801795542240143, 0.285412281751633, -0.00576567370444536], "B": [0.14631874859333, 0.637804925441742, 0.287781774997711], "S": [0.7198609754865157, 0.329461344766169, 0.030927742849983363], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 4, "is_min": false, "A": [0.875238716602325, 0.526088714599609, 0.124151453375816], "B": [0.0849748328328133, 0.600825309753418, 0.223638132214546], "S": [0.7764557437809136, 0.5354307877975243, 0.13658728663817102], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}], "4": [{"index": -4, "is_min": false, "A": [-0.823253810405731, 0.1990827023983, 0.135273084044456], "B": [-0.0322076305747032, 0.0798083171248436, 0.139691963791847], "S": [-0.7243730351540073, 0.18417340382102682, 0.13582544402836932], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": -3, "is_min": false, "A": [-0.661324679851532, -0.00186615064740181, 0.0349155217409134], "B": [0.11440934240818, 0.138800144195557, 0.170745491981506], "S": [-0.564357931660719, 0.015717135375349498, 0.05189426721699564], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": -2, "is_min": false, "A": [-0.46007964015007, -0.13842386007309, -0.067184641957283], "B": [0.220083385705948, 0.19324404001236, 0.192382648587227], "S": [-0.37505929619250633, -0.09696538927565343, -0.034738743719205704], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": -1, "is_min": false, "A": [-0.258479833602905, -0.236264795064926, -0.158821687102318], "B": [0.307540506124496, 0.205115497112274, 0.194454744458199], "S": [-0.18772728143081716, -0.18109225097395096, -0.11466212709924047], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 0, "is_min": false, "A": [-0.258479833602905, -0.236264795064926, -0.158821687102318], "B": [0.307540506124496, 0.205115497112274, 0.194454744458199], "S": [-0.18772728143081716, -0.18109225097395096, -0.11466212709924047], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 1, "is_min": true, "A": [0.153391629457474, -0.206316918134689, -0.17698472738266], "B": [0.349164545536041, 0.4289331138134, 0.268133759498596], "S": [0.17786324195749853, -0.1269106706626274, -0.12134492109207023], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 2, "is_min": false, "A": [0.476024806499481, -0.101377606391907, -0.165247976779938], "B": [0.362565100193024, 0.540109038352966, 0.299103021621704], "S": [0.4618423439874175, -0.021191780187580014, -0.1072041051566272], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 3, "is_min": false, "A": [0.743697047233582, 0.125579476356506, -0.126173466444016], "B": [0.335877060890198, 0.645666122436523, 0.324595510959625], "S": [0.6927195462197907, 0.19059031058639023, -0.06982734126114812], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 4, "is_min": false, "A": [0.681093811988831, 0.131162509322166, -0.0376449599862099], "B": [0.169848039746284, 0.643608927726746, 0.302981704473495], "S": [0.6171880952470729, 0.19521830682293245, 0.004933369880789074], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 5, "is_min": false, "A": [0.80711966753006, 0.418557107448578, -0.00952769257128239], "B": [0.109641581773758, 0.668586671352386, 0.292150378227234], "S": [0.7199349150751541, 0.449810799973877, 0.028182062703856158], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}, {"index": 6, "is_min": false, "A": [0.819993495941162, 0.710137546062469, 0.035835973918438], "B": [0.0550705604255199, 0.659441769123077, 0.264577478170395], "S": [0.7243781166646929, 0.7038005731274012, 0.0644286656391763], "P": [0.154346406459808, -0.100275993347168, 0.119762361049652]}]};

    const STATIC_COUNT  = 8;
    const DYNAMIC_COUNT = 5;

    let currentTrial = "1";
    let currentCamera = null;

    // restyle対象トレース（動的5本）
    function dynamicTraceIndices() {
      const arr = [];
      for (let i = 0; i < DYNAMIC_COUNT; i++) arr.push(STATIC_COUNT + i);
      return arr;
    }
    const DYN_IDX = dynamicTraceIndices();

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        // 初期 camera 保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ユーザー操作で camera 変化を保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey && gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
          }
        });

        // 端末回転/リサイズ：Plotlyが勝手に変えることがあるので再適用
        let resizeTimer = null;
        function handleResize() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function() {
            Plotly.Plots.resize(gd).then(function() {
              if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
            });
          }, 150);
        }
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, currentTrial);
          });
        });

        // Slider
        slider.addEventListener("input", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init
        updateSliderForTrial(gd, currentTrial);

        function updateSliderForTrial(gd, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, trialKey, initPos);
        }

        // ★ここが本丸：restyle で x/y/z だけ更新（レイアウト触らない→カメラ戻らない）
        function updateFrame(gd, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          // Bat line (trace 0)
          const x0 = [f.A[0], f.B[0]];
          const y0 = [f.A[1], f.B[1]];
          const z0 = [f.A[2], f.B[2]];

          // Bottom marker (trace 1)
          const x1 = [f.B[0]];
          const y1 = [f.B[1]];
          const z1 = [f.B[2]];

          // Sweet (trace 2)
          const x2 = [f.S[0]];
          const y2 = [f.S[1]];
          const z2 = [f.S[2]];

          // Ball (trace 3)
          const x3 = [f.P[0]];
          const y3 = [f.P[1]];
          const z3 = [f.P[2]];

          // S->P (trace 4)
          const x4 = [f.S[0], f.P[0]];
          const y4 = [f.S[1], f.P[1]];
          const z4 = [f.S[2], f.P[2]];

          // restyle は「配列の配列」にするのがコツ
          Plotly.restyle(gd, {
            x: [x0, x1, x2, x3, x4],
            y: [y0, y1, y2, y3, y4],
            z: [z0, z1, z2, z3, z4],
          }, DYN_IDX).then(function() {
            // 念押し：カメラ保持（restyleだけなら基本不要だが、iOS保険）
            if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Momo_Z1_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
          <button class="trial-btn" id="trialBtn_5" data-trial="5">5球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.4695162, -0.4695162, -0.4695162, -0.4695162, -0.4695162, -0.4695162], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.06407398, 0.06407398, 0.06407398, 0.06407398, 0.06407398, 0.06407398], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.4695162, 0.06407398], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.4695162, 0.06407398], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.4695162, 0.06407398], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.4695162, 0.06407398], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.4695162, 0.06407398], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [-0.0248577, -0.0248577, -0.0248577, -0.2027211, -0.2027211, -0.2027211, -0.3805845, -0.3805845, -0.3805845], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [0.125508010387421, 0.134604394435883], "y": [0.0035897009074688, 0.709635078907013], "z": [-0.145744547247887, 0.230310365557671], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [0.134604394435883], "y": [0.709635078907013], "z": [0.230310365557671], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.1266450582891524], "y": [0.09184536505978456], "z": [-0.0987376874601622], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [0.100275993347168], "z": [-0.0248576998710632], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.1266450582891524, 0.154346406459808], "y": [0.09184536505978456, 0.100275993347168], "z": [-0.0987376874601622, -0.0248576998710632], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z1 (Z1)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -6, "is_min": false, "A": [-0.792965114116669, 0.44300377368927, 0.125222593545914], "B": [-0.0349367707967758, 0.197628617286682, 0.0532221421599388], "S": [-0.6982115713242462, 0.41233187917862063, 0.11622253713430868], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -5, "is_min": false, "A": [-0.729850113391876, 0.312266290187836, 0.0321047753095627], "B": [0.0667627975344658, 0.286474108695984, 0.100972726941109], "S": [-0.6302735120698226, 0.309042267907487, 0.04071326817908766], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -4, "is_min": false, "A": [-0.600985705852509, 0.19125697016716, -0.064885102212429], "B": [0.164508208632469, 0.324755996465683, 0.125371262431145], "S": [-0.5052989969989297, 0.20794434314289093, -0.041103064201795894], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -3, "is_min": false, "A": [-0.424981951713562, 0.0831029936671257, -0.152609080076218], "B": [0.261175453662872, 0.362405776977539, 0.149347811937332], "S": [-0.33921227566307227, 0.11801584173497087, -0.11486446840798636], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -2, "is_min": false, "A": [-0.164573147892952, -0.027268473058939, -0.130219459533691], "B": [0.165412083268166, 0.615920603275299, 0.212443351745605], "S": [-0.12332500182638664, 0.05313014622381381, -0.08738661625311647], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -1, "is_min": true, "A": [0.125508010387421, 0.0035897009074688, -0.145744547247887], "B": [0.134604394435883, 0.709635078907013, 0.230310365557671], "S": [0.1266450582891524, 0.09184536505978456, -0.0987376874601622], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 0, "is_min": false, "A": [0.125508010387421, 0.0035897009074688, -0.145744547247887], "B": [0.134604394435883, 0.709635078907013, 0.230310365557671], "S": [0.1266450582891524, 0.09184536505978456, -0.0987376874601622], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 1, "is_min": false, "A": [0.401032596826553, 0.137664303183556, -0.122825860977173], "B": [0.0752581059932709, 0.775921821594238, 0.232840642333031], "S": [0.36031079629746604, 0.21744647177640308, -0.0783675598817445], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 2, "is_min": false, "A": [0.617987632751465, 0.314989805221558, -0.0059446394443512], "B": [-0.023103266954422, 0.747695922851563, 0.198427319526672], "S": [0.537851271761598, 0.36907806893085415, 0.01960185495733467], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 3, "is_min": false, "A": [0.713971436023712, 0.642485499382019, 0.00340864714235067], "B": [-0.0628212988376617, 0.721464276313782, 0.177636474370956], "S": [0.6168723393050053, 0.6523578469927249, 0.02518712663621404], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 4, "is_min": false, "A": [0.755317568778992, 0.719017744064331, 0.226812690496445], "B": [-0.0354168117046356, 0.629646897315979, 0.14464071393013], "S": [0.6564757899413441, 0.707846390336887, 0.2165411953713026], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}], "2": [{"index": -6, "is_min": false, "A": [-0.757008969783783, 0.3821642100811, 0.12677626311779], "B": [0.0229129754006863, 0.205342382192612, 0.105427294969559], "S": [-0.6595187249478595, 0.3600614812123708, 0.12410764205305884], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -5, "is_min": false, "A": [-0.684249401092529, 0.291343599557877, 0.0587329231202602], "B": [0.111525312066078, 0.263182312250137, 0.135867834091187], "S": [-0.5847775811190283, 0.28782343932285426, 0.06837478513333822], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -4, "is_min": false, "A": [-0.562598586082458, 0.150902912020683, -0.0105935325846076], "B": [0.176935791969299, 0.385517716407776, 0.184458181262016], "S": [-0.4701568158242172, 0.18022975400397198, 0.013787924525454966], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -3, "is_min": false, "A": [-0.392701148986816, 0.0629820972681046, -0.0648131668567657], "B": [0.22382427752018, 0.485729575157166, 0.220109909772873], "S": [-0.31563548218435966, 0.1158255241112755, -0.02919778759775423], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -2, "is_min": false, "A": [-0.177400499582291, 0.0226062666624784, -0.118805430829525], "B": [0.293102651834488, 0.55387145280838, 0.25049751996994], "S": [-0.11858763244136783, 0.08901438468530376, -0.0726425830043462], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -1, "is_min": true, "A": [0.070873849093914, 0.0283055305480957, -0.115718126296997], "B": [0.16551698744297, 0.722683548927307, 0.270134538412094], "S": [0.08270423736791435, 0.11510275335425345, -0.0674865595960841], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 0, "is_min": false, "A": [0.070873849093914, 0.0283055305480957, -0.115718126296997], "B": [0.16551698744297, 0.722683548927307, 0.270134538412094], "S": [0.08270423736791435, 0.11510275335425345, -0.0674865595960841], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 1, "is_min": false, "A": [0.314652174711227, 0.124505594372749, -0.0960503220558167], "B": [0.113792009651661, 0.801547884941101, 0.279807806015015], "S": [0.2895446619555306, 0.20913585414351893, -0.04906807078627291], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 2, "is_min": false, "A": [0.496978491544724, 0.24327340722084, -0.0251459963619709], "B": [-0.00510063767433167, 0.79785281419754, 0.258329272270203], "S": [0.4342186003220351, 0.31259583317058615, 0.010288412256746336], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 3, "is_min": false, "A": [0.540903568267822, 0.377699911594391, -0.0559164583683014], "B": [-0.0612678527832031, 0.804507195949554, 0.252669006586075], "S": [0.46563213284410626, 0.43105082766184233, -0.01734327125578572], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 4, "is_min": false, "A": [0.657164514064789, 0.623541235923767, 0.0136560583487153], "B": [-0.098156750202179, 0.764745116233826, 0.236258074641228], "S": [0.5627493859584981, 0.6411917153677926, 0.041481301565418655], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}], "3": [{"index": -6, "is_min": false, "A": [-0.810260474681854, 0.307993113994598, 0.00897155608981848], "B": [-0.0331721641123295, 0.144619643688202, 0.106145173311234], "S": [-0.7131244241062632, 0.2875714277350772, 0.021118259712363873], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -5, "is_min": false, "A": [-0.705088138580322, 0.156693175435066, -0.0562999583780766], "B": [0.0658698678016663, 0.226836189627647, 0.145451620221138], "S": [-0.6087183869929277, 0.1654610522809819, -0.031081010846532794], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -4, "is_min": false, "A": [-0.55994987487793, 0.0522306337952614, -0.118988320231438], "B": [0.142328932881355, 0.298176556825638, 0.174805790185928], "S": [-0.4721650170634748, 0.08297387657109484, -0.08226405356589322], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -3, "is_min": false, "A": [-0.356623888015747, -0.0389945320785046, -0.170194521546364], "B": [0.20478880405426, 0.389917701482773, 0.205105438828468], "S": [-0.2864473001458536, 0.014619498156550885, -0.12328202558959694], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -2, "is_min": false, "A": [-0.115153416991234, -0.0822919905185699, -0.184270843863487], "B": [0.200699850916862, 0.526618957519531, 0.227389559149742], "S": [-0.07567176210844247, -0.00617812896501814, -0.13281329818626975], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -1, "is_min": true, "A": [0.142113417387009, -0.0466877669095993, -0.190985649824142], "B": [0.198067009449005, 0.624051988124847, 0.241423696279526], "S": [0.14910761384818236, 0.037154671942803814, -0.13693450124112336], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 0, "is_min": false, "A": [0.142113417387009, -0.0466877669095993, -0.190985649824142], "B": [0.198067009449005, 0.624051988124847, 0.241423696279526], "S": [0.14910761384818236, 0.037154671942803814, -0.13693450124112336], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 1, "is_min": false, "A": [0.381001621484756, 0.0292651727795601, -0.106381349265575], "B": [0.110729843378067, 0.702134072780609, 0.231555059552193], "S": [0.34721765996456544, 0.11337375853354484, -0.06413931159612918], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 2, "is_min": false, "A": [0.584863245487213, 0.20996168255806, -0.0606403909623623], "B": [0.0636345744132996, 0.745448231697083, 0.224973797798157], "S": [0.5197096940107305, 0.2768974679061877, -0.02493863512555905], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 3, "is_min": false, "A": [0.717010915279388, 0.447689235210419, -0.0156821459531784], "B": [0.0203419104218483, 0.766390800476074, 0.214712142944336], "S": [0.6299272841198359, 0.4875269334086351, 0.013117141995222861], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 4, "is_min": false, "A": [0.760172724723816, 0.619239509105682, 0.143050953745842], "B": [-0.0349483713507652, 0.699079811573029, 0.180573686957359], "S": [0.660782586691752, 0.6292195470167967, 0.14774129544554604], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}], "4": [{"index": -6, "is_min": false, "A": [-0.810055911540985, 0.200613483786583, 0.00851882994174957], "B": [-0.0178426466882229, 0.187053427100182, 0.119038298726082], "S": [-0.7110292754930642, 0.19891847707835403, 0.02233376046244681], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -5, "is_min": false, "A": [-0.691080749034882, 0.0942060872912407, -0.0566110275685787], "B": [0.0640085786581039, 0.251807421445847, 0.155526414513588], "S": [-0.5966946101839272, 0.11390624840206046, -0.03009385492487408], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -4, "is_min": false, "A": [-0.544388473033905, 0.0102535765618086, -0.123534612357616], "B": [0.14345295727253, 0.286832123994827, 0.177096322178841], "S": [-0.45840832682041044, 0.04482588189272288, -0.08595575977784538], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -3, "is_min": false, "A": [-0.302777379751205, -0.0551337227225304, -0.1319620013237], "B": [0.155151799321175, 0.479088544845581, 0.248705416917801], "S": [-0.24553624343625813, 0.011644047810220277, -0.08437858324503558], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -2, "is_min": false, "A": [-0.0546734780073166, -0.0490651205182076, -0.145704105496407], "B": [0.168583810329437, 0.589660167694092, 0.281129002571106], "S": [-0.026766323783722897, 0.030775521001021815, -0.09234998002387716], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -1, "is_min": true, "A": [0.205621495842934, 0.0400013402104378, -0.144016042351723], "B": [0.15546803176403, 0.701100707054138, 0.303681164979935], "S": [0.1993523154399368, 0.12263872670342149, -0.08805391470557364], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 0, "is_min": false, "A": [0.205621495842934, 0.0400013402104378, -0.144016042351723], "B": [0.15546803176403, 0.701100707054138, 0.303681164979935], "S": [0.1993523154399368, 0.12263872670342149, -0.08805391470557364], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 1, "is_min": false, "A": [0.419147372245789, 0.197402954101563, -0.0850197300314903], "B": [0.0476638562977314, 0.796587109565735, 0.293105483055115], "S": [0.37271194478022535, 0.2723009541341188, -0.037754090638653946], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 2, "is_min": false, "A": [0.580136656761169, 0.432839751243591, -0.0444993898272514], "B": [-0.0136708840727806, 0.855689406394958, 0.285031884908676], "S": [0.5059107192275991, 0.4856959545266909, -0.003307983299211996], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 3, "is_min": false, "A": [0.650390088558197, 0.63868123292923, 0.0957002565264702], "B": [-0.11403888463974, 0.821343004703522, 0.244975954294205], "S": [0.5548364827252792, 0.6615139506215559, 0.11435971565876882], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 4, "is_min": false, "A": [0.63559627532959, 0.901160418987274, 0.147661566734314], "B": [-0.154240548610687, 0.800787508487701, 0.225656539201736], "S": [0.5368666835478317, 0.8886138065994992, 0.15741093718569765], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}], "5": [{"index": -6, "is_min": false, "A": [-0.922148287296295, 0.250834733247757, 0.0279890224337578], "B": [-0.134347259998322, 0.125057652592659, 0.0875691398978233], "S": [-0.8236731683489604, 0.23511259967699877, 0.03543653640095001], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -5, "is_min": false, "A": [-0.823488235473633, 0.135551482439041, -0.0480817183852196], "B": [-0.0396439284086227, 0.168950527906418, 0.108356282114983], "S": [-0.7255077156116447, 0.13972636233329067, -0.028526972019104094], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -4, "is_min": false, "A": [-0.671709179878235, 0.0205129757523537, -0.119064189493656], "B": [0.0551119893789291, 0.236427843570709, 0.136106416583061], "S": [-0.580856553625686, 0.047502328316641584, -0.08716787072212365], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -3, "is_min": false, "A": [-0.443529605865479, -0.0766909569501877, -0.154623314738274], "B": [0.12043059617281, 0.380888789892197, 0.180890992283821], "S": [-0.37303459076747764, -0.01949349683578848, -0.11268403240304241], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -2, "is_min": false, "A": [-0.185482606291771, -0.0986495614051819, -0.190558314323425], "B": [0.162447348237038, 0.499540269374847, 0.21083191037178], "S": [-0.14199137690498065, -0.02387585822537884, -0.14038455345975948], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": -1, "is_min": true, "A": [0.0873713344335556, -0.0339075438678265, -0.175425738096237], "B": [0.0973646938800812, 0.656703770160675, 0.228253424167633], "S": [0.08862050366137882, 0.052418821804018814, -0.12496587121045233], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 0, "is_min": false, "A": [0.0873713344335556, -0.0339075438678265, -0.175425738096237], "B": [0.0973646938800812, 0.656703770160675, 0.228253424167633], "S": [0.08862050366137882, 0.052418821804018814, -0.12496587121045233], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 1, "is_min": false, "A": [0.338439077138901, 0.129693284630775, -0.16280010342598], "B": [0.04834995418787, 0.760479390621185, 0.234638094902039], "S": [0.3021779348508803, 0.20854155205266622, -0.11312032600564681], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 2, "is_min": false, "A": [0.514100909233093, 0.372896254062653, -0.13990905880928], "B": [-0.0286141447722912, 0.829699516296387, 0.229943722486496], "S": [0.446261523775828, 0.42999666496170824, -0.09367745862131696], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 3, "is_min": false, "A": [0.580210983753204, 0.569463312625885, -0.0323080345988274], "B": [-0.160549610853195, 0.773095071315765, 0.190867960453033], "S": [0.48761588602081796, 0.5949172888964854, -0.004411028165419835], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}, {"index": 4, "is_min": false, "A": [0.567932546138763, 0.82574588060379, 0.00590662937611341], "B": [-0.209826037287712, 0.736619055271149, 0.170673474669456], "S": [0.47071273220293297, 0.8146050284676981, 0.026502483132739636], "P": [0.154346406459808, 0.100275993347168, -0.0248576998710632]}]};

    const STATIC_COUNT  = 8;
    const DYNAMIC_COUNT = 5;

    let currentTrial = "1";
    let currentCamera = null;

    // restyle対象トレース（動的5本）
    function dynamicTraceIndices() {
      const arr = [];
      for (let i = 0; i < DYNAMIC_COUNT; i++) arr.push(STATIC_COUNT + i);
      return arr;
    }
    const DYN_IDX = dynamicTraceIndices();

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        // 初期 camera 保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ユーザー操作で camera 変化を保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey && gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
          }
        });

        // 端末回転/リサイズ：Plotlyが勝手に変えることがあるので再適用
        let resizeTimer = null;
        function handleResize() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function() {
            Plotly.Plots.resize(gd).then(function() {
              if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
            });
          }, 150);
        }
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, currentTrial);
          });
        });

        // Slider
        slider.addEventListener("input", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init
        updateSliderForTrial(gd, currentTrial);

        function updateSliderForTrial(gd, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, trialKey, initPos);
        }

        // ★ここが本丸：restyle で x/y/z だけ更新（レイアウト触らない→カメラ戻らない）
        function updateFrame(gd, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          // Bat line (trace 0)
          const x0 = [f.A[0], f.B[0]];
          const y0 = [f.A[1], f.B[1]];
          const z0 = [f.A[2], f.B[2]];

          // Bottom marker (trace 1)
          const x1 = [f.B[0]];
          const y1 = [f.B[1]];
          const z1 = [f.B[2]];

          // Sweet (trace 2)
          const x2 = [f.S[0]];
          const y2 = [f.S[1]];
          const z2 = [f.S[2]];

          // Ball (trace 3)
          const x3 = [f.P[0]];
          const y3 = [f.P[1]];
          const z3 = [f.P[2]];

          // S->P (trace 4)
          const x4 = [f.S[0], f.P[0]];
          const y4 = [f.S[1], f.P[1]];
          const z4 = [f.S[2], f.P[2]];

          // restyle は「配列の配列」にするのがコツ
          Plotly.restyle(gd, {
            x: [x0, x1, x2, x3, x4],
            y: [y0, y1, y2, y3, y4],
            z: [z0, z1, z2, z3, z4],
          }, DYN_IDX).then(function() {
            // 念押し：カメラ保持（restyleだけなら基本不要だが、iOS保険）
            if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>

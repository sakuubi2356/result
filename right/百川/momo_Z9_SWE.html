<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Momo_Z9_SWE</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      -webkit-text-size-adjust: 100%;
    }
    .page-wrapper { padding: 10px 12px 16px 12px; }
    .top-row {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 10px;
    }
    #plotArea { flex: 1 1 auto; min-width: 0; height: 75vh; }
    #plot { width: 100%; height: 100%; }

    #trialPanel {
      width: 120px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      justify-content: flex-start;
    }
    .trial-btn {
      width: 100%;
      padding: 8px 6px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      cursor: pointer;
      font-size: 14px;
      touch-action: manipulation;
    }
    .trial-btn.active { background: #1976d2; color: #fff; }

    #bottomPanel {
      margin-top: 10px;
      padding: 10px 12px 12px 12px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #frameLabel { font-size: 14px; line-height: 1.2; }

    #frameSlider {
      width: 100%;
      height: 44px;
      margin: 0;
      background: transparent;
      touch-action: manipulation;
    }
    #frameSlider::-webkit-slider-runnable-track {
      height: 10px; border-radius: 999px; background: #d0d0d0;
    }
    #frameSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 34px; height: 34px;
      border-radius: 50%;
      background: #1976d2;
      border: 2px solid #fff;
      margin-top: -12px;
    }

    .step-btn {
      height: 44px;
      min-width: 64px;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #1976d2;
      background: #fff;
      color: #1976d2;
      touch-action: manipulation;
    }

    @media (max-width: 700px) {
      .top-row { flex-direction: column; }
      #trialPanel {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
      }
      .trial-btn { width: auto; min-width: 80px; }
      #plotArea { height: 60vh; }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="top-row">
      <div id="plotArea"><div id="plot"></div></div>
      <div id="trialPanel">
        <div style="font-weight:bold; margin-bottom:4px;">Trial</div>
        <button class="trial-btn" id="trialBtn_1" data-trial="1">1球目</button>
          <button class="trial-btn" id="trialBtn_2" data-trial="2">2球目</button>
          <button class="trial-btn" id="trialBtn_3" data-trial="3">3球目</button>
          <button class="trial-btn" id="trialBtn_4" data-trial="4">4球目</button>
      </div>
    </div>

    <div id="bottomPanel">
      <div id="frameLabel">Frame:</div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="prevBtn" class="step-btn">-</button>
        <input type="range" id="frameSlider" min="0" max="0" value="0" step="1">
        <button id="nextBtn" class="step-btn">+</button>
      </div>
    </div>
  </div>

  <script>
    const fig = {"data": [{"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [-0.4695162, -0.4695162, -0.4695162, -0.4695162, -0.4695162, -0.4695162], "type": "scatter3d"}, {"line": {"color": "blue", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.3002845, 0.3002845, 0.150155, 2.548099e-05, 0.150155, 0.3002845], "y": [0.150414, -0.150414, -0.150414, -0.0, 0.150414, 0.150414], "z": [0.06407398, 0.06407398, 0.06407398, 0.06407398, 0.06407398, 0.06407398], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [0.150414, 0.150414], "z": [-0.4695162, 0.06407398], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.3002845, 0.3002845], "y": [-0.150414, -0.150414], "z": [-0.4695162, 0.06407398], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [-0.150414, -0.150414], "z": [-0.4695162, 0.06407398], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [2.548099e-05, 2.548099e-05], "y": [-0.0, -0.0], "z": [-0.4695162, 0.06407398], "type": "scatter3d"}, {"line": {"color": "blue", "width": 2.5}, "mode": "lines", "opacity": 0.3, "showlegend": false, "x": [0.150155, 0.150155], "y": [0.150414, 0.150414], "z": [-0.4695162, 0.06407398], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "blue", "width": 1}, "size": 5}, "mode": "markers+text", "showlegend": false, "text": ["Z1", "Z2", "Z3", "Z4", "Z5", "Z6", "Z7", "Z8", "Z9"], "textposition": "top center", "x": [0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845, 0.3002845], "y": [0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276, 0.100276, -0.0, -0.100276], "z": [-0.0248577, -0.0248577, -0.0248577, -0.2027211, -0.2027211, -0.2027211, -0.3805845, -0.3805845, -0.3805845], "type": "scatter3d"}, {"line": {"color": "black", "width": 4}, "mode": "lines", "showlegend": false, "x": [0.0970424935221672, 0.209653347730637], "y": [-0.0660087913274765, 0.530775725841522], "z": [-0.349171459674835, 0.171565517783165], "type": "scatter3d"}, {"marker": {"color": "white", "line": {"color": "red", "width": 3}, "size": 10, "symbol": "circle"}, "mode": "markers", "showlegend": false, "x": [0.209653347730637], "y": [0.530775725841522], "z": [0.171565517783165], "type": "scatter3d"}, {"marker": {"color": "orange", "size": 7}, "mode": "markers", "showlegend": false, "x": [0.11111885069291061], "y": [0.008589275410291336], "z": [-0.28407933566747756], "type": "scatter3d"}, {"marker": {"color": "blue", "size": 7, "symbol": "x"}, "mode": "markers", "showlegend": false, "x": [0.154346406459808], "y": [-0.100275993347168], "z": [-0.380584537982941], "type": "scatter3d"}, {"line": {"color": "purple", "dash": "dash", "width": 3}, "mode": "lines", "showlegend": false, "x": [0.11111885069291061, 0.154346406459808], "y": [0.008589275410291336, -0.100275993347168], "z": [-0.28407933566747756, -0.380584537982941], "type": "scatter3d"}], "layout": {"template": {"data": {"histogram2dcontour": [{"type": "histogram2dcontour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "choropleth": [{"type": "choropleth", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "histogram2d": [{"type": "histogram2d", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmap": [{"type": "heatmap", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "heatmapgl": [{"type": "heatmapgl", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "contourcarpet": [{"type": "contourcarpet", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "contour": [{"type": "contour", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "surface": [{"type": "surface", "colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}], "mesh3d": [{"type": "mesh3d", "colorbar": {"outlinewidth": 0, "ticks": ""}}], "scatter": [{"fillpattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}, "type": "scatter"}], "parcoords": [{"type": "parcoords", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolargl": [{"type": "scatterpolargl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "bar"}], "scattergeo": [{"type": "scattergeo", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterpolar": [{"type": "scatterpolar", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "histogram": [{"marker": {"pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "histogram"}], "scattergl": [{"type": "scattergl", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatter3d": [{"type": "scatter3d", "line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattermapbox": [{"type": "scattermapbox", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scatterternary": [{"type": "scatterternary", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "scattercarpet": [{"type": "scattercarpet", "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}, "pattern": {"fillmode": "overlay", "size": 10, "solidity": 0.2}}, "type": "barpolar"}], "pie": [{"automargin": true, "type": "pie"}]}, "layout": {"autotypenumbers": "strict", "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "hovermode": "closest", "hoverlabel": {"align": "left"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"bgcolor": "#E5ECF6", "angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "ternary": {"bgcolor": "#E5ECF6", "aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]]}, "xaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "yaxis": {"gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "automargin": true, "zerolinewidth": 2}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white", "gridwidth": 2}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "geo": {"bgcolor": "white", "landcolor": "#E5ECF6", "subunitcolor": "white", "showland": true, "showlakes": true, "lakecolor": "white"}, "title": {"x": 0.05}, "mapbox": {"style": "light"}}}, "scene": {"camera": {"eye": {"x": 1.6, "y": 1.6, "z": 1.0}, "center": {"x": 0, "y": 0, "z": 0}, "up": {"x": 0, "y": 0, "z": 1}}, "xaxis": {"title": {"text": "\u6a2a Z [m]"}}, "yaxis": {"title": {"text": "\u5965\u884c X [m]"}}, "zaxis": {"title": {"text": "\u7e26 Y [m]"}}, "aspectmode": "data"}, "margin": {"l": 0, "r": 0, "t": 60, "b": 120}, "title": {"text": "Z9 (Z9)  |  offset=10 cm from TOP"}, "showlegend": false, "uirevision": "KEEP_CAMERA_FOREVER"}};
    const trialInfo = {"1": [{"index": -6, "is_min": false, "A": [-0.725078523159027, 0.47417226433754, 0.0520502701401711], "B": [-0.0306579321622849, 0.0982435718178749, -0.0762369260191917], "S": [-0.6382759454704265, 0.42718117570784625, 0.03601436991565132], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": -5, "is_min": false, "A": [-0.689769148826599, 0.33946818113327, -0.0678360387682915], "B": [0.0896324217319489, 0.165039107203484, -0.0219255797564983], "S": [-0.5923439586162385, 0.3176645482593356, -0.062097231751693474], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": -4, "is_min": false, "A": [-0.587526440620422, 0.183137387037277, -0.174669668078423], "B": [0.185709625482559, 0.231775045394897, 0.0246804188936949], "S": [-0.4908719393732099, 0.1892170938906844, -0.1497509090156347], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": -3, "is_min": false, "A": [-0.41744464635849, 0.0527420192956924, -0.263033479452133], "B": [0.254768192768097, 0.320501923561096, 0.0781919658184052], "S": [-0.33341805931799207, 0.08621200021861773, -0.22038030785441198], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": -2, "is_min": false, "A": [-0.195569545030594, -0.0618630461394787, -0.317212492227554], "B": [0.223230332136154, 0.447754263877869, 0.135443180799484], "S": [-0.1432195725768843, 0.0018391027766719442, -0.26063054627692056], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": -1, "is_min": true, "A": [0.0970424935221672, -0.0660087913274765, -0.349171459674835], "B": [0.209653347730637, 0.530775725841522, 0.171565517783165], "S": [0.11111885069291061, 0.008589275410291336, -0.28407933566747756], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": 0, "is_min": false, "A": [0.0970424935221672, -0.0660087913274765, -0.349171459674835], "B": [0.209653347730637, 0.530775725841522, 0.171565517783165], "S": [0.11111885069291061, 0.008589275410291336, -0.28407933566747756], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": 1, "is_min": false, "A": [0.379075467586517, 0.00381549820303917, -0.306740373373032], "B": [0.147570893168449, 0.590293109416962, 0.185651510953903], "S": [0.35013739859176446, 0.07712519249243886, -0.24519139380350785], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": 2, "is_min": false, "A": [0.601829349994659, 0.189109444618225, -0.249100387096405], "B": [0.0852669328451157, 0.618609070777893, 0.185288041830063], "S": [0.537259046179598, 0.2427968992778548, -0.19480183207510715], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": 3, "is_min": false, "A": [0.740441739559174, 0.526295125484467, -0.192002981901169], "B": [0.0660287663340569, 0.678191721439362, 0.210606604814529], "S": [0.656140112217809, 0.5452822012599757, -0.14167678016596238], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": 4, "is_min": false, "A": [0.783375203609467, 0.359080076217651, 0.0173231773078442], "B": [-0.0120762623846531, 0.430004954338074, 0.0645093619823456], "S": [0.6839437633000045, 0.3679456866122126, 0.02322145081096782], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}], "2": [{"index": -6, "is_min": false, "A": [-0.923406600952148, 0.306019365787506, -0.0889981836080551], "B": [-0.185126096010208, -0.00207455083727837, -0.093466728925705], "S": [-0.8311215330280679, 0.2675076242036617, -0.08955675180185237], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": -5, "is_min": false, "A": [-0.866876423358917, 0.207050114870071, -0.196775123476982], "B": [-0.104391567409039, -0.0139310071244836, -0.0978598222136497], "S": [-0.7715658199880941, 0.17942747567073336, -0.184410711289057], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": -4, "is_min": false, "A": [-0.677273631095886, 0.00833075307309628, -0.300834149122238], "B": [0.0555134937167168, 0.130065158009529, -0.00384294800460339], "S": [-0.5856752411510743, 0.02354755358104539, -0.2637102492487133], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": -3, "is_min": false, "A": [-0.467678338289261, -0.100827559828758, -0.383244395256042], "B": [0.136924251914024, 0.212682351469994, 0.0364785566926003], "S": [-0.39210302118310936, -0.06163882437468367, -0.3307790308923477], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": -2, "is_min": false, "A": [-0.209820508956909, -0.165797650814056, -0.409272968769073], "B": [0.15508183836937, 0.345898807048798, 0.0857153236865997], "S": [-0.16420772971464462, -0.10183561345648993, -0.34739945143842677], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": -1, "is_min": true, "A": [0.0773932933807373, -0.141646608710289, -0.421680867671967], "B": [0.173651218414307, 0.440295398235321, 0.118761897087097], "S": [0.08942552959598299, -0.06890388452730074, -0.35412554685933056], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": 0, "is_min": false, "A": [0.0773932933807373, -0.141646608710289, -0.421680867671967], "B": [0.173651218414307, 0.440295398235321, 0.118761897087097], "S": [0.08942552959598299, -0.06890388452730074, -0.35412554685933056], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": 1, "is_min": false, "A": [0.3480384349823, -0.0460371673107147, -0.370992004871368], "B": [0.143271550536156, 0.532906889915466, 0.141740083694458], "S": [0.3224425722870451, 0.026330845891598766, -0.3069004884434082], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": 2, "is_min": false, "A": [0.540884613990784, 0.0905005931854248, -0.2520931661129], "B": [0.0280103906989098, 0.573500573635101, 0.126946404576302], "S": [0.47677533338369904, 0.15087559328021988, -0.2047132177845667], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": 3, "is_min": false, "A": [0.672332108020782, 0.325170397758484, -0.180414214730263], "B": [-0.0232210345566273, 0.593267321586609, 0.109981670975685], "S": [0.5853879587559324, 0.3586825157202907, -0.14411472632718067], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": 4, "is_min": false, "A": [0.699359178543091, 0.4991654753685, -0.0871023461222649], "B": [-0.0893078595399857, 0.516457736492157, 0.0459581688046455], "S": [0.6007757849106447, 0.501327008313115, -0.07046977941596642], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}], "3": [{"index": -6, "is_min": false, "A": [-0.854307651519775, 0.328181147575378, -0.00333073223009706], "B": [-0.139886975288391, -0.0164124872535467, -0.10753308236599], "S": [-0.7650050534256022, 0.28510693667870046, -0.016356027975653102], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": -5, "is_min": false, "A": [-0.806251645088196, 0.224821269512177, -0.114593133330345], "B": [-0.0475113689899445, -0.0287625342607498, -0.111670598387718], "S": [-0.7114091174905339, 0.1931232963515436, -0.11422781648915054], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": -4, "is_min": false, "A": [-0.733461380004883, 0.119497366249561, -0.225931480526924], "B": [0.0425308644771576, -0.0406732633709908, -0.115562058985233], "S": [-0.6364623496947617, 0.0994760375986215, -0.21213530286978916], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": -3, "is_min": false, "A": [-0.446156620979309, -0.0949778407812119, -0.337459862232208], "B": [0.216810002923012, 0.175376445055008, 0.0194492824375629], "S": [-0.36328581382752656, -0.06118356354849824, -0.29284623036558477], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": -2, "is_min": false, "A": [-0.169093444943428, -0.160809978842735, -0.409287333488464], "B": [0.282869815826416, 0.285075426101685, 0.0774523988366127], "S": [-0.11259804398770391, -0.10507430977588954, -0.3484448740992919], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": -1, "is_min": true, "A": [0.116304777562618, -0.147367671132088, -0.398667544126511], "B": [0.220698237419128, 0.439142823219299, 0.135287061333656], "S": [0.12935395927868212, -0.07405386364175624, -0.33192322236194655], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": 0, "is_min": false, "A": [0.116304777562618, -0.147367671132088, -0.398667544126511], "B": [0.220698237419128, 0.439142823219299, 0.135287061333656], "S": [0.12935395927868212, -0.07405386364175624, -0.33192322236194655], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": 1, "is_min": false, "A": [0.394250154495239, -0.0296875722706318, -0.367135733366013], "B": [0.176386117935181, 0.527707993984222, 0.163755536079407], "S": [0.36701715196090245, 0.03998686830305084, -0.30077432964585965], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": 2, "is_min": false, "A": [0.583998560905457, 0.104203745722771, -0.258706152439117], "B": [0.0414103902876377, 0.538814306259155, 0.13716234266758], "S": [0.516175046341621, 0.15853006037237444, -0.20922259548530245], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": 3, "is_min": false, "A": [0.699355900287628, 0.336403220891953, -0.183109134435654], "B": [-0.0174282267689705, 0.527650058269501, 0.116299241781235], "S": [0.6097578993401414, 0.36030907157941433, -0.14568309364687967], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": 4, "is_min": false, "A": [0.721473515033722, 0.563210129737854, -0.08631631731987], "B": [-0.0566829703748226, 0.484133452177048, 0.0816707760095596], "S": [0.6242039771736427, 0.5533255473613262, -0.06531793557916801], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}], "4": [{"index": -6, "is_min": false, "A": [-0.798959970474243, 0.216464892029762, -0.0936815738677979], "B": [-0.0149464495480061, 0.0576334446668625, -0.0839045643806458], "S": [-0.700958297170424, 0.19661096451529492, -0.09245944789155677], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": -5, "is_min": false, "A": [-0.701358437538147, 0.0979312062263489, -0.203851342201233], "B": [0.0844509452581406, 0.10565260052681, -0.0540381111204624], "S": [-0.6031322654734601, 0.09889638050619458, -0.18512468846576682], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": -4, "is_min": false, "A": [-0.549027562141418, -0.0350044965744019, -0.293280780315399], "B": [0.152774766087532, 0.208629086613655, 0.00356363598257303], "S": [-0.46130230114854665, -0.004550309102928814, -0.2561752409825046], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": -3, "is_min": false, "A": [-0.335808426141739, -0.114605098962784, -0.378567159175873], "B": [0.200451537966728, 0.296687424182892, 0.0495262891054153], "S": [-0.2687759457713669, -0.06319354518386551, -0.3250554902294362], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": -2, "is_min": false, "A": [-0.0775833278894424, -0.114208646118641, -0.460109800100327], "B": [0.273255199193954, 0.356167674064636, 0.083635151386261], "S": [-0.033728516353262364, -0.055411611926851595, -0.3921416879051536], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": -1, "is_min": true, "A": [0.164644360542297, -0.144374921917915, -0.392344027757645], "B": [0.130766808986664, 0.468609303236008, 0.120591729879379], "S": [0.16040966805434403, -0.06775192012777011, -0.32822708010571816], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": 0, "is_min": false, "A": [0.164644360542297, -0.144374921917915, -0.392344027757645], "B": [0.130766808986664, 0.468609303236008, 0.120591729879379], "S": [0.16040966805434403, -0.06775192012777011, -0.32822708010571816], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": 1, "is_min": false, "A": [0.411206215620041, -0.0276945829391479, -0.356972336769104], "B": [0.0842063203454018, 0.512814939022064, 0.133864670991898], "S": [0.37033124285817975, 0.03986908392115964, -0.295617732034769], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": 2, "is_min": false, "A": [0.598237454891205, 0.155010759830475, -0.292441219091415], "B": [0.0321825295686722, 0.526361644268036, 0.133798524737358], "S": [0.5274805879585486, 0.20142962121658725, -0.23916125015851067], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": 3, "is_min": false, "A": [0.72942578792572, 0.257881343364716, -0.122940823435783], "B": [-0.0139918886125088, 0.461351573467255, 0.0913729816675186], "S": [0.6364986061919674, 0.28331511450961666, -0.09615160582177], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}, {"index": 4, "is_min": false, "A": [0.766184389591217, 0.473620235919952, -0.0184561479836702], "B": [-0.0275981798768044, 0.42480605840683, 0.0682990029454231], "S": [0.6669615721076608, 0.4675184639583424, -0.007611754521913053], "P": [0.154346406459808, -0.100275993347168, -0.380584537982941]}]};

    const STATIC_COUNT  = 8;
    const DYNAMIC_COUNT = 5;

    let currentTrial = "1";
    let currentCamera = null;

    // restyle対象トレース（動的5本）
    function dynamicTraceIndices() {
      const arr = [];
      for (let i = 0; i < DYNAMIC_COUNT; i++) arr.push(STATIC_COUNT + i);
      return arr;
    }
    const DYN_IDX = dynamicTraceIndices();

    document.addEventListener("DOMContentLoaded", function() {
      const plotDiv = document.getElementById("plot");
      const slider = document.getElementById("frameSlider");
      const frameLabel = document.getElementById("frameLabel");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");

      Plotly.newPlot(
        plotDiv,
        fig.data,
        fig.layout,
        {
          responsive: true,
          displayModeBar: true,
          scrollZoom: false
        }
      ).then(function(gd) {
        // 初期 camera 保存
        if (gd.layout && gd.layout.scene && gd.layout.scene.camera) {
          currentCamera = gd.layout.scene.camera;
        }

        // ユーザー操作で camera 変化を保存
        gd.on('plotly_relayout', function(ev) {
          if (ev['scene.camera']) {
            currentCamera = ev['scene.camera'];
            return;
          }
          const hasCamKey = Object.keys(ev).some(k => k.startsWith('scene.camera'));
          if (hasCamKey && gd.layout && gd.layout.scene && gd.layout.scene.camera) {
            currentCamera = gd.layout.scene.camera;
          }
        });

        // 端末回転/リサイズ：Plotlyが勝手に変えることがあるので再適用
        let resizeTimer = null;
        function handleResize() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function() {
            Plotly.Plots.resize(gd).then(function() {
              if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
            });
          }, 150);
        }
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Trial buttons
        Object.keys(trialInfo).forEach(function(trialKey) {
          const btn = document.getElementById("trialBtn_" + trialKey);
          if (!btn) return;

          btn.addEventListener("click", function() {
            document.querySelectorAll(".trial-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTrial = trialKey;
            updateSliderForTrial(gd, currentTrial);
          });
        });

        // Slider
        slider.addEventListener("input", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });
        slider.addEventListener("change", function() {
          updateFrame(gd, currentTrial, Number(slider.value));
        });

        // ±
        prevBtn.addEventListener("click", function() {
          const v = Math.max(Number(slider.min), Number(slider.value) - 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });
        nextBtn.addEventListener("click", function() {
          const v = Math.min(Number(slider.max), Number(slider.value) + 1);
          slider.value = v;
          updateFrame(gd, currentTrial, v);
        });

        // init active
        const initBtn = document.getElementById("trialBtn_1");
        if (initBtn) initBtn.classList.add("active");

        // init
        updateSliderForTrial(gd, currentTrial);

        function updateSliderForTrial(gd, trialKey) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          slider.min = 0;
          slider.max = frames.length - 1;

          // 初期は MIN 位置
          let initPos = 0;
          for (let i = 0; i < frames.length; i++) {
            if (frames[i].is_min) { initPos = i; break; }
          }
          slider.value = initPos;

          updateFrame(gd, trialKey, initPos);
        }

        // ★ここが本丸：restyle で x/y/z だけ更新（レイアウト触らない→カメラ戻らない）
        function updateFrame(gd, trialKey, idxInTrial) {
          const frames = trialInfo[trialKey];
          if (!frames || frames.length === 0) return;

          const clamped = Math.max(0, Math.min(idxInTrial, frames.length - 1));
          const f = frames[clamped];

          // Bat line (trace 0)
          const x0 = [f.A[0], f.B[0]];
          const y0 = [f.A[1], f.B[1]];
          const z0 = [f.A[2], f.B[2]];

          // Bottom marker (trace 1)
          const x1 = [f.B[0]];
          const y1 = [f.B[1]];
          const z1 = [f.B[2]];

          // Sweet (trace 2)
          const x2 = [f.S[0]];
          const y2 = [f.S[1]];
          const z2 = [f.S[2]];

          // Ball (trace 3)
          const x3 = [f.P[0]];
          const y3 = [f.P[1]];
          const z3 = [f.P[2]];

          // S->P (trace 4)
          const x4 = [f.S[0], f.P[0]];
          const y4 = [f.S[1], f.P[1]];
          const z4 = [f.S[2], f.P[2]];

          // restyle は「配列の配列」にするのがコツ
          Plotly.restyle(gd, {
            x: [x0, x1, x2, x3, x4],
            y: [y0, y1, y2, y3, y4],
            z: [z0, z1, z2, z3, z4],
          }, DYN_IDX).then(function() {
            // 念押し：カメラ保持（restyleだけなら基本不要だが、iOS保険）
            if (currentCamera) Plotly.relayout(gd, {'scene.camera': currentCamera});
          });

          frameLabel.textContent =
            "Trial " + trialKey +
            " / frame index = " + f.index +
            " (step " + clamped + ")" +
            (f.is_min ? "  ★MIN" : "");
        }
      });
    });
  </script>
</body>
</html>
